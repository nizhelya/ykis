/*
 * File: app/view/org/TabNachFilial.js
 * Date: Thu Jan 28 2021 11:47:41 GMT+0200 (EET)
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Ykis.view.org.TabNachFilial', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.tabnachfilial',

    requires: [
        'Ykis.view.org.TabNachFilialViewModel',
        'Ykis.view.NField',
        'Ext.form.Panel',
        'Ext.form.field.Display',
        'Ext.form.FieldSet',
        'Ext.form.field.Checkbox',
        'Ext.form.field.Number',
        'Ext.tab.Panel',
        'Ext.tab.Tab',
        'Ext.grid.Panel',
        'Ext.grid.feature.GroupingSummary',
        'Ext.view.Table',
        'Ext.grid.column.Number',
        'Ext.grid.column.Date',
        'Ext.grid.column.Action',
        'Ext.form.Label',
        'Ext.form.field.ComboBox',
        'Ext.form.field.Date',
        'Ext.form.field.TextArea',
        'Ext.panel.Tool',
        'Ext.form.FieldContainer'
    ],

    viewModel: {
        type: 'tabnachfilial'
    },
    hidden: true,
    id: 'tabNachFilial',
    scrollable: true,
    title: 'Начисления  и Оплата',
    defaultListenerScope: true,

    items: [
        {
            xtype: 'form',
            height: 278,
            id: 'fmInfoNachFilial',
            margin: '0 0 5 0',
            width: 913,
            layout: 'absolute',
            title: '',
            items: [
                {
                    xtype: 'textfield',
                    x: 325,
                    y: 30,
                    hidden: true,
                    width: 70,
                    fieldLabel: '',
                    labelPad: 15,
                    labelSeparator: ' ',
                    labelWidth: 20,
                    name: 'address_id'
                },
                {
                    xtype: 'displayfield',
                    x: 10,
                    y: 30,
                    hidden: true,
                    width: 305,
                    fieldLabel: 'Адрес',
                    labelSeparator: ' ',
                    labelStyle: '',
                    labelWidth: 50,
                    name: 'address'
                },
                {
                    xtype: 'displayfield',
                    x: 10,
                    y: 0,
                    hidden: true,
                    width: 385,
                    fieldLabel: '',
                    labelSeparator: ' ',
                    labelStyle: '',
                    labelWidth: 50,
                    name: 'nanim',
                    fieldStyle: 'color: #D15706; text-shadow: -1px -1px white, 1px 1px #333;font-size:14pt;text-align:left;'
                },
                {
                    xtype: 'fieldset',
                    x: 655,
                    y: 210,
                    height: 60,
                    style: 'background-color: #DCDCDC;',
                    width: 245,
                    layout: 'absolute',
                    title: 'Включен в отчеты',
                    items: [
                        {
                            xtype: 'checkboxfield',
                            x: 5,
                            y: 0,
                            fieldLabel: 'по теплу',
                            labelWidth: 60,
                            name: 'rteplo',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange5'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            x: 120,
                            y: 0,
                            fieldLabel: 'по воде',
                            labelWidth: 60,
                            name: 'rvoda',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange6'
                            }
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    x: 5,
                    y: 5,
                    height: 185,
                    style: 'background-color: #DCDCDC;',
                    width: 260,
                    layout: 'absolute',
                    title: 'Потребляемые услуги',
                    items: [
                        {
                            xtype: 'checkboxfield',
                            x: 0,
                            y: 20,
                            fieldLabel: 'Отопление',
                            labelWidth: 70,
                            name: 'vkl_otopl',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange1'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            x: 0,
                            y: 48,
                            fieldLabel: 'Подогрев',
                            labelWidth: 70,
                            name: 'vkl_gvoda',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange2'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            x: 0,
                            y: 77,
                            fieldLabel: 'Хол. вода',
                            labelWidth: 70,
                            name: 'vkl_xvoda',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange3'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            x: 0,
                            y: 106,
                            fieldLabel: 'Стоки',
                            labelWidth: 70,
                            name: 'vkl_stoki',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange4'
                            }
                        },
                        {
                            xtype: 'fieldset',
                            x: 120,
                            y: 0,
                            height: 140,
                            style: 'background-color: #f3f3f3;',
                            width: 110,
                            title: 'Тариф',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 78,
                                    fieldLabel: '',
                                    labelAlign: 'right',
                                    name: 'tarif_ot',
                                    hideTrigger: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 100,
                                    fieldLabel: '',
                                    labelAlign: 'right',
                                    name: 'tarif_gv',
                                    hideTrigger: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 100,
                                    fieldLabel: '',
                                    labelAlign: 'right',
                                    name: 'tarif_xv',
                                    hideTrigger: true,
                                    decimalPrecision: 4
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 100,
                                    fieldLabel: '',
                                    labelAlign: 'right',
                                    name: 'tarif_st',
                                    hideTrigger: true,
                                    decimalPrecision: 4
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    x: 455,
                    y: 5,
                    height: 265,
                    style: 'background-color: #DCDCDC;',
                    width: 195,
                    title: 'Тех. Характеристики',
                    items: [
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 120,
                            fieldLabel: 'S (м&sup2;)',
                            name: 'area',
                            value: 0,
                            allowBlank: false,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 120,
                            fieldLabel: 'H (м&sup2;)',
                            name: 'visota',
                            value: 0,
                            allowBlank: false,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 120,
                            fieldLabel: 'V (м&sup3;)',
                            name: 'volume',
                            value: 0,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 170,
                            fieldLabel: 'Персонал',
                            name: 'people',
                            value: 0,
                            hideTrigger: true,
                            decimalPrecision: 0
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 170,
                            fieldLabel: 'Гвода (лс/чел)',
                            name: 'nrx_gvs_d',
                            value: 0,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 170,
                            fieldLabel: 'Хвода (лс/чел)',
                            name: 'nrx_xv_d',
                            value: 0,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 170,
                            fieldLabel: 'Стоки ( %)',
                            name: 'pstoki',
                            value: 0,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 170,
                            fieldLabel: 'График (час)',
                            name: 'qty_hour',
                            value: 0,
                            hideTrigger: true,
                            decimalPrecision: 0
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    x: 5,
                    y: 200,
                    height: 70,
                    style: 'background-color: #DCDCDC;',
                    width: 445,
                    layout: 'absolute',
                    title: 'Обновить данные  начислений  по воде , норме и перерасчетам',
                    items: [
                        {
                            xtype: 'button',
                            x: 0,
                            y: 10,
                            disabled: true,
                            id: 'btnNormaFilialUpdate',
                            width: 110,
                            icon: 'resources/css/images/ico/refresh.png',
                            text: ' по норме'
                        },
                        {
                            xtype: 'button',
                            x: 115,
                            y: 10,
                            disabled: true,
                            id: 'btnVodaFilialUpdate',
                            width: 135,
                            icon: 'resources/css/images/ico/xsldbg_refresh.png',
                            text: 'по счетчикам'
                        },
                        {
                            xtype: 'button',
                            x: 255,
                            y: 10,
                            disabled: true,
                            id: 'btnFilialUpdate',
                            width: 170,
                            icon: 'resources/css/images/ico/xsldbg_refresh.png',
                            text: 'по обьектам'
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    anchor: '',
                    x: 655,
                    y: 5,
                    style: 'background-color: #DCDCDC;',
                    width: 245,
                    title: 'Тепловые нагрузки',
                    items: [
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 225,
                            fieldLabel: ' ГВС гкал/час зимой',
                            labelWidth: 130,
                            name: 'gkal_hw_gvs',
                            value: 0,
                            hideTrigger: true,
                            decimalPrecision: 6
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 225,
                            fieldLabel: 'ГВС гкал/год зимой',
                            labelWidth: 130,
                            name: 'gkal_yw_gvs',
                            value: 0,
                            hideTrigger: true,
                            decimalPrecision: 3
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 225,
                            fieldLabel: 'ГВС гкал/час летом',
                            labelWidth: 130,
                            name: 'gkal_hs_gvs',
                            value: 0,
                            hideTrigger: true,
                            decimalPrecision: 6
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 225,
                            fieldLabel: 'ГВС гкал/год летом',
                            labelWidth: 130,
                            name: 'gkal_ys_gvs',
                            value: 0,
                            hideTrigger: true,
                            decimalPrecision: 3
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 225,
                            fieldLabel: 'Отопление гкал/час',
                            labelWidth: 130,
                            name: 'gkal_h_ot',
                            value: 0,
                            hideTrigger: true,
                            decimalPrecision: 6,
                            step: 0.1
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 225,
                            fieldLabel: 'Отопление гкал/год ',
                            labelWidth: 130,
                            name: 'gkal_y_ot',
                            value: 0,
                            hideTrigger: true,
                            decimalPrecision: 3,
                            step: 0.1
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    x: 270,
                    y: 5,
                    height: 185,
                    style: 'background-color: #DCDCDC;',
                    width: 180,
                    title: 'Приборы учета',
                    items: [
                        {
                            xtype: 'checkboxfield',
                            fieldLabel: 'Счетчик хв.',
                            name: 'xvodomer',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange13'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            fieldLabel: 'Счетчик гв.',
                            name: 'gvodomer',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            fieldLabel: 'Норма хв.',
                            name: 'norma_xv',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange21'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            fieldLabel: 'Норма гв.',
                            name: 'norma_gv',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange31'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            fieldLabel: 'Тепломер',
                            name: 'teplomer',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange41'
                            }
                        }
                    ]
                }
            ]
        },
        {
            xtype: 'tabpanel',
            height: 700,
            id: 'tabPnNachFilial',
            width: 912,
            activeTab: 0,
            items: [
                {
                    xtype: 'panel',
                    layout: 'anchor',
                    title: 'Оплата',
                    items: [
                        {
                            xtype: 'gridpanel',
                            id: 'tabFilalOplata',
                            scrollable: true,
                            collapsed: true,
                            collapsible: true,
                            title: 'Оплата',
                            forceFit: true,
                            store: 'StOplataFilial',
                            features: [
                                {
                                    ftype: 'groupingsummary',
                                    groupByText: 'Группировать по этому полю',
                                    showGroupsText: 'Показать в группе',
                                    startCollapsed: true
                                }
                            ],
                            viewConfig: {
                                emptyText: 'Нет записей по оплате'
                            },
                            columns: [
                                {
                                    xtype: 'numbercolumn',
                                    hidden: true,
                                    dataIndex: 'filial_id',
                                    text: 'филиал_ид'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 87,
                                    dataIndex: 'filial',
                                    menuDisabled: true,
                                    text: 'Филиал'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'org_id',
                                    text: 'орг_ид'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    hidden: true,
                                    dataIndex: 'god',
                                    text: 'Оплата за',
                                    format: '0'
                                },
                                {
                                    xtype: 'datecolumn',
                                    width: 75,
                                    dataIndex: 'data',
                                    menuDisabled: true,
                                    text: 'Дата',
                                    format: 'd-m-y'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    summaryRenderer: function(val, params, data) {
                                        var n =Ext.util.Format.number(val,'0,000.00');
                                        if (val >= 0) {
                                            return '<span style="color:#000; font-weight:bold;">' + n + '</span>';
                                        } else  {
                                            return '<span style="color:red; font-weight:bold;">' + n + '</span>';
                                        }
                                    },
                                    summaryType: 'sum',
                                    width: 70,
                                    dataIndex: 'otoplenie',
                                    menuDisabled: true,
                                    text: 'Отопл'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    summaryRenderer: function(val, params, data) {
                                        var n =Ext.util.Format.number(val,'0,000.00');
                                        if (val >= 0) {
                                            return '<span style="color:#000; font-weight:bold;">' + n + '</span>';
                                        } else  {
                                            return '<span style="color:red; font-weight:bold;">' + n + '</span>';
                                        }
                                    },
                                    summaryType: 'sum',
                                    width: 70,
                                    dataIndex: 'podogrev',
                                    menuDisabled: true,
                                    text: 'Подог'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    summaryRenderer: function(val, params, data) {
                                        var n =Ext.util.Format.number(val,'0,000.00');
                                        if (val >= 0) {
                                            return '<span style="color:#000; font-weight:bold;">' + n + '</span>';
                                        } else  {
                                            return '<span style="color:red; font-weight:bold;">' + n + '</span>';
                                        }
                                    },
                                    summaryType: 'sum',
                                    width: 70,
                                    dataIndex: 'voda',
                                    menuDisabled: true,
                                    text: 'Вода'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    summaryRenderer: function(val, params, data) {
                                        var n =Ext.util.Format.number(val,'0,000.00');
                                        if (val >= 0) {
                                            return '<span style="color:#000; font-weight:bold;">' + n + '</span>';
                                        } else  {
                                            return '<span style="color:red; font-weight:bold;">' + n + '</span>';
                                        }
                                    },
                                    summaryType: 'sum',
                                    width: 70,
                                    dataIndex: 'stoki',
                                    menuDisabled: true,
                                    text: 'Стоки'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    summaryRenderer: function(val, params, data) {
                                        var n =Ext.util.Format.number(val,'0,000.00');
                                        if (val >= 0) {
                                            return '<span style="color:#000; font-weight:bold;">' + n + '</span>';
                                        } else  {
                                            return '<span style="color:red; font-weight:bold;">' + n + '</span>';
                                        }
                                    },
                                    summaryType: 'sum',
                                    width: 80,
                                    dataIndex: 'summa',
                                    menuDisabled: true,
                                    text: 'Сумма'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    width: 85,
                                    dataIndex: 'prixod',
                                    menuDisabled: true,
                                    text: 'Приход'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    width: 80,
                                    dataIndex: 'kassa',
                                    menuDisabled: true,
                                    text: 'Касса'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'nomer',
                                    text: 'Nomer'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    width: 80,
                                    dataIndex: 'operator',
                                    menuDisabled: true,
                                    text: 'Оператор'
                                },
                                {
                                    xtype: 'datecolumn',
                                    hidden: true,
                                    dataIndex: 'data_in',
                                    text: 'Date_in'
                                },
                                {
                                    xtype: 'actioncolumn',
                                    width: 30,
                                    menuDisabled: true,
                                    items: [
                                        {
                                            handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                var winEditOplata = Ext.ClassManager.instantiateByAlias('widget.wineditoplataorg');
                                                var form = winEditOplata.down('#fmEditOplataOrg');
                                                var stUser = Ext.data.StoreManager.get("StUser");
                                                var values =stUser.getAt(0);
                                                var value = record;
                                                //console.log(value);
                                                view.getSelectionModel().select(rowIndex);
                                                values.set({'vibor':'editOplataOrg'});
                                                stUser.sync();

                                                form.loadRecord(value);
                                                winEditOplata.show();
                                            },
                                            getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                var tekd = r.get('data');
                                                var dt = new Date();
                                                var check_date=Ext.Date.format(dt, 'Y-m');
                                                var tek_date=Ext.Date.format(tekd, 'Y-m');
                                                if (check_date === tek_date ) {
                                                    metaData = 'x-grid-center-icon';
                                                } else {
                                                    metaData = 'x-grid-center-icon';
                                                }
                                                return metaData;
                                            },
                                            icon: 'resources/css/images/ico/edit.png',
                                            tooltip: 'Редактировать запись'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'actioncolumn',
                                    doAllResetKassa1: function() {
                                        //STORE

                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var values =stUser.getAt(0);
                                        var prixod_id =values.get('prixod_id');
                                        //console.log(prixod_id);

                                        var form = Ext.getCmp('fmTekNachKassaOrg');
                                        form.down('#DoAllOrg').setDisabled(false);
                                        form.down('#DoAllResetOrg').setDisabled(true);
                                        form.down('#NextAllResetOrg').setDisabled(true);
                                        form.down('#NextAllOrg').setDisabled(false);
                                        form.getForm().findField('cbNext1').setDisabled(false).setValue(false);
                                        form.getForm().findField('cbNext2').setDisabled(false).setValue(false);
                                        form.getForm().findField('cbNext3').setDisabled(false).setValue(false);
                                        form.getForm().findField('cbNext4').setDisabled(false).setValue(false);
                                        form.getForm().findField('cbDo1').setDisabled(false).setValue(false);
                                        form.getForm().findField('cbDo2').setDisabled(false).setValue(false);
                                        form.getForm().findField('cbDo3').setDisabled(false).setValue(false);
                                        form.getForm().findField('cbDo4').setDisabled(false).setValue(false);
                                        form.getForm().findField('zadol1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('period1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('nachisleno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('oplacheno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('dolg1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('zadol2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('period2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('nachisleno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('oplacheno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('dolg2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('zadol3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('period3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('nachisleno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('oplacheno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('dolg3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('zadol4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('period4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('nachisleno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('oplacheno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                        form.getForm().findField('dolg4').setFieldStyle('background-color: #F0F8FF; background-image: none;');


                                        var newOplata = form.getForm().findField('newOplataOrg').setValue(0);

                                    },
                                    width: 30,
                                    menuDisabled: true,
                                    items: [
                                        {
                                            handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                // in use
                                                var me = this;
                                                //STORE

                                                var stUser = Ext.data.StoreManager.get("StUser");
                                                var stTekNachKassa = Ext.data.StoreManager.get("StTekNachKassaOrg");


                                                //LOGIN & PASSWORD
                                                var values =stUser.getAt(0);
                                                var params = {
                                                    login:values.get('login'),
                                                    password:values.get('password'),
                                                    address_id:values.get('address_id'),
                                                    address:values.get('address'),
                                                    what:"delOplataOrg"
                                                };

                                                //GRID
                                                var store = view.getStore();
                                                var value = store.getAt(rowIndex).data;


                                                //LOGIKA
                                                var fmTekNachKassa = Ext.getCmp('fmTekNachKassaOrg');

                                                //LOGIKA

                                                Ext.Object.merge(value, params);
                                                //console.log(value);

                                                Ext.MessageBox.confirm({
                                                    title: 'Удаление записи',
                                                    msg: 'Вы удаляете запись об оплате  <br> Подтвердите или отмените свои действия.',
                                                    buttons: Ext.MessageBox.OKCANCEL,
                                                    icon: Ext.MessageBox.ERROR,
                                                    buttonText:{
                                                        ok:'подтвеждаю',
                                                        cancel:'отмена'
                                                    },
                                                    fn:function(btn,newValue){
                                                        if(btn=='ok'){
                                                            QueryKassa.delOplata(value,function(results){
                                                                if(results.success==="1"){

                                                                    Ext.MessageBox.show({
                                                                        title: 'Удаление записи об оплате ',
                                                                        msg: results.msg,
                                                                        buttons: Ext.MessageBox.OK,
                                                                        icon: Ext.MessageBox.INFO
                                                                    });
                                                                    stTekNachKassa.load({
                                                                        params: {
                                                                            login:value.login,
                                                                            password:value.password,
                                                                            what_id: value.filial_id,
                                                                            filial_id: value.filial_id,
                                                                            what:'TekNachAllOrg'
                                                                        },
                                                                        callback: function(rec,operation,succ){
                                                                            if(succ){
                                                                                fmTekNachKassa.down('#printRaschListokOrg').setDisabled(false);
                                                                                fmTekNachKassa.down('#DoAllOrg').setDisabled(false);
                                                                                fmTekNachKassa.down('#DoAllResetOrg').setDisabled(false);
                                                                                fmTekNachKassa.down('#NextAllResetOrg').setDisabled(false);
                                                                                fmTekNachKassa.down('#NextAllOrg').setDisabled(false);
                                                                                fmTekNachKassa.getForm().loadRecord(rec[0]);
                                                                            }
                                                                        },
                                                                        scope:this
                                                                    });
                                                                    store.load({
                                                                        params: {
                                                                            what:'OplataFilial',
                                                                            filial_id: values.get('filial_id'),
                                                                            login:values.get('login'),
                                                                            password:values.get('password')
                                                                        },
                                                                        scope:this
                                                                    });
                                                                    me.doAllResetKassa1();

                                                                } else {
                                                                    Ext.MessageBox.show({
                                                                        title: 'Удаление записи об оплате',
                                                                        msg: results.msg,
                                                                        buttons: Ext.MessageBox.OK,
                                                                        icon: Ext.MessageBox.ERROR
                                                                    });
                                                                }
                                                            });
                                                        }
                                                    }
                                                });
                                            },
                                            icon: 'resources/css/images/ico/no.png',
                                            tooltip: 'Удалить  запись '
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'panel',
                            title: '',
                            items: [
                                {
                                    xtype: 'form',
                                    height: 220,
                                    id: 'fmTekNachKassaOrg',
                                    width: 910,
                                    layout: 'fit',
                                    bodyPadding: 10,
                                    title: '',
                                    items: [
                                        {
                                            xtype: 'fieldset',
                                            height: 279,
                                            padding: 10,
                                            style: 'background-color: #DCDCDC;',
                                            width: 748,
                                            layout: 'absolute',
                                            title: '',
                                            items: [
                                                {
                                                    xtype: 'checkboxfield',
                                                    x: 85,
                                                    y: 30,
                                                    style: 'color: #8A8A8A; text-shadow: -1px -1px white, 1px 1px #333;font-size:12pt;',
                                                    fieldLabel: '',
                                                    labelAlign: 'right',
                                                    labelWidth: 60,
                                                    name: 'cbDo1',
                                                    boxLabel: '',
                                                    inputValue: '1',
                                                    listeners: {
                                                        change: 'onCbDo1Change1'
                                                    }
                                                },
                                                {
                                                    xtype: 'checkboxfield',
                                                    x: 85,
                                                    y: 55,
                                                    style: 'color: #8A8A8A; text-shadow: -1px -1px white, 1px 1px #333;font-size:12pt;',
                                                    fieldLabel: '',
                                                    labelPad: 10,
                                                    labelWidth: 60,
                                                    name: 'cbDo2',
                                                    boxLabel: '',
                                                    inputValue: '1',
                                                    listeners: {
                                                        change: 'onCbDo2Change1'
                                                    }
                                                },
                                                {
                                                    xtype: 'checkboxfield',
                                                    x: 85,
                                                    y: 80,
                                                    style: 'color: #8A8A8A; text-shadow: -1px -1px white, 1px 1px #333;font-size:12pt;',
                                                    fieldLabel: '',
                                                    labelPad: 10,
                                                    labelWidth: 60,
                                                    name: 'cbDo3',
                                                    boxLabel: '',
                                                    inputValue: '1',
                                                    listeners: {
                                                        change: 'onCbDo3Change1'
                                                    }
                                                },
                                                {
                                                    xtype: 'checkboxfield',
                                                    x: 85,
                                                    y: 105,
                                                    style: 'color: #8A8A8A; text-shadow: -1px -1px white, 1px 1px #333;font-size:12pt;',
                                                    fieldLabel: '',
                                                    labelPad: 10,
                                                    labelWidth: 60,
                                                    name: 'cbDo4',
                                                    boxLabel: '',
                                                    inputValue: '1',
                                                    listeners: {
                                                        change: 'onCbDo4Change1'
                                                    }
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 30,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period1',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 55,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period2',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 80,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period3',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 105,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period4',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'button',
                                                    x: 80,
                                                    y: 130,
                                                    height: 25,
                                                    id: 'DoAllOrg',
                                                    width: 25,
                                                    icon: 'resources/css/images/ico/s_okay.png',
                                                    text: '',
                                                    tooltip: 'Выбрать задолженность за предыдущий период',
                                                    listeners: {
                                                        click: 'onDoAllClickOrg'
                                                    }
                                                },
                                                {
                                                    xtype: 'button',
                                                    x: 590,
                                                    y: 130,
                                                    height: 25,
                                                    id: 'NextAllOrg',
                                                    width: 25,
                                                    icon: 'resources/css/images/ico/s_okay.png',
                                                    text: '',
                                                    tooltip: 'Выбрать задолженность за текущий период',
                                                    listeners: {
                                                        click: 'onNextAllClickOrg'
                                                    }
                                                },
                                                {
                                                    xtype: 'button',
                                                    x: 590,
                                                    y: 0,
                                                    height: 25,
                                                    id: 'NextAllResetOrg',
                                                    width: 25,
                                                    icon: 'resources/css/images/ico/s_cancel.png',
                                                    text: '',
                                                    tooltip: 'Очистить все выбранное',
                                                    listeners: {
                                                        click: 'onNextAllResetOrgClick'
                                                    }
                                                },
                                                {
                                                    xtype: 'button',
                                                    x: 80,
                                                    y: 0,
                                                    height: 25,
                                                    id: 'DoAllResetOrg',
                                                    width: 25,
                                                    icon: 'resources/css/images/ico/s_cancel.png',
                                                    text: '',
                                                    tooltip: 'Очистить все выбранное',
                                                    listeners: {
                                                        click: 'onDoAllResetOrgClick'
                                                    }
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 115,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Задол'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 30,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Вода'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 55,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Стоки'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 80,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Подог'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 105,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Отопл'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 135,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Итого'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 210,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 85,
                                                    text: 'Период'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 310,
                                                    y: 0,
                                                    height: 20,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Начисл'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 400,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Оплата'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 500,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Долг'
                                                },
                                                {
                                                    xtype: 'combobox',
                                                    anchor: '100%',
                                                    x: 670,
                                                    y: 0,
                                                    width: 200,
                                                    fieldLabel: 'приход',
                                                    labelWidth: 50,
                                                    name: 'prixod_id',
                                                    displayField: 'prixod',
                                                    forceSelection: true,
                                                    queryMode: 'local',
                                                    store: 'StPrixod',
                                                    typeAhead: true,
                                                    valueField: 'prixod_id'
                                                },
                                                {
                                                    xtype: 'checkboxfield',
                                                    x: 595,
                                                    y: 30,
                                                    fieldLabel: '',
                                                    name: 'cbNext1',
                                                    boxLabel: '',
                                                    inputValue: '1',
                                                    listeners: {
                                                        change: 'onCbNext1Change1'
                                                    }
                                                },
                                                {
                                                    xtype: 'checkboxfield',
                                                    x: 595,
                                                    y: 55,
                                                    fieldLabel: '',
                                                    name: 'cbNext2',
                                                    boxLabel: '',
                                                    inputValue: '1',
                                                    listeners: {
                                                        change: 'onCbNext2Change1'
                                                    }
                                                },
                                                {
                                                    xtype: 'checkboxfield',
                                                    x: 595,
                                                    y: 80,
                                                    fieldLabel: '',
                                                    name: 'cbNext3',
                                                    boxLabel: '',
                                                    inputValue: '1',
                                                    listeners: {
                                                        change: 'onCbNext3Change1'
                                                    }
                                                },
                                                {
                                                    xtype: 'checkboxfield',
                                                    x: 595,
                                                    y: 105,
                                                    fieldLabel: '',
                                                    name: 'cbNext4',
                                                    boxLabel: '',
                                                    inputValue: '1',
                                                    listeners: {
                                                        change: 'onCbNext4Change1'
                                                    }
                                                },
                                                {
                                                    xtype: 'button',
                                                    handler: function(button, e) {
                                                        // in use
                                                        var me = this;
                                                        //STORE

                                                        var stUser = Ext.data.StoreManager.get("StUser");
                                                        var stTekNachKassa = Ext.data.StoreManager.get("StTekNachKassaOrg");
                                                        var stTekOplata = Ext.data.StoreManager.get("StOplataFilial");//QueryKassa.getResults

                                                        //LOGIN & PASSWORD

                                                        var values =stUser.getAt(0);
                                                        var params = {
                                                            login:values.get('login'),
                                                            password:values.get('password'),
                                                            filial_id:values.get('filial_id'),
                                                            user_id:values.get('user_id'),
                                                            kassa_id:values.get('prixod_id'),
                                                            what:'OrgTekOplata'

                                                        };

                                                        //FORMA
                                                        var fmTekNachKassa = Ext.getCmp('fmTekNachKassaOrg');
                                                        var value = fmTekNachKassa.getValues();
                                                        fmTekNachKassa.down('#insTekPokKassaOrg').setDisabled(true);
                                                        //LOGIKA

                                                        Ext.Object.merge(value, params);
                                                        //console.log(value);



                                                        QueryKassa.newOplata(value,function(results){
                                                            if (results.success === "1"){
                                                                stTekOplata.load({
                                                                    params: {
                                                                        what:'OplataFilial',
                                                                        login:value.login,
                                                                        password:value.password,
                                                                        what_id: value.filial_id,
                                                                        filial_id: value.filial_id
                                                                    },
                                                                    scope:this
                                                                });
                                                                stTekNachKassa.load({
                                                                    params: {
                                                                        login:value.login,
                                                                        password:value.password,
                                                                        what_id: value.filial_id,
                                                                        filial_id: value.filial_id,
                                                                        what:'TekNachAllOrg'
                                                                    },
                                                                    callback: function(rec,operation,succ){
                                                                        if(succ){
                                                                            fmTekNachKassa.down('#printRaschListokOrg').setDisabled(false);
                                                                            fmTekNachKassa.down('#DoAllOrg').setDisabled(false);
                                                                            fmTekNachKassa.down('#DoAllResetOrg').setDisabled(false);
                                                                            fmTekNachKassa.down('#NextAllResetOrg').setDisabled(false);
                                                                            fmTekNachKassa.down('#NextAllOrg').setDisabled(false);
                                                                            fmTekNachKassa.getForm().loadRecord(rec[0]);
                                                                        }
                                                                    },
                                                                    scope:this
                                                                });
                                                                Ext.MessageBox.show({title: 'Ввод оплаты ',
                                                                    msg: results.msg,
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.INFO
                                                                });

                                                                me.doAllResetKassa();

                                                            }else{
                                                                Ext.MessageBox.show({title: 'Ввод оплаты',
                                                                    msg: results.msg,
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.ERROR
                                                                });
                                                                fmTekNachKassa.getForm().findField('newOplataOrg').setValue(0).focus();

                                                            }
                                                        });
                                                    },
                                                    doAllResetKassa: function() {
                                                        //STORE

                                                        var stUser = Ext.data.StoreManager.get("StUser");
                                                        var values =stUser.getAt(0);
                                                        var prixod_id =values.get('prixod_id');
                                                        //console.log(prixod_id);

                                                        var form = Ext.getCmp('fmTekNachKassaOrg');
                                                        form.down('#DoAllOrg').setDisabled(false);
                                                        form.down('#DoAllResetOrg').setDisabled(true);
                                                        form.down('#NextAllResetOrg').setDisabled(true);
                                                        form.down('#NextAllOrg').setDisabled(false);
                                                        form.getForm().findField('cbNext1').setDisabled(false).setValue(false);
                                                        form.getForm().findField('cbNext2').setDisabled(false).setValue(false);
                                                        form.getForm().findField('cbNext3').setDisabled(false).setValue(false);
                                                        form.getForm().findField('cbNext4').setDisabled(false).setValue(false);
                                                        form.getForm().findField('cbDo1').setDisabled(false).setValue(false);
                                                        form.getForm().findField('cbDo2').setDisabled(false).setValue(false);
                                                        form.getForm().findField('cbDo3').setDisabled(false).setValue(false);
                                                        form.getForm().findField('cbDo4').setDisabled(false).setValue(false);
                                                        form.getForm().findField('zadol1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('period1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('nachisleno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('oplacheno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('dolg1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('zadol2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('period2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('nachisleno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('oplacheno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('dolg2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('zadol3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('period3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('nachisleno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('oplacheno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('dolg3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('zadol4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('period4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('nachisleno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('oplacheno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
                                                        form.getForm().findField('dolg4').setFieldStyle('background-color: #F0F8FF; background-image: none;');


                                                        var newOplata = form.getForm().findField('newOplataOrg').setValue(0);

                                                    },
                                                    anchor: '100%',
                                                    x: 750,
                                                    y: 120,
                                                    shadowOffset: 2,
                                                    border: '2px',
                                                    disabled: true,
                                                    height: 30,
                                                    id: 'insTekPokKassaOrg',
                                                    width: 130,
                                                    icon: 'resources/css/images/ico/yes22.png',
                                                    text: 'ввод оплаты'
                                                },
                                                {
                                                    xtype: 'datefield',
                                                    anchor: '100%',
                                                    x: 670,
                                                    y: 40,
                                                    width: 200,
                                                    fieldLabel: 'дата оплаты',
                                                    labelWidth: 90,
                                                    name: 'date_oplata',
                                                    format: 'd-m-Y',
                                                    submitFormat: 'Y-m-d'
                                                },
                                                {
                                                    xtype: 'button',
                                                    handler: function(button, e) {
                                                        //in use
                                                        var me = this;
                                                        var StUser = Ext.data.StoreManager.get("StUser");
                                                        var values =StUser.getAt(0);
                                                        var filial_id = values.data.filial_id;
                                                        var raion_id = values.data.raion_id;
                                                        //console.log(values);
                                                        var usertype = 1;

                                                        var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();
                                                        if (filial_id) {
                                                            var report = 'raspechatkaOplataOrg';
                                                            var namereport = 'Расчетка';
                                                            var value = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                report:report,
                                                                what:report,
                                                                filial_id: filial_id
                                                            };
                                                            var tab = tabPnCenter.child('#'+report);
                                                            if (!tab) {
                                                                tab  = tabPnCenter.add({
                                                                    xtype:'tabreportorg',
                                                                    title:namereport,
                                                                    id:''+report+''
                                                                });

                                                            }
                                                            tabPnCenter.setActiveTab(tab);
                                                            var reppan = tab.getComponent(0);
                                                            // Basic mask:
                                                            var myMask = Ext.Msg.show({
                                                                title:'Расчетный листок...',
                                                                msg: 'Загрузка ...',
                                                                buttons: Ext.Msg.CANCEL,
                                                                wait: true,
                                                                modal: true,
                                                                icon: Ext.Msg.INFO
                                                            });

                                                            QueryKassa.getRaspechatka(value,function(data){
                                                                if (data){
                                                                    reppan.update(data.content);
                                                                    Ext.REPORTCONTENT =data.content;
                                                                    Ext.REPORTSQL =data.sql;
                                                                    Ext.REPORTTITLE =report;
                                                                    myMask.close();

                                                                } else {
                                                                    myMask.close();
                                                                    Ext.MessageBox.show({
                                                                        title: 'Ошибка ',
                                                                        msg: 'Документ не создан',
                                                                        buttons: Ext.MessageBox.OK,
                                                                        icon: Ext.MessageBox.ERROR
                                                                    });
                                                                }
                                                            });


                                                        }
                                                    },
                                                    x: 675,
                                                    y: 110,
                                                    disabled: true,
                                                    id: 'printRaschListokOrg',
                                                    icon: 'resources/css/images/ico/print_printer.png',
                                                    scale: 'large',
                                                    text: '',
                                                    tooltip: 'Печать расчетного листка'
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg1',
                                                    x: 490,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg2',
                                                    x: 490,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg3',
                                                    x: 490,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg4',
                                                    x: 490,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 490,
                                                    y: 130
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno1',
                                                    x: 395,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno2',
                                                    x: 395,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno3',
                                                    x: 395,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno4',
                                                    x: 395,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 395,
                                                    y: 130
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno1',
                                                    x: 300,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno2',
                                                    x: 300,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno3',
                                                    x: 300,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno4',
                                                    x: 300,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 300,
                                                    y: 130
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol1',
                                                    x: 115,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol2',
                                                    x: 115,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol3',
                                                    x: 115,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol4',
                                                    x: 115,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 115,
                                                    y: 130
                                                },
                                                {
                                                    xtype: 'numberfield',
                                                    anchor: '100%',
                                                    x: 670,
                                                    y: 80,
                                                    disabled: true,
                                                    id: 'newOplataKassaOrg',
                                                    width: 200,
                                                    fieldLabel: 'к оплате',
                                                    labelWidth: 90,
                                                    name: 'newOplataOrg',
                                                    value: 0,
                                                    fieldStyle: 'color: red;font-size:12pt;font-weight:bold;text-align:right;',
                                                    hideTrigger: true,
                                                    selectOnFocus: true,
                                                    minValue: 0.01,
                                                    listeners: {
                                                        validitychange: 'onNewOplataKassaOrgValidityChange'
                                                    }
                                                },
                                                {
                                                    xtype: 'checkboxfield',
                                                    handler: function(checkbox, checked) {
                                                        var form = checkbox.findParentByType('form');
                                                        if(checked){

                                                            form.down('#printRaschListokOrg').setDisabled(false);

                                                        }else{

                                                            form.down('#printRaschListokOrg').setDisabled(true);

                                                        }
                                                    },
                                                    x: 725,
                                                    y: 120
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'form',
                                    height: 204,
                                    id: 'fmTekNachKassaOrg1',
                                    width: 910,
                                    layout: 'fit',
                                    bodyPadding: 10,
                                    title: '',
                                    items: [
                                        {
                                            xtype: 'fieldset',
                                            height: 230,
                                            style: 'background-color: #DCDCDC;',
                                            width: 690,
                                            layout: 'absolute',
                                            title: '',
                                            items: [
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 30,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period1',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 55,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period2',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 80,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period3',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 105,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period4',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 115,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Задол'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 30,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Вода'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 55,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Стоки'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 80,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Подог'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 105,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Отопл'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 133,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Итого'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 210,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 85,
                                                    text: 'Период'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 310,
                                                    y: 0,
                                                    height: 20,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Начисл'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 400,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Оплата'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 500,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Долг'
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg1',
                                                    x: 490,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg2',
                                                    x: 490,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg3',
                                                    x: 490,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg4',
                                                    x: 490,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 490,
                                                    y: 133
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno1',
                                                    x: 395,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno2',
                                                    x: 395,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno3',
                                                    x: 395,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno4',
                                                    x: 395,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 395,
                                                    y: 133
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno1',
                                                    x: 300,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno2',
                                                    x: 300,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno3',
                                                    x: 300,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno4',
                                                    x: 300,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 300,
                                                    y: 133
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol1',
                                                    x: 115,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol2',
                                                    x: 115,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol3',
                                                    x: 115,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol4',
                                                    x: 115,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 115,
                                                    y: 133
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'form',
                                    height: 204,
                                    id: 'fmTekNachKassaOrg2',
                                    width: 910,
                                    layout: 'fit',
                                    bodyPadding: 10,
                                    title: '',
                                    items: [
                                        {
                                            xtype: 'fieldset',
                                            height: 230,
                                            style: 'background-color: #DCDCDC;',
                                            width: 690,
                                            layout: 'absolute',
                                            title: '',
                                            items: [
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 30,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period1',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 55,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period2',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 80,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period3',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    x: 210,
                                                    y: 105,
                                                    width: 85,
                                                    fieldLabel: '',
                                                    labelAlign: 'top',
                                                    name: 'period4',
                                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 115,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Задол'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 30,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Вода'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 55,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Стоки'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 80,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Подог'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 105,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Отопл'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 10,
                                                    y: 133,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:left',
                                                    width: 60,
                                                    text: 'Итого'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 210,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 85,
                                                    text: 'Период'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 310,
                                                    y: 0,
                                                    height: 20,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Начисл'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 400,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Оплата'
                                                },
                                                {
                                                    xtype: 'label',
                                                    x: 500,
                                                    y: 0,
                                                    style: 'font-weight:bold;font-size:12pt;text-align:center',
                                                    width: 75,
                                                    text: 'Долг'
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg1',
                                                    x: 490,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg2',
                                                    x: 490,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg3',
                                                    x: 490,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg4',
                                                    x: 490,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'dolg',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 490,
                                                    y: 133
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno1',
                                                    x: 395,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno2',
                                                    x: 395,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno3',
                                                    x: 395,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno4',
                                                    x: 395,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'oplacheno',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 395,
                                                    y: 133
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno1',
                                                    x: 300,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno2',
                                                    x: 300,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno3',
                                                    x: 300,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno4',
                                                    x: 300,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'nachisleno',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 300,
                                                    y: 133
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol1',
                                                    x: 115,
                                                    y: 30
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol2',
                                                    x: 115,
                                                    y: 55
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol3',
                                                    x: 115,
                                                    y: 80
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol4',
                                                    x: 115,
                                                    y: 105
                                                },
                                                {
                                                    xtype: 'nfield',
                                                    width: 90,
                                                    name: 'zadol',
                                                    fieldStyle: 'background-color: #C2D9E9;font-size:12pt;font-weight:bold;text-align:right;',
                                                    x: 115,
                                                    y: 133
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'form',
                    height: 446,
                    id: 'tabFmFilialVoda',
                    minHeight: 300,
                    layout: 'absolute',
                    title: 'Вода',
                    items: [
                        {
                            xtype: 'fieldset',
                            x: 265,
                            y: 5,
                            height: 425,
                            style: 'background-color: #DCDCDC;',
                            width: 185,
                            title: 'Сальдо',
                            items: [
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var form = button.findParentByType('form').getForm();
                                        var grNach = Ext.getCmp('grNachVodaFilial');
                                        var record = grNach.getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(record);
                                        grNach.getView().getSelectionModel().clearSelections();
                                        grNach.getView().getSelectionModel().select(ind);
                                    },
                                    anchor: '100%',
                                    formBind: true,
                                    icon: 'resources/css/images/ico/xsldbg_refresh.png',
                                    text: 'Восстановить',
                                    tooltip: 'восстановить данные'
                                },
                                {
                                    xtype: 'datefield',
                                    anchor: '100%',
                                    border: '0px',
                                    margin: 0,
                                    style: 'background-color: #e0e0e0;',
                                    width: 150,
                                    fieldLabel: 'Период начисления',
                                    labelAlign: 'top',
                                    labelWidth: 50,
                                    name: 'data',
                                    fieldStyle: 'color: #1791e6; text-shadow: -1px -1px white, 1px 1px #333;font-size:14pt;text-align:center',
                                    hideTrigger: true,
                                    format: 'F,Y',
                                    startDay: 1,
                                    submitFormat: 'Ymd'
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'Сальдо на начало',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'zadol',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'Начислено',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'nachisleno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'НДС',
                                    labelWidth: 45,
                                    name: 'nds',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'Итого',
                                    labelWidth: 45,
                                    name: 'itogo',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'Оплачено',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'oplacheno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'Сальдо на конец',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'dolg',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        // in use
                                        var me = this;

                                        //STORE
                                        var StTekNach = Ext.data.StoreManager.get("StTekNach");
                                        var stTekNachFilial = Ext.data.StoreManager.get("StTekNachFilial");
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var values =stUser.getAt(0);
                                        var params = {
                                            login:values.get('login'),
                                            password:values.get('password'),
                                            org_id:values.get('org_id'),
                                            filial_id:values.get('filial_id'),
                                            what:'FilialVodaIns'
                                        };
                                        //console.log(values.data.login);
                                        //FORMA
                                        var form = Ext.getCmp('tabFmFilialVoda');
                                        var value = form.getForm().getValues();
                                        var grNach = Ext.getCmp('grNachVodaFilial');
                                        var record = grNach.getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(record);

                                        //LOGIKA
                                        Ext.Object.merge(value, params);

                                        QueryOrg.updateRecords(value,function(results){

                                            stTekNachFilial.load({
                                                params: {
                                                    what:'VodaFilial',
                                                    filial_id: value.filial_id,
                                                    data: value.data,
                                                    login:value.login,
                                                    password:value.password
                                                },
                                                callback: function(records,operation,success){
                                                    if(success){
                                                        grNach.getView().getSelectionModel().select(ind);

                                                    }else{
                                                        form.getForm().reset();
                                                    }
                                                },
                                                scope:this
                                            });

                                        });
                                    },
                                    anchor: '100%',
                                    formBind: true,
                                    icon: 'resources/css/images/ico/yes22.png',
                                    text: 'Записать'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 455,
                            y: 240,
                            height: 120,
                            style: 'background-color: #DCDCDC;',
                            width: 445,
                            layout: 'absolute',
                            title: 'Перерасчет',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 270,
                                    y: 0,
                                    width: 145,
                                    fieldLabel: 'Сумма',
                                    labelWidth: 50,
                                    name: 'perer',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 0,
                                    y: 0,
                                    width: 130,
                                    fieldLabel: 'Кубов',
                                    labelWidth: 55,
                                    name: 'pkub',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'textareafield',
                                    x: 5,
                                    y: 30,
                                    width: 285,
                                    fieldLabel: 'инфо',
                                    labelWidth: 40,
                                    name: 'note',
                                    fieldStyle: 'background-color:#F0F8FF;',
                                    grow: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var fmInfoNachOrg = Ext.getCmp('fmInfoNachFilial').getForm();
                                        var form = button.findParentByType('form').getForm();
                                        var zadol = form.findField('zadol').getValue();
                                        var ptarif = form.findField('ptarif').getValue();
                                        var tarifOrg = fmInfoNachOrg.findField('tarif_xv').getValue();
                                        var per= form.findField('perer').getValue();

                                        var pkub = form.findField('pkub').getValue();
                                        var xvoda = form.findField('xvoda').getValue();
                                        var norma_xv = form.findField('norma_xv').getValue();
                                        var oplacheno = form.findField('oplacheno').getValue();
                                        var tarif = 0;
                                        var nachisleno = 0;
                                        var perer = 0;





                                        if (pkub!==0 ) {
                                            var perer= pkub * tarif ;
                                            var nachisleno = xvoda + norma_xv + perer;
                                            var nds = (xvoda + norma_xv + perer) * 0.2;
                                            var itogo = nachisleno + nds;
                                            form.findField('perer').setValue(perer);
                                            form.findField('nachisleno').setValue(nachisleno);
                                            form.findField('nds').setValue(nds);
                                            form.findField('itogo').setValue(itogo);
                                            form.findField('dolg').setValue(zadol + itogo - oplacheno);
                                        } else {
                                            var nachisleno = xvoda + norma_xv  + per;
                                            var nds = (xvoda + norma_xv +  per) * 0.2;
                                            var itogo = nachisleno + nds;
                                            form.findField('nachisleno').setValue(nachisleno);
                                            form.findField('nds').setValue(nds);
                                            form.findField('itogo').setValue(itogo);
                                            form.findField('dolg').setValue(zadol + itogo - oplacheno);
                                        }
                                    },
                                    x: 310,
                                    y: 55,
                                    formBind: true,
                                    width: 110,
                                    icon: 'resources/css/images/ico/kbruch.png',
                                    text: 'Просчитать'
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 140,
                                    y: 0,
                                    width: 125,
                                    fieldLabel: 'тариф',
                                    labelWidth: 40,
                                    name: 'ptarif',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 4
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 455,
                            y: 145,
                            height: 90,
                            style: 'background-color: #DCDCDC;',
                            width: 445,
                            layout: 'absolute',
                            title: 'Начислено по счетчикам',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 0,
                                    y: 0,
                                    width: 130,
                                    fieldLabel: 'Куб Хв',
                                    labelWidth: 55,
                                    name: 'xkub',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 140,
                                    y: 0,
                                    width: 115,
                                    fieldLabel: 'тариф',
                                    labelWidth: 40,
                                    name: 'tarif',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 4
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 270,
                                    y: 0,
                                    width: 145,
                                    fieldLabel: 'Хвода',
                                    labelWidth: 50,
                                    name: 'xvoda',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var fmInfoNachOrg = Ext.getCmp('fmInfoNachFilial').getForm();
                                        var form = button.findParentByType('form').getForm();
                                        var zadol = form.findField('zadol').getValue();
                                        var ptarif = form.findField('tarif').getValue();
                                        var tarifOrg = fmInfoNachOrg.findField('tarif_xv').getValue();

                                        var kub_xv = form.findField('xkub').getValue();

                                        var perer = form.findField('perer').getValue();
                                        var norma_xv = form.findField('norma_xv').getValue();
                                        var oplacheno = form.findField('oplacheno').getValue();
                                        var tarif = 0;
                                        var nachisleno = 0;

                                        if (ptarif !==0) {
                                            tarif = ptarif;
                                        }else{
                                            tarif = tarifOrg;
                                        }
                                        form.findField('ptarif').setValue(tarif);


                                        if (tarif===0) {

                                            Ext.MessageBox.show({
                                                title: 'Проверка тарифа',
                                                msg: 'Введите тариф ',
                                                buttons: Ext.MessageBox.OK,
                                                icon: Ext.MessageBox.INFO
                                            });
                                        } else {
                                            var xv= kub_xv * tarif ;
                                            form.findField('xvoda').setValue(xv);
                                            var nachisleno = xv + norma_xv  + perer;
                                            var nds = (xv + norma_xv  + perer)* 0.2;
                                            var itogo = nachisleno + nds;
                                            form.findField('nachisleno').setValue(nachisleno);
                                            form.findField('nds').setValue(nds);
                                            form.findField('itogo').setValue(itogo);
                                            form.findField('dolg').setValue(zadol + itogo - oplacheno);
                                        }
                                    },
                                    x: 275,
                                    y: 35,
                                    formBind: true,
                                    width: 130,
                                    icon: 'resources/css/images/ico/kbruch.png',
                                    text: 'Просчитать'
                                }
                            ]
                        },
                        {
                            xtype: 'gridpanel',
                            x: 10,
                            y: 10,
                            height: 445,
                            id: 'grNachVodaFilial',
                            scrollable: true,
                            width: 245,
                            title: 'Период начисления',
                            store: 'StTekNachFilial',
                            viewConfig: {
                                emptyText: 'нет начислений'
                            },
                            columns: [
                                {
                                    xtype: 'numbercolumn',
                                    hidden: true,
                                    dataIndex: 'address_id',
                                    text: 'Address_id'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    width: 50,
                                    dataIndex: 'god',
                                    menuDisabled: true,
                                    text: 'год',
                                    format: '0'
                                },
                                {
                                    xtype: 'datecolumn',
                                    width: 80,
                                    dataIndex: 'data',
                                    menuDisabled: true,
                                    text: 'месяц',
                                    format: 'F'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'zadol',
                                    menuDisabled: true,
                                    text: 'задол'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 49,
                                    dataIndex: 'mec',
                                    menuDisabled: true,
                                    text: 'мес'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 62,
                                    dataIndex: 'period',
                                    menuDisabled: true,
                                    text: 'Период'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'nachisleno',
                                    menuDisabled: true,
                                    text: 'начисл'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'oplacheno',
                                    menuDisabled: true,
                                    text: 'оплач'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    width: 104,
                                    align: 'right',
                                    dataIndex: 'dolg',
                                    menuDisabled: true,
                                    text: 'Долг'
                                }
                            ],
                            tools: [
                                {
                                    xtype: 'tool',
                                    callback: function(owner, tool, event) {
                                        //STORE
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var StTekNach = Ext.data.StoreManager.get("StTekNachFilial");
                                        //LOGIN & PASSWORD
                                        var values =stUser.getAt(0);
                                        // FORM
                                        var form = tool.findParentByType('form');
                                        // DATA

                                        //LOGIKA
                                        StTekNach.load({
                                            params: {
                                                what:'VodaFilialAll',
                                                filial_id: values.get('filial_id'),
                                                login:values.get('login'),
                                                password:values.get('password')
                                            },
                                            callback: function(records,operation,success){
                                                if(success){
                                                    form.getForm().reset();
                                                    form.getForm().loadRecord(records[0]);
                                                }else{
                                                    form.getForm().reset();
                                                }
                                            },
                                            scope:this
                                        });

                                    },
                                    tooltip: 'выбрать все записи',
                                    type: 'plus'
                                }
                            ]
                        },
                        {
                            xtype: 'button',
                            x: 565,
                            y: 380,
                            id: 'btnAktSverkiFilialVik',
                            width: 215,
                            icon: 'resources/css/images/ico/printer24.png',
                            scale: 'medium',
                            text: 'Акт сверки'
                        },
                        {
                            xtype: 'fieldcontainer',
                            x: 455,
                            y: 15,
                            height: 125,
                            style: 'background-color: #DCDCDC;',
                            width: 440,
                            layout: 'absolute',
                            fieldLabel: 'Начислено по норме',
                            labelAlign: 'top',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 230,
                                    y: 0,
                                    width: 80,
                                    fieldLabel: 'Куб Хв',
                                    labelAlign: 'top',
                                    name: 'xkubn',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 320,
                                    y: 0,
                                    width: 95,
                                    fieldLabel: 'Хвода норма',
                                    labelAlign: 'top',
                                    name: 'norma_xv',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 145,
                                    y: 0,
                                    width: 80,
                                    fieldLabel: 'Нор.рх_Хв',
                                    labelAlign: 'top',
                                    name: 'nrx_xv_d',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 10,
                                    y: 27,
                                    width: 130,
                                    fieldLabel: 'Дней_Хв',
                                    labelWidth: 60,
                                    name: 'day_xv',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 10,
                                    y: 57,
                                    width: 130,
                                    fieldLabel: 'человек',
                                    labelWidth: 60,
                                    name: 'people',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var fmInfoNachOrg = Ext.getCmp('fmInfoNachFilial').getForm();
                                        var form = button.findParentByType('form').getForm();
                                        var zadol = form.findField('zadol').getValue();
                                        var ptarif = form.findField('tarif').getValue();
                                        var tarifOrg = fmInfoNachOrg.findField('tarif_xv').getValue();
                                        var xvoda = form.findField('xvoda').getValue();
                                        var perer = form.findField('perer').getValue();
                                        var nrxv = form.findField('nrx_xv_d').getValue();
                                        var day_xv = form.findField('day_xv').getValue();
                                        var kub_xv = form.findField('xkubn').getValue();

                                        var oplacheno = form.findField('oplacheno').getValue();
                                        var tarif = 0;
                                        var nachisleno = 0;

                                        if (ptarif !==0) {
                                            tarif = ptarif;
                                        }else{
                                            tarif = tarifOrg;
                                        }
                                        form.findField('ptarif').setValue(tarif);


                                        if (tarif===0) {

                                            Ext.MessageBox.show({
                                                title: 'Проверка тарифа',
                                                msg: 'Введите тариф ',
                                                buttons: Ext.MessageBox.OK,
                                                icon: Ext.MessageBox.INFO
                                            });
                                        } else {
                                            var xv= kub_xv * tarif ;
                                            form.findField('norma_xv').setValue(xv);
                                            var nachisleno = xv + xvoda  + perer;
                                            var nds = (xv +  xvoda  + perer)* 0.2;
                                            var itogo = nachisleno + nds;
                                            form.findField('nachisleno').setValue(nachisleno);
                                            form.findField('nds').setValue(nds);
                                            form.findField('itogo').setValue(itogo);
                                            form.findField('dolg').setValue(zadol + itogo - oplacheno);
                                        }
                                    },
                                    x: 285,
                                    y: 55,
                                    formBind: true,
                                    width: 130,
                                    icon: 'resources/css/images/ico/kbruch.png',
                                    text: 'Просчитать'
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'form',
                    height: 446,
                    id: 'tabFmFilialStoki',
                    minHeight: 300,
                    layout: 'absolute',
                    title: 'Стоки',
                    items: [
                        {
                            xtype: 'fieldset',
                            x: 265,
                            y: 5,
                            height: 435,
                            style: 'background-color: #DCDCDC;',
                            width: 185,
                            title: 'Сальдо',
                            items: [
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var form = button.findParentByType('form').getForm();
                                        var grNach = Ext.getCmp('grNachStokiFilial');
                                        var record = grNach.getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(record);
                                        grNach.getView().getSelectionModel().clearSelections();
                                        grNach.getView().getSelectionModel().select(ind);
                                    },
                                    anchor: '100%',
                                    formBind: true,
                                    icon: 'resources/css/images/ico/xsldbg_refresh.png',
                                    text: 'Восстановить',
                                    tooltip: 'восстановить данные'
                                },
                                {
                                    xtype: 'datefield',
                                    anchor: '100%',
                                    border: '0px',
                                    margin: 0,
                                    style: 'background-color: #e0e0e0;',
                                    width: 150,
                                    fieldLabel: 'Период начисления',
                                    labelAlign: 'top',
                                    labelWidth: 50,
                                    name: 'data',
                                    fieldStyle: 'color: #1791e6; text-shadow: -1px -1px white, 1px 1px #333;font-size:14pt;text-align:center',
                                    hideTrigger: true,
                                    format: 'F,Y',
                                    startDay: 1,
                                    submitFormat: 'Ymd'
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'Сальдо на начало',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'zadol',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'Начислено',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'nachisleno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'НДС',
                                    labelWidth: 45,
                                    name: 'nds',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'Итого',
                                    labelWidth: 45,
                                    name: 'itogo',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'Оплачено',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'oplacheno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 119,
                                    fieldLabel: 'Сальдо на конец',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'dolg',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        // in use
                                        var me = this;

                                        //STORE
                                        var StTekNach = Ext.data.StoreManager.get("StTekNach");
                                        var stTekNachFilial = Ext.data.StoreManager.get("StTekNachFilial");
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var values =stUser.getAt(0);
                                        var params = {
                                            login:values.get('login'),
                                            password:values.get('password'),
                                            org_id:values.get('org_id'),
                                            filial_id:values.get('filial_id'),
                                            what:'FilialStokiIns'
                                        };
                                        //console.log(values.data.login);
                                        //FORMA
                                        var form = Ext.getCmp('tabFmFilialStoki');
                                        var value = form.getForm().getValues();
                                        var grNach = Ext.getCmp('grNachStokiFilial');
                                        var record = grNach.getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(record);
                                        //LOGIKA
                                        Ext.Object.merge(value, params);

                                        QueryOrg.updateRecords(value,function(results){

                                            stTekNachFilial.load({
                                                params: {
                                                    what:'StokiFilial',
                                                    filial_id: value.filial_id,
                                                    data: value.data,
                                                    login:value.login,
                                                    password:value.password
                                                },
                                                callback: function(records,operation,success){
                                                    if(success){
                                                        grNach.getView().getSelectionModel().select(ind);

                                                    }else{
                                                        form.getForm().reset();
                                                    }
                                                },
                                                scope:this
                                            });

                                        });

                                    },
                                    anchor: '100%',
                                    formBind: true,
                                    icon: 'resources/css/images/ico/yes22.png',
                                    text: 'Записать'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 460,
                            y: 230,
                            height: 125,
                            style: 'background-color: #DCDCDC;',
                            width: 440,
                            layout: 'absolute',
                            title: 'Перерасчет',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 270,
                                    y: 0,
                                    width: 145,
                                    fieldLabel: 'Сумма',
                                    labelWidth: 50,
                                    name: 'perer',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 0,
                                    y: 0,
                                    width: 130,
                                    fieldLabel: 'Кубов',
                                    labelWidth: 55,
                                    name: 'pkub',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'textareafield',
                                    x: 5,
                                    y: 30,
                                    width: 285,
                                    fieldLabel: 'инфо',
                                    labelWidth: 50,
                                    name: 'note',
                                    fieldStyle: 'background-color:#F0F8FF;',
                                    grow: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var fmInfoNachOrg = Ext.getCmp('fmInfoNachFilial').getForm();
                                        var form = button.findParentByType('form').getForm();
                                        var zadol = form.findField('zadol').getValue();
                                        var ptarif = form.findField('ptarif').getValue();
                                        var tarifOrg = fmInfoNachOrg.findField('tarif_xv').getValue();
                                        var per= form.findField('perer').getValue();

                                        var pkub = form.findField('pkub').getValue();
                                        var xvoda = form.findField('xvoda').getValue();
                                        var norma_xv = form.findField('norma_xv').getValue();
                                        var oplacheno = form.findField('oplacheno').getValue();
                                        var tarif = 0;
                                        var nachisleno = 0;
                                        var perer = 0;





                                        if (pkub!==0 ) {
                                            var perer= pkub * tarif ;
                                            var nachisleno = xvoda + norma_xv + perer;
                                            var nds = (xvoda + norma_xv + perer) * 0.2;
                                            var itogo = nachisleno + nds;
                                            form.findField('perer').setValue(perer);
                                            form.findField('nachisleno').setValue(nachisleno);
                                            form.findField('nds').setValue(nds);
                                            form.findField('itogo').setValue(itogo);
                                            form.findField('dolg').setValue(zadol + itogo - oplacheno);
                                        } else {
                                            var nachisleno = xvoda + norma_xv  + per;
                                            var nds = (xvoda + norma_xv +  per) * 0.2;
                                            var itogo = nachisleno + nds;
                                            form.findField('nachisleno').setValue(nachisleno);
                                            form.findField('nds').setValue(nds);
                                            form.findField('itogo').setValue(itogo);
                                            form.findField('dolg').setValue(zadol + itogo - oplacheno);
                                        }
                                    },
                                    x: 300,
                                    y: 60,
                                    formBind: true,
                                    id: 'btnStokiFilialPerer',
                                    width: 110,
                                    icon: 'resources/css/images/ico/kbruch.png',
                                    text: 'Просчитать'
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 140,
                                    y: 0,
                                    width: 125,
                                    fieldLabel: 'тариф',
                                    labelWidth: 40,
                                    name: 'ptarif',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 4
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 460,
                            y: 130,
                            height: 90,
                            style: 'background-color: #DCDCDC;',
                            width: 440,
                            layout: 'absolute',
                            title: 'Начислено по счетчикам',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 0,
                                    y: 0,
                                    width: 130,
                                    fieldLabel: 'Куб Хв',
                                    labelWidth: 55,
                                    name: 'xkub',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 140,
                                    y: 0,
                                    width: 115,
                                    fieldLabel: 'тариф',
                                    labelWidth: 40,
                                    name: 'tarif',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 4
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 270,
                                    y: 0,
                                    width: 145,
                                    fieldLabel: 'Хвода',
                                    labelWidth: 50,
                                    name: 'xvoda',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var fmInfoNachOrg = Ext.getCmp('fmInfoNachFilial').getForm();
                                        var form = button.findParentByType('form').getForm();
                                        var zadol = form.findField('zadol').getValue();
                                        var ptarif = form.findField('tarif').getValue();
                                        var tarifOrg = fmInfoNachOrg.findField('tarif_st').getValue();

                                        var kub_xv = form.findField('xkub').getValue();

                                        var perer = form.findField('perer').getValue();
                                        var norma_xv = form.findField('norma_xv').getValue();
                                        var oplacheno = form.findField('oplacheno').getValue();
                                        var tarif = 0;
                                        var nachisleno = 0;

                                        if (ptarif !==0) {
                                            tarif = ptarif;
                                        }else{
                                            tarif = tarifOrg;
                                        }
                                        form.findField('ptarif').setValue(tarif);


                                        if (tarif===0) {

                                            Ext.MessageBox.show({
                                                title: 'Проверка тарифа',
                                                msg: 'Введите тариф ',
                                                buttons: Ext.MessageBox.OK,
                                                icon: Ext.MessageBox.INFO
                                            });
                                        } else {
                                            var xv= kub_xv * tarif ;
                                            form.findField('xvoda').setValue(xv);
                                            var nachisleno = xv + norma_xv  + perer;
                                            var nds = (xv +  norma_xv  + perer)* 0.2;
                                            var itogo = nachisleno + nds;
                                            form.findField('nachisleno').setValue(nachisleno);
                                            form.findField('nds').setValue(nds);
                                            form.findField('itogo').setValue(itogo);
                                            form.findField('dolg').setValue(zadol + itogo - oplacheno);
                                        }
                                    },
                                    x: 280,
                                    y: 35,
                                    formBind: true,
                                    width: 125,
                                    icon: 'resources/css/images/ico/kbruch.png',
                                    text: 'Просчитать'
                                }
                            ]
                        },
                        {
                            xtype: 'gridpanel',
                            x: 10,
                            y: 0,
                            height: 460,
                            id: 'grNachStokiFilial',
                            scrollable: true,
                            width: 245,
                            title: 'Период начисления',
                            store: 'StTekNachFilial',
                            viewConfig: {
                                emptyText: 'нет начислений'
                            },
                            columns: [
                                {
                                    xtype: 'numbercolumn',
                                    hidden: true,
                                    dataIndex: 'address_id',
                                    text: 'Address_id'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    width: 50,
                                    dataIndex: 'god',
                                    menuDisabled: true,
                                    text: 'год',
                                    format: '0'
                                },
                                {
                                    xtype: 'datecolumn',
                                    width: 80,
                                    dataIndex: 'data',
                                    menuDisabled: true,
                                    text: 'месяц',
                                    format: 'F'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'zadol',
                                    menuDisabled: true,
                                    text: 'задол'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 49,
                                    dataIndex: 'mec',
                                    menuDisabled: true,
                                    text: 'мес'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 62,
                                    dataIndex: 'period',
                                    menuDisabled: true,
                                    text: 'Период'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'nachisleno',
                                    menuDisabled: true,
                                    text: 'начисл'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'oplacheno',
                                    menuDisabled: true,
                                    text: 'оплач'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    width: 104,
                                    align: 'right',
                                    dataIndex: 'dolg',
                                    menuDisabled: true,
                                    text: 'Долг'
                                }
                            ],
                            tools: [
                                {
                                    xtype: 'tool',
                                    callback: function(owner, tool, event) {
                                        //STORE
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var StTekNach = Ext.data.StoreManager.get("StTekNachFilial");
                                        //LOGIN & PASSWORD
                                        var values =stUser.getAt(0);
                                        // FORM
                                        var form = tool.findParentByType('form');
                                        // DATA

                                        //LOGIKA
                                        StTekNach.load({
                                            params: {
                                                what:'StokiFilialAll',
                                                filial_id: values.get('filial_id'),
                                                login:values.get('login'),
                                                password:values.get('password')
                                            },
                                            callback: function(records,operation,success){
                                                if(success){
                                                    form.getForm().reset();
                                                    form.getForm().loadRecord(records[0]);
                                                }else{
                                                    form.getForm().reset();
                                                }
                                            },
                                            scope:this
                                        });

                                    },
                                    tooltip: 'выбрать все записи',
                                    type: 'plus'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldcontainer',
                            x: 460,
                            y: 5,
                            height: 120,
                            style: 'background-color: #DCDCDC;',
                            width: 440,
                            layout: 'absolute',
                            fieldLabel: 'Начислено по норме',
                            labelAlign: 'top',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 230,
                                    y: 0,
                                    width: 80,
                                    fieldLabel: 'Куб Хв',
                                    labelAlign: 'top',
                                    name: 'xkubn',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 320,
                                    y: 0,
                                    width: 95,
                                    fieldLabel: 'Хвода норма',
                                    labelAlign: 'top',
                                    name: 'norma_xv',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 145,
                                    y: 0,
                                    width: 80,
                                    fieldLabel: 'Нор.рх_Хв',
                                    labelAlign: 'top',
                                    name: 'nrx_xv_d',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 10,
                                    y: 27,
                                    width: 130,
                                    fieldLabel: 'Дней_Хв',
                                    labelWidth: 60,
                                    name: 'day_xv',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 10,
                                    y: 57,
                                    width: 130,
                                    fieldLabel: 'человек',
                                    labelWidth: 60,
                                    name: 'people',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var fmInfoNachOrg = Ext.getCmp('fmInfoNachFilial').getForm();
                                        var form = button.findParentByType('form').getForm();
                                        var zadol = form.findField('zadol').getValue();
                                        var ptarif = form.findField('tarif').getValue();
                                        var tarifOrg = fmInfoNachOrg.findField('tarif_st').getValue();
                                        var xvoda = form.findField('xvoda').getValue();
                                        var perer = form.findField('perer').getValue();
                                        var nrxv = form.findField('nrx_xv_d').getValue();
                                        var day_xv = form.findField('day_xv').getValue();
                                        var day_xv = form.findField('day_xv').getValue();
                                        var kub_xv = form.findField('xkubn').getValue();

                                        var oplacheno = form.findField('oplacheno').getValue();
                                        var tarif = 0;
                                        var nachisleno = 0;

                                        if (ptarif !==0) {
                                            tarif = ptarif;
                                        }else{
                                            tarif = tarifOrg;
                                        }
                                        form.findField('ptarif').setValue(tarif);


                                        if (tarif===0) {

                                            Ext.MessageBox.show({
                                                title: 'Проверка тарифа',
                                                msg: 'Введите тариф ',
                                                buttons: Ext.MessageBox.OK,
                                                icon: Ext.MessageBox.INFO
                                            });
                                        } else {
                                            var xv= kub_xv * tarif ;
                                            form.findField('norma_xv').setValue(xv);
                                            var nachisleno = xv +  xvoda + perer;
                                            var nds = (xv + xvoda +  perer)* 0.2;
                                            var itogo = nachisleno + nds;
                                            form.findField('nachisleno').setValue(nachisleno);
                                            form.findField('nds').setValue(nds);
                                            form.findField('itogo').setValue(itogo);
                                            form.findField('dolg').setValue(zadol + itogo - oplacheno);
                                        }
                                    },
                                    x: 285,
                                    y: 55,
                                    formBind: true,
                                    id: 'btnStokiNormaPerer',
                                    width: 130,
                                    icon: 'resources/css/images/ico/kbruch.png',
                                    text: 'Просчитать'
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'form',
                    height: 446,
                    id: 'tabFmFilialPodogrev',
                    minHeight: 300,
                    layout: 'absolute',
                    title: 'Подогрев',
                    items: [
                        {
                            xtype: 'fieldset',
                            x: 265,
                            y: 5,
                            height: 430,
                            style: 'background-color: #DCDCDC;',
                            width: 160,
                            title: 'Сальдо',
                            items: [
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var form = button.findParentByType('form').getForm();
                                        var grNach = Ext.getCmp('grNachPodogrevFilial');
                                        var record = grNach.getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(record);
                                        grNach.getView().getSelectionModel().clearSelections();
                                        grNach.getView().getSelectionModel().select(ind);
                                    },
                                    anchor: '100%',
                                    formBind: true,
                                    id: 'btnPodogrevFilialReset',
                                    icon: 'resources/css/images/ico/xsldbg_refresh.png',
                                    text: 'Восстановить',
                                    tooltip: 'восстановить данные'
                                },
                                {
                                    xtype: 'datefield',
                                    anchor: '100%',
                                    style: 'background-color: #e0e0e0;',
                                    fieldLabel: 'Период начисления',
                                    labelAlign: 'top',
                                    labelWidth: 50,
                                    name: 'data',
                                    fieldStyle: 'color: #1791e6; text-shadow: -1px -1px white, 1px 1px #333;font-size:14pt;text-align:center',
                                    hideTrigger: true,
                                    format: 'F,Y',
                                    startDay: 1,
                                    submitFormat: 'Ymd'
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Сальдо на начало',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'zadol',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Начислено',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'nachisleno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'НДС',
                                    labelWidth: 45,
                                    name: 'nds',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Итого',
                                    labelWidth: 45,
                                    name: 'itogo',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Оплачено',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'oplacheno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Сальдо на конец',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'dolg',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        // in use
                                        var me = this;

                                        //STORE
                                        var StTekNach = Ext.data.StoreManager.get("StTekNach");
                                        var stTekNachFilial = Ext.data.StoreManager.get("StTekNachFilial");
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var values =stUser.getAt(0);
                                        var params = {
                                            login:values.get('login'),
                                            password:values.get('password'),
                                            org_id:values.get('org_id'),
                                            filial_id:values.get('filial_id'),
                                            what:'FilialPodogrevIns'
                                        };
                                        //console.log(values.data.login);
                                        //FORMA
                                        var form = Ext.getCmp('tabFmFilialPodogrev');
                                        //console.log(form);

                                        var value = form.getForm().getValues();
                                        var grNach = Ext.getCmp('grNachPodogrevFilial');
                                        var record = grNach.getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(record);
                                        //LOGIKA
                                        Ext.Object.merge(value, params);

                                        QueryOrg.updateRecords(value,function(results){

                                            stTekNachFilial.load({
                                                params: {
                                                    what:'PodogrevFilial',
                                                    filial_id: value.filial_id,
                                                    data: value.data,
                                                    login:value.login,
                                                    password:value.password
                                                },
                                                callback: function(records,operation,success){
                                                    if(success){
                                                        grNach.getView().getSelectionModel().select(ind);

                                                    }else{
                                                        form.getForm().reset();
                                                    }
                                                },
                                                scope:this
                                            });

                                        });
                                    },
                                    anchor: '100%',
                                    formBind: true,
                                    id: 'btnPodogrevFilialIns',
                                    icon: 'resources/css/images/ico/yes22.png',
                                    text: 'Записать'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 430,
                            y: 220,
                            height: 185,
                            style: 'background-color: #DCDCDC;',
                            width: 465,
                            layout: 'absolute',
                            title: 'Перерасчет',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 330,
                                    y: 0,
                                    width: 110,
                                    fieldLabel: 'Перерасчет',
                                    labelAlign: 'top',
                                    labelWidth: 50,
                                    name: 'perer',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 0,
                                    y: 0,
                                    width: 90,
                                    fieldLabel: 'Кубов',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'pkub',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 115,
                                    y: 0,
                                    width: 95,
                                    fieldLabel: 'Гкал',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'gkal_perer',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 6
                                },
                                {
                                    xtype: 'textareafield',
                                    x: 5,
                                    y: 60,
                                    width: 300,
                                    fieldLabel: 'информация о перерасчете',
                                    labelAlign: 'top',
                                    labelWidth: 50,
                                    name: 'note',
                                    fieldStyle: 'background-color:#F0F8FF;',
                                    grow: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var fmInfoNachOrg = Ext.getCmp('fmInfoNachFilial').getForm();
                                        var form = button.findParentByType('form').getForm();
                                        var zadol = form.findField('zadol').getValue();
                                        var ptarif = form.findField('ptarif').getValue();
                                        var tarifOrg = fmInfoNachOrg.findField('tarif_gv').getValue();
                                        var toc = form.findField('toc').getValue();

                                        var pkub = form.findField('pkub').getValue();
                                        var podogrev = form.findField('podogrev').getValue();
                                        var norma = form.findField('norma').getValue();
                                        var oplacheno = form.findField('oplacheno').getValue();
                                        var tarif = 0;
                                        var nachisleno = 0;
                                        var ptoc = 50;

                                        if (ptarif !==0) {
                                            tarif = ptarif;
                                        }else{
                                            tarif = tarifOrg;
                                        }
                                        if (toc !==0) {
                                            ptoc = toc;
                                        }
                                        form.findField('ptarif').setValue(tarif);

                                        if (tarif===0) {

                                            Ext.MessageBox.show({
                                                title: 'Проверка тарифа',
                                                msg: 'Введите тариф ',
                                                buttons: Ext.MessageBox.OK,
                                                icon: Ext.MessageBox.INFO
                                            });
                                        } else {
                                            var gkal = pkub *ptoc *0.001*1.2;
                                            var perer= gkal * tarif ;
                                            var nachisleno = podogrev + norma + perer;
                                            var nds = (podogrev +  norma + perer)/6;
                                            form.findField('gkal_perer').setValue(gkal);
                                            form.findField('perer').setValue(perer);
                                            form.findField('nachisleno').setValue(nachisleno);
                                            form.findField('nds').setValue(nds);
                                            form.findField('dolg').setValue(zadol + nachisleno + nds - oplacheno);
                                        }
                                    },
                                    x: 320,
                                    y: 100,
                                    formBind: true,
                                    id: 'btnPodogrevFilialPerer',
                                    width: 110,
                                    icon: 'resources/css/images/ico/kbruch.png',
                                    text: 'Просчитать'
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 230,
                                    y: 0,
                                    width: 85,
                                    fieldLabel: 'тариф',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'ptarif',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 3
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 430,
                            y: 120,
                            height: 90,
                            style: 'background-color: #DCDCDC;',
                            width: 465,
                            layout: 'absolute',
                            title: 'Начислено по счетчикам',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 230,
                                    y: 0,
                                    width: 80,
                                    fieldLabel: 'тариф',
                                    labelAlign: 'top',
                                    labelWidth: 50,
                                    name: 'tarif',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 0,
                                    y: 0,
                                    width: 90,
                                    fieldLabel: 'Кубов',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'kub',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 115,
                                    y: 0,
                                    width: 90,
                                    fieldLabel: 'Гкал',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'gkal',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 6
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 330,
                                    y: 0,
                                    width: 110,
                                    fieldLabel: 'Подогрев',
                                    labelAlign: 'top',
                                    labelWidth: 70,
                                    name: 'podogrev',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                }
                            ]
                        },
                        {
                            xtype: 'gridpanel',
                            x: 10,
                            y: 0,
                            height: 475,
                            id: 'grNachPodogrevFilial',
                            scrollable: true,
                            width: 245,
                            title: 'Период начисления',
                            store: 'StTekNachFilial',
                            viewConfig: {
                                emptyText: 'нет начислений'
                            },
                            columns: [
                                {
                                    xtype: 'numbercolumn',
                                    hidden: true,
                                    dataIndex: 'address_id',
                                    text: 'Address_id'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    width: 50,
                                    dataIndex: 'god',
                                    menuDisabled: true,
                                    text: 'год',
                                    format: '0'
                                },
                                {
                                    xtype: 'datecolumn',
                                    width: 80,
                                    dataIndex: 'data',
                                    menuDisabled: true,
                                    text: 'месяц',
                                    format: 'F'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'zadol',
                                    menuDisabled: true,
                                    text: 'задол'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 49,
                                    dataIndex: 'mec',
                                    menuDisabled: true,
                                    text: 'мес'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 62,
                                    dataIndex: 'period',
                                    menuDisabled: true,
                                    text: 'Период'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'nachisleno',
                                    menuDisabled: true,
                                    text: 'начисл'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'oplacheno',
                                    menuDisabled: true,
                                    text: 'оплач'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    width: 104,
                                    align: 'right',
                                    dataIndex: 'dolg',
                                    menuDisabled: true,
                                    text: 'Долг'
                                }
                            ],
                            tools: [
                                {
                                    xtype: 'tool',
                                    callback: function(owner, tool, event) {
                                        //STORE
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var StTekNach = Ext.data.StoreManager.get("StTekNachFilial");
                                        //LOGIN & PASSWORD
                                        var values =stUser.getAt(0);
                                        // FORM
                                        var form = tool.findParentByType('form');
                                        // DATA

                                        //LOGIKA
                                        StTekNach.load({
                                            params: {
                                                what:'PodogrevFilialAll',
                                                filial_id: values.get('filial_id'),
                                                login:values.get('login'),
                                                password:values.get('password')
                                            },
                                            callback: function(records,operation,success){
                                                if(success){
                                                    form.getForm().reset();
                                                    form.getForm().loadRecord(records[0]);
                                                }else{
                                                    form.getForm().reset();
                                                }
                                            },
                                            scope:this
                                        });

                                    },
                                    tooltip: 'выбрать все записи',
                                    type: 'plus'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldcontainer',
                            x: 430,
                            y: 5,
                            height: 110,
                            style: 'background-color: #DCDCDC;',
                            width: 465,
                            layout: 'absolute',
                            fieldLabel: 'Начислено по норме',
                            labelAlign: 'top',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 245,
                                    y: 0,
                                    width: 110,
                                    fieldLabel: 'Кубы ',
                                    labelWidth: 40,
                                    name: 'kubn',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 245,
                                    y: 30,
                                    width: 110,
                                    fieldLabel: 'Гкал',
                                    labelWidth: 40,
                                    name: 'gkaln',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 6
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 365,
                                    y: 5,
                                    width: 90,
                                    fieldLabel: 'Норма',
                                    labelAlign: 'top',
                                    name: 'norma',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 130,
                                    y: 30,
                                    width: 110,
                                    fieldLabel: 'н.рх_Гв',
                                    labelWidth: 50,
                                    name: 'nrx_gvs_d',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 130,
                                    y: 0,
                                    width: 110,
                                    fieldLabel: 'Дней',
                                    labelWidth: 50,
                                    name: 'day_gv',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 10,
                                    y: 30,
                                    width: 110,
                                    fieldLabel: 'Человек',
                                    labelWidth: 60,
                                    name: 'people',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 10,
                                    y: 0,
                                    width: 110,
                                    fieldLabel: 't &#176; С    Гвс',
                                    labelWidth: 60,
                                    name: 'toc',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'form',
                    height: 446,
                    id: 'tabFmFilialOtoplenie',
                    minHeight: 300,
                    layout: 'absolute',
                    title: 'Опалення',
                    items: [
                        {
                            xtype: 'gridpanel',
                            x: 0,
                            y: 0,
                            height: 475,
                            id: 'grNachOtoplenieFilial',
                            scrollable: true,
                            width: 210,
                            title: 'період нарахування',
                            store: 'StTekNachFilial',
                            viewConfig: {
                                emptyText: 'нет начислений'
                            },
                            columns: [
                                {
                                    xtype: 'numbercolumn',
                                    hidden: true,
                                    dataIndex: 'address_id',
                                    text: 'Address_id'
                                },
                                {
                                    xtype: 'numbercolumn',
                                    width: 50,
                                    dataIndex: 'god',
                                    menuDisabled: true,
                                    text: 'рік',
                                    format: '0'
                                },
                                {
                                    xtype: 'datecolumn',
                                    width: 80,
                                    dataIndex: 'data',
                                    menuDisabled: true,
                                    text: 'місяць',
                                    format: 'F'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'zadol',
                                    menuDisabled: true,
                                    text: 'задол'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 49,
                                    dataIndex: 'mec',
                                    menuDisabled: true,
                                    text: 'мес'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 62,
                                    dataIndex: 'period',
                                    menuDisabled: true,
                                    text: 'Период'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'nachisleno',
                                    menuDisabled: true,
                                    text: 'начисл'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    hidden: true,
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'oplacheno',
                                    menuDisabled: true,
                                    text: 'оплач'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        if (value < 0) {
                                            metaData.style = 'color:red';
                                        }
                                        return value;

                                    },
                                    width: 70,
                                    align: 'right',
                                    dataIndex: 'dolg',
                                    menuDisabled: true,
                                    text: 'борг'
                                }
                            ],
                            tools: [
                                {
                                    xtype: 'tool',
                                    callback: function(owner, tool, event) {


                                        //STORE
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var StTekNach = Ext.data.StoreManager.get("StTekNachFilial");
                                        //LOGIN & PASSWORD
                                        var values =stUser.getAt(0);
                                        // FORM
                                        var form = tool.findParentByType('form');
                                        // DATA

                                        //LOGIKA
                                        StTekNach.load({
                                            params: {
                                                what:'OtoplenieFilialAll',
                                                filial_id: values.get('filial_id'),
                                                login:values.get('login'),
                                                password:values.get('password')
                                            },
                                            callback: function(records,operation,success){
                                                if(success){
                                                    form.getForm().reset();
                                                    form.getForm().loadRecord(records[0]);
                                                }else{
                                                    form.getForm().reset();
                                                }
                                            },
                                            scope:this
                                        });
                                    },
                                    tooltip: 'выбрать все записи',
                                    type: 'plus'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 380,
                            y: 90,
                            height: 185,
                            style: 'background-color: #DCDCDC;',
                            width: 175,
                            title: 'Нараховано, Гкал',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'тариф',
                                    labelWidth: 60,
                                    name: 'tarif',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Нарах',
                                    labelWidth: 60,
                                    name: 'otoplenie',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Гкал/м&sup2;',
                                    labelWidth: 60,
                                    name: 'gkm2',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 6
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Гкал',
                                    labelWidth: 60,
                                    name: 'gkal',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'button',
                                    disabled: true,
                                    id: 'btnYtkeFilialAccount',
                                    margin: 5,
                                    width: 155,
                                    icon: 'resources/css/images/ico/printer24.png',
                                    scale: 'medium',
                                    text: 'Виписати рахунок'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 560,
                            y: 90,
                            height: 185,
                            style: 'background-color: #DCDCDC;',
                            width: 175,
                            title: 'Нараховано, Гкал_доп',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Гкал/м&sup2;',
                                    labelWidth: 60,
                                    name: 'gkm2_add',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 6
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Гкал',
                                    labelWidth: 60,
                                    name: 'gkal_add',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Нарах',
                                    labelWidth: 60,
                                    name: 'otoplenie_add',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, event) {
                                        var me = this;
                                        var StUser = Ext.data.StoreManager.get("StUser");
                                        var StReport = Ext.data.StoreManager.get("StReport");
                                        var values =StUser.getAt(0);
                                        var addr = values.data.address_id;

                                        var usertype = 1;

                                        var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();



                                        if (addr) {

                                            var report = 'FlatRaspechatkaYtke';
                                            var namereport = 'Распечатка ЮТКЭ';

                                            var value = {
                                                login:values.get('login'),
                                                password:values.get('password'),
                                                report:report,
                                                what:report,
                                                address_id: addr
                                            };

                                            var tab = tabPnCenter.child('#'+report);

                                            if (!tab) {
                                                tab  = tabPnCenter.add({
                                                    xtype:'tabReportOrg',
                                                    title:namereport,
                                                    id:''+report+''
                                                });

                                                tabPnCenter.setActiveTab(tab);

                                            }else{

                                                tabPnCenter.setActiveTab(tab);
                                            }

                                            var reppan = tab.getComponent(0);



                                            // Basic mask:
                                            var myMask = new Ext.LoadMask(reppan, {msg:"Загрузка ..."});
                                            myMask.show();



                                            QueryReport.getResults(value,function(data){
                                                if (data){

                                                    //    reportHead.update(data.head);
                                                    reppan.update(data.content);
                                                    //      reportFoot.update(data.foot);
                                                    Ext.REPORTCONTENT =data.content;
                                                    Ext.REPORTSQL =data.sql;
                                                    Ext.REPORTTITLE =report;
                                                    myMask.hide();


                                                } else {
                                                    myMask.hide();

                                                    Ext.MessageBox.show({
                                                        title: 'Ошибка ',
                                                        msg: 'Документ не создан',
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.ERROR

                                                    });

                                                }

                                            });


                                        }
                                    },
                                    anchor: '100%',
                                    id: 'printRaspechatakaYtkeFilial1',
                                    margin: 5,
                                    width: 159,
                                    icon: 'resources/css/images/ico/printer24.png',
                                    scale: 'medium',
                                    text: 'Друк расчеткі',
                                    tooltip: 'Печать расчетного листка'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 220,
                            y: 10,
                            height: 420,
                            style: 'background-color: #DCDCDC;',
                            width: 155,
                            title: 'Сальдо',
                            items: [
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var form = button.findParentByType('form').getForm();
                                        var grNach = Ext.getCmp('grNachOtoplenieFilial');
                                        var record = grNach.getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(record);
                                        grNach.getView().getSelectionModel().clearSelections();
                                        grNach.getView().getSelectionModel().select(ind);
                                    },
                                    anchor: '100%',
                                    formBind: true,
                                    id: 'btnOtoplenieFilialReset',
                                    icon: 'resources/css/images/ico/xsldbg_refresh.png',
                                    text: 'Відновити',
                                    tooltip: 'Восстановить'
                                },
                                {
                                    xtype: 'datefield',
                                    anchor: '100%',
                                    style: 'background-color: #e0e0e0;',
                                    fieldLabel: 'період нарахування',
                                    labelAlign: 'top',
                                    name: 'data',
                                    fieldStyle: 'color: #1791e6; text-shadow: -1px -1px white, 1px 1px #333;font-size:14pt;text-align:center',
                                    hideTrigger: true,
                                    format: 'F,Y',
                                    startDay: 1,
                                    submitFormat: 'Ymd'
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Сальдо на початок',
                                    labelAlign: 'top',
                                    labelWidth: 55,
                                    name: 'zadol',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 155,
                                    fieldLabel: 'Нараховано',
                                    labelAlign: 'top',
                                    labelWidth: 70,
                                    name: 'nachisleno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 145,
                                    fieldLabel: 'пдв',
                                    labelAlign: 'top',
                                    labelWidth: 60,
                                    name: 'nds',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Сплачено',
                                    labelAlign: 'top',
                                    name: 'oplacheno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Сальдо на кінець',
                                    labelAlign: 'top',
                                    name: 'dolg',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var form = button.findParentByType('form').getForm();

                                        var fmInfoNachOrg = Ext.getCmp('fmInfoNachFilial').getForm();
                                        var tarifOrg = fmInfoNachOrg.findField('tarif_ot').getValue();
                                        var areaOrg = fmInfoNachOrg.findField('area').getValue();
                                        var volume = fmInfoNachOrg.findField('volume').getValue();
                                        var gkal_y_ot = fmInfoNachOrg.findField('gkal_y_ot').getValue();
                                        form.findField('gkal_y_ot').setValue(gkal_y_ot);
                                        form.findField('volume').setValue(volume);



                                        //form.reset();
                                        var zadol = form.findField('zadol').getValue();
                                        var tarifNach = form.findField('tarif').getValue();
                                        var gkal = form.findField('gkal').getValue();
                                        var gkal_add = form.findField('gkal_add').getValue();

                                        var areaNach = form.findField('square').getValue();
                                        var perer = form.findField('perer').getValue();
                                        var nds = form.findField('nds').getValue();
                                        var pnds = form.findField('pnds').getValue();
                                        var nachisleno = form.findField('nachisleno').getValue();
                                        var oplacheno = form.findField('oplacheno').getValue();

                                        var tarif =0;
                                        var gkm2 = 0;
                                        var otoplenie = 0;
                                        var nacisleno = 0;
                                        var nds_ot = 0;
                                        var square = 0;



                                        if (tarifNach !==0) {

                                            tarif = tarifNach;
                                        }else{
                                            tarif = tarifOrg;

                                        }
                                        if (areaNach !==0) {

                                            square = areaNach;
                                        }else{
                                            square = areaOrg;
                                            form.findField('square').setValue(areaOrg);


                                        }

                                        if (tarif===0) {

                                            Ext.MessageBox.show({
                                                title: 'Проверка тарифа',
                                                msg: 'Введите тариф для расчета',
                                                buttons: Ext.MessageBox.OK,
                                                icon: Ext.MessageBox.INFO
                                            });
                                        } else {

                                            if (gkal > 0 ) {
                                                otoplenie = gkal * tarif ;
                                                gkm2 = gkal / square;
                                                nds_ot	= gkal * tarif *20/100;
                                                form.findField('tarif').setValue(tarif);
                                                nds   = nds_ot + pnds;
                                                nachisleno =otoplenie + perer +nds;
                                                form.findField('gkm2').setValue(gkm2);
                                                form.findField('otoplenie').setValue(otoplenie);
                                                form.findField('nachisleno').setValue(nachisleno);
                                                form.findField('nds').setValue(nds);
                                                form.findField('dolg').setValue(zadol + nachisleno - oplacheno);


                                            } else {
                                                form.findField('tarif').setValue(tarif);
                                                form.findField('gkm2').setValue(0);
                                                form.findField('otoplenie').setValue(0);
                                                form.findField('gkal').setValue(0);
                                                form.findField('nds').setValue(0);
                                                nachisleno =perer + pnds;
                                                form.findField('nachisleno').setValue(nachisleno);
                                                form.findField('dolg').setValue(zadol + nachisleno - oplacheno);
                                            }
                                        }

                                    },
                                    anchor: '100%',
                                    formBind: true,
                                    id: 'btnOtoplenieFilialPerer',
                                    margin: 5,
                                    icon: 'resources/css/images/ico/kbruch.png',
                                    text: 'Прорахувати'
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        // in use
                                        var me = this;

                                        //STORE
                                        var StTekNach = Ext.data.StoreManager.get("StTekNach");
                                        var stTekNachFilial = Ext.data.StoreManager.get("StTekNachFilial");
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var values =stUser.getAt(0);
                                        var params = {
                                            login:values.get('login'),
                                            password:values.get('password'),
                                            org_id:values.get('org_id'),
                                            filial_id:values.get('filial_id'),
                                            what:'FilialOtoplenieIns'
                                        };
                                        //console.log(values.data.login);
                                        //FORMA
                                        var form = Ext.getCmp('tabFmFilialOtoplenie');
                                        //console.log(form);

                                        var value = form.getForm().getValues();
                                        var grNach = Ext.getCmp('grNachOtoplenieFilial');
                                        var record = grNach.getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(record);
                                        //LOGIKA
                                        Ext.Object.merge(value, params);

                                        QueryOrg.updateRecords(value,function(results){

                                            stTekNachFilial.load({
                                                params: {
                                                    what:'OtoplenieFilial',
                                                    filial_id: value.filial_id,
                                                    data: value.data,
                                                    login:value.login,
                                                    password:value.password
                                                },
                                                callback: function(records,operation,success){
                                                    if(success){
                                                        grNach.getView().getSelectionModel().select(ind);

                                                    }else{
                                                        form.getForm().reset();
                                                    }
                                                },
                                                scope:this
                                            });

                                        });
                                    },
                                    anchor: '100%',
                                    formBind: true,
                                    id: 'btnOtoplenieFilalInsert',
                                    margin: 5,
                                    width: 100,
                                    icon: 'resources/css/images/ico/yes22.png',
                                    text: 'Записать'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldcontainer',
                            x: 380,
                            y: 10,
                            height: 75,
                            style: 'background-color: #DCDCDC;',
                            width: 515,
                            layout: 'absolute',
                            fieldLabel: 'Технічні характеристики',
                            labelAlign: 'top',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 360,
                                    y: 5,
                                    width: 125,
                                    fieldLabel: 'Гк/ год',
                                    labelWidth: 50,
                                    name: 'gkal_y_ot',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 250,
                                    y: 5,
                                    width: 90,
                                    fieldLabel: 'Дней',
                                    labelWidth: 40,
                                    name: 'qty_day',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 5,
                                    y: 5,
                                    width: 110,
                                    fieldLabel: 'S (м&sup2;)',
                                    labelWidth: 45,
                                    name: 'square',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 130,
                                    y: 5,
                                    width: 110,
                                    fieldLabel: 'V (м&sup3;)',
                                    labelWidth: 45,
                                    name: 'volume',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 740,
                            y: 90,
                            height: 185,
                            style: 'background-color: #e0e0e0;',
                            width: 155,
                            title: 'Перерахунок Гкал',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Тариф',
                                    labelWidth: 50,
                                    name: 'ptarif',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Перер',
                                    labelWidth: 50,
                                    name: 'perer',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Гкал',
                                    labelWidth: 50,
                                    name: 'gkal_perer',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 6
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Гкал/м&sup2',
                                    labelWidth: 50,
                                    name: 'gkm2_perer',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 6
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'НДС',
                                    labelWidth: 50,
                                    name: 'pnds',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var form = button.findParentByType('form').getForm();

                                        var fmInfoNachOrg = Ext.getCmp('fmInfoNachFilial').getForm();
                                        var tarifOrg = fmInfoNachOrg.findField('tarif_ot').getValue();
                                        var areaOrg = fmInfoNachOrg.findField('area').getValue();
                                        var volume = fmInfoNachOrg.findField('volume').getValue();
                                        var gkal_y_ot = fmInfoNachOrg.findField('gkal_y_ot').getValue();
                                        form.findField('gkal_y_ot').setValue(gkal_y_ot);
                                        form.findField('volume').setValue(volume);



                                        //form.reset();
                                        var zadol = form.findField('zadol').getValue();
                                        var tarifNach = form.findField('ptarif').getValue();
                                        var pgkal = form.findField('gkal_perer').getValue();
                                        var areaNach = form.findField('square').getValue();
                                        var otoplenie = form.findField('otoplenie').getValue();
                                        var pnds = form.findField('pnds').getValue();
                                        var nds = form.findField('nds').getValue();
                                        var nachisleno = form.findField('nachisleno').getValue();
                                        var oplacheno = form.findField('oplacheno').getValue();

                                        var ptarif =0;
                                        var gkm2 = 0;
                                        var perer = 0;
                                        var nacisleno = 0;
                                        var nds_ot = 0;
                                        var pnds_ot = 0;

                                        var square = 0;



                                        if (tarifNach !==0) {

                                            ptarif = tarifNach;
                                        }else{
                                            ptarif = tarifOrg;

                                        }
                                        if (areaNach !==0) {

                                            square = areaNach;
                                        }else{
                                            square = areaOrg;
                                            form.findField('square').setValue(areaOrg);


                                        }

                                        if (ptarif===0) {

                                            Ext.MessageBox.show({
                                                title: 'Проверка тарифа',
                                                msg: 'Введите тариф для расчета',
                                                buttons: Ext.MessageBox.OK,
                                                icon: Ext.MessageBox.INFO
                                            });
                                        } else {

                                            if (pgkal !== 0 ) {
                                                perer = pgkal * ptarif ;
                                                gkm2 = pgkal / square;
                                                pnds_ot	= pgkal * ptarif *20/100;
                                                form.findField('ptarif').setValue(ptarif);
                                                nds_ot   = nds - pnds +pnds_ot;
                                                nachisleno =otoplenie + perer +nds_ot;
                                                form.findField('gkm2_perer').setValue(gkm2);
                                                form.findField('perer').setValue(perer);
                                                form.findField('nachisleno').setValue(nachisleno);
                                                form.findField('pnds').setValue(pnds_ot);
                                                form.findField('nds').setValue(nds_ot);
                                                form.findField('dolg').setValue(zadol + nachisleno - oplacheno);


                                            } else {
                                                Ext.MessageBox.show({
                                                    title: 'Проверка данных',
                                                    msg: 'Введите Гкал для расчета',
                                                    buttons: Ext.MessageBox.OK,
                                                    icon: Ext.MessageBox.INFO
                                                });
                                            }
                                        }
                                    },
                                    anchor: '100%',
                                    formBind: true,
                                    id: 'btnOtoplenieFilialPer',
                                    icon: 'resources/css/images/ico/kbruch.png',
                                    text: 'Прорахувати'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 380,
                            y: 285,
                            height: 125,
                            style: 'background-color: #DCDCDC;',
                            width: 515,
                            layout: 'absolute',
                            title: 'Перерасчет при наличии Дтепломера',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 60,
                                    y: 0,
                                    width: 80,
                                    fieldLabel: 'Площадь',
                                    labelAlign: 'top',
                                    labelWidth: 80,
                                    name: 'newValueSquareDt',
                                    value: 0,
                                    hideTrigger: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 5,
                                    y: 0,
                                    width: 45,
                                    fieldLabel: 'Дней',
                                    labelAlign: 'top',
                                    labelWidth: 80,
                                    name: 'newValueDayDt',
                                    value: 0,
                                    hideTrigger: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'button',
                                    x: 5,
                                    y: 50,
                                    formBind: true,
                                    height: 30,
                                    id: 'btnPererFilialDt',
                                    width: 135,
                                    icon: 'resources/css/images/ico/yes22.png',
                                    text: 'Перерасчет'
                                },
                                {
                                    xtype: 'textareafield',
                                    x: 150,
                                    y: 0,
                                    width: 340,
                                    fieldLabel: 'инфо перер',
                                    labelAlign: 'top',
                                    name: 'note',
                                    grow: true
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ],

    onCheckboxfieldChange5: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange6: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange1: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange2: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange3: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange4: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange13: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange21: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange31: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange41: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCbDo1Change1: function(field, newValue, oldValue, eOpts) {
        var form = field.findParentByType('form');
        var zadol = form.getForm().findField('zadol1').getValue();
        var value = form.getForm().findField('newOplataOrg').getValue();
        var dolg = form.getForm().findField('dolg1').getValue();
        form.down('#DoAllResetOrg').setDisabled(false);
        form.down('#NextAllResetOrg').setDisabled(false);


        if (newValue) {
            if(zadol >  0 && dolg >= 1){
                form.getForm().findField('newOplataOrg').setDisabled(false).setValue(Math.round(value+zadol)).focus();
                form.getForm().findField('cbNext1').setDisabled(true);
                form.getForm().findField('zadol1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('period1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('nachisleno1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('oplacheno1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('dolg1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            }else {
                form.getForm().findField('cbDo1').setValue(false);
            }
        }else {
            form.getForm().findField('newOplataOrg').setValue(Math.round(value-zadol)).focus();
            form.getForm().findField('cbNext1').setDisabled(false);
            form.getForm().findField('zadol1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg1').setFieldStyle('background-color: #F0F8FF; background-image: none;');

        }
    },

    onCbDo2Change1: function(field, newValue, oldValue, eOpts) {
        var form = field.findParentByType('form');
        var zadol = form.getForm().findField('zadol2').getValue();
        var value = form.getForm().findField('newOplataOrg').getValue();
        var dolg = form.getForm().findField('dolg2').getValue();
        form.down('#DoAllResetOrg').setDisabled(false);
        form.down('#NextAllResetOrg').setDisabled(false);

        if (newValue) {
            if(zadol >  0 && dolg >= 1 ){
                form.getForm().findField('newOplataOrg').setDisabled(false).setValue(Math.round(value+zadol)).focus();
                form.getForm().findField('cbNext2').setDisabled(true);
                form.getForm().findField('zadol2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('period2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('nachisleno2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('oplacheno2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('dolg2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            }else {
                form.getForm().findField('cbDo2').setValue(false);
            }
        }else {
            form.getForm().findField('newOplataOrg').setValue(Math.round(value-zadol)).focus();
            form.getForm().findField('cbNext2').setDisabled(false);
            form.getForm().findField('zadol2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg2').setFieldStyle('background-color: #F0F8FF; background-image: none;');

        }
    },

    onCbDo3Change1: function(field, newValue, oldValue, eOpts) {
        var form = field.findParentByType('form');
        var zadol = form.getForm().findField('zadol3').getValue();
        var value = form.getForm().findField('newOplataOrg').getValue();
        var dolg = form.getForm().findField('dolg3').getValue();
        form.down('#DoAllResetOrg').setDisabled(false);
        form.down('#NextAllResetOrg').setDisabled(false);

        if (newValue) {
            if(zadol >  0 && dolg >= 1){
                form.getForm().findField('newOplataOrg').setDisabled(false).setValue(Math.round(value+zadol)).focus();
                form.getForm().findField('cbNext3').setDisabled(true);
                form.getForm().findField('zadol3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('period3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('nachisleno3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('oplacheno3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('dolg3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            }else {
                form.getForm().findField('cbDo3').setValue(false);
            }
        }else {
            form.getForm().findField('newOplataOrg').setValue(Math.round(value-zadol)).focus();
            form.getForm().findField('cbNext3').setDisabled(false);
            form.getForm().findField('zadol3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg3').setFieldStyle('background-color: #F0F8FF; background-image: none;');

        }
    },

    onCbDo4Change1: function(field, newValue, oldValue, eOpts) {
        var form = field.findParentByType('form');
        var zadol = form.getForm().findField('zadol4').getValue();
        var value = form.getForm().findField('newOplataOrg').getValue();
        var dolg = form.getForm().findField('dolg4').getValue();
        form.down('#DoAllResetOrg').setDisabled(false);
        form.down('#NextAllResetOrg').setDisabled(false);

        if (newValue) {
            if(zadol >  0 && dolg >= 1){
                form.getForm().findField('newOplataOrg').setDisabled(false).setValue(Math.round(value+zadol)).focus();
                form.getForm().findField('cbNext4').setDisabled(true);
                form.getForm().findField('zadol4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('period4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('nachisleno4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('oplacheno4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
                form.getForm().findField('dolg4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            }else {
                form.getForm().findField('cbDo4').setValue(false);
            }
        }else {
            form.getForm().findField('newOplataOrg').setValue(Math.round(value-zadol)).focus();
            form.getForm().findField('cbNext4').setDisabled(false);
            form.getForm().findField('zadol4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg4').setFieldStyle('background-color: #F0F8FF; background-image: none;');

        }
    },

    onDoAllClickOrg: function(button, e, eOpts) {
        var form = button.findParentByType('form');
        var zadol = 0;
        var zadol1 = form.getForm().findField('zadol1').getValue();
        var zadol2 = form.getForm().findField('zadol2').getValue();
        var zadol3 = form.getForm().findField('zadol3').getValue();
        var zadol4 = form.getForm().findField('zadol4').getValue();
        var dolg1 = form.getForm().findField('dolg1').getValue();
        var dolg2 = form.getForm().findField('dolg2').getValue();
        var dolg3 = form.getForm().findField('dolg3').getValue();
        var dolg4 = form.getForm().findField('dolg4').getValue();

        if(zadol1 > 0 && dolg1 >= 1){
            zadol +=zadol1;
            form.getForm().findField('cbDo1').setValue(true);
            form.getForm().findField('cbNext1').setValue(false);
            form.getForm().findField('cbNext1').setDisabled(true);
            form.getForm().findField('zadol1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
        } else {
            form.getForm().findField('cbDo1').setValue(false);
            form.getForm().findField('cbNext1').setValue(false);
            form.getForm().findField('cbNext1').setDisabled(true);
            form.getForm().findField('zadol1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        }
        if(zadol2 > 0 && dolg2 >= 1){
            zadol +=zadol2;
            form.getForm().findField('cbDo2').setValue(true);
            form.getForm().findField('cbNext2').setValue(false);
            form.getForm().findField('cbNext2').setDisabled(true);
            form.getForm().findField('zadol2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg2').setFieldStyle('background-color: #FAFAD2; background-image: none;');

        } else {
            form.getForm().findField('cbDo2').setValue(false);
            form.getForm().findField('cbNext2').setValue(false);
            form.getForm().findField('cbNext2').setDisabled(true);
            form.getForm().findField('zadol2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        }
        if(zadol3 > 0 && dolg3 >= 1){
            zadol +=zadol3;
            form.getForm().findField('cbDo3').setValue(true);
            form.getForm().findField('cbNext3').setValue(false);
            form.getForm().findField('cbNext3').setDisabled(true);
            form.getForm().findField('zadol3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
        } else {
            form.getForm().findField('cbDo3').setValue(false);
            form.getForm().findField('cbNext3').setValue(false);
            form.getForm().findField('cbNext3').setDisabled(true);
            form.getForm().findField('zadol3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        }
        if(zadol4 > 0 && dolg4 >= 1){
            zadol +=zadol4;
            form.getForm().findField('cbDo4').setValue(true);
            form.getForm().findField('cbNext4').setValue(false);
            form.getForm().findField('cbNext4').setDisabled(true);
            form.getForm().findField('zadol4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
        } else {
            form.getForm().findField('cbDo4').setValue(false);
            form.getForm().findField('cbNext4').setValue(false);
            form.getForm().findField('cbNext4').setDisabled(true);
            form.getForm().findField('zadol4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        }

        if(zadol >=0.01 ){

            form.down('#NextAllOrg').setDisabled(true);
            form.down('#NextAllResetOrg').setDisabled(false);
            form.down('#DoAllResetOrg').setDisabled(false);
            form.getForm().findField('newOplataOrg').setDisabled(false);
            form.getForm().findField('newOplataOrg').setValue(Math.round(zadol)).focus();
        } else {

        }

    },

    onNextAllClickOrg: function(button, e, eOpts) {
        var form = button.findParentByType('form');
        var dolg = 0;
        var dolg1 = form.getForm().findField('dolg1').getValue();
        var dolg2 = form.getForm().findField('dolg2').getValue();
        var dolg3 = form.getForm().findField('dolg3').getValue();
        var dolg4 = form.getForm().findField('dolg4').getValue();

        if(dolg1 > 0){
            dolg +=dolg1;
            form.getForm().findField('cbNext1').setValue(true);
            form.getForm().findField('cbDo1').setValue(false);
            form.getForm().findField('cbDo1').setDisabled(true);
            form.getForm().findField('zadol1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
        } else {
            form.getForm().findField('cbNext1').setValue(false);
            form.getForm().findField('cbDo1').setValue(false);
            form.getForm().findField('cbDo1').setDisabled(true);
            form.getForm().findField('zadol1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        }
        if(dolg2 > 0){
            dolg +=dolg2;
            form.getForm().findField('cbNext2').setValue(true);
            form.getForm().findField('cbDo2').setValue(false);
            form.getForm().findField('cbDo2').setDisabled(true);
            form.getForm().findField('zadol2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg2').setFieldStyle('background-color: #FAFAD2; background-image: none;');

        } else {
            form.getForm().findField('cbNext2').setValue(false);
            form.getForm().findField('cbDo2').setValue(false);
            form.getForm().findField('cbDo2').setDisabled(true);
            form.getForm().findField('zadol2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        }
        if(dolg3 > 0){
            dolg +=dolg3;
            form.getForm().findField('cbNext3').setValue(true);
            form.getForm().findField('cbDo3').setValue(false);
            form.getForm().findField('cbDo3').setDisabled(true);
            form.getForm().findField('zadol3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
        } else {
            form.getForm().findField('cbNext3').setValue(false);
            form.getForm().findField('cbDo3').setValue(false);
            form.getForm().findField('cbDo3').setDisabled(true);
            form.getForm().findField('zadol3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        }
        if(dolg4 > 0){
            dolg +=dolg4;
            form.getForm().findField('cbNext4').setValue(true);
            form.getForm().findField('cbDo4').setValue(false);
            form.getForm().findField('cbDo4').setDisabled(true);
            form.getForm().findField('zadol4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
        } else {
            form.getForm().findField('cbNext4').setValue(false);
            form.getForm().findField('cbDo4').setValue(false);
            form.getForm().findField('cbDo4').setDisabled(true);
            form.getForm().findField('zadol4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        }
        if(dolg >=0.01 ){

        form.getForm().findField('newOplataOrg').setDisabled(false);
        form.getForm().findField('newOplataOrg').setValue(Math.round(dolg)).focus();
        form.down('#DoAllOrg').setDisabled(true);
        form.down('#NextAllResetOrg').setDisabled(false);
        form.down('#DoAllResetOrg').setDisabled(false);
        } else {
            form.getForm().findField('newOplataOrg').setDisabled(false);
            form.getForm().findField('newOplataOrg').setValue(0).focus();
        }

    },

    onNextAllResetOrgClick: function(button, e, eOpts) {
        //STORE

        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var prixod_id =values.get('prixod_id');
        //console.log(prixod_id);

        var form = Ext.getCmp('fmTekNachKassaOrg');
        form.down('#DoAllOrg').setDisabled(false);
        form.down('#DoAllResetOrg').setDisabled(true);
        form.down('#NextAllResetOrg').setDisabled(true);
        form.down('#NextAllOrg').setDisabled(false);
        form.getForm().findField('cbNext1').setDisabled(false).setValue(false);
        form.getForm().findField('cbNext2').setDisabled(false).setValue(false);
        form.getForm().findField('cbNext3').setDisabled(false).setValue(false);
        form.getForm().findField('cbNext4').setDisabled(false).setValue(false);
        form.getForm().findField('cbDo1').setDisabled(false).setValue(false);
        form.getForm().findField('cbDo2').setDisabled(false).setValue(false);
        form.getForm().findField('cbDo3').setDisabled(false).setValue(false);
        form.getForm().findField('cbDo4').setDisabled(false).setValue(false);
        form.getForm().findField('zadol1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('period1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('nachisleno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('oplacheno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('dolg1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('zadol2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('period2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('nachisleno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('oplacheno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('dolg2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('zadol3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('period3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('nachisleno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('oplacheno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('dolg3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('zadol4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('period4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('nachisleno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('oplacheno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('dolg4').setFieldStyle('background-color: #F0F8FF; background-image: none;');


        var newOplata = form.getForm().findField('newOplataOrg').setValue(0);

    },

    onDoAllResetOrgClick: function(button, e, eOpts) {
        //STORE

        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var prixod_id =values.get('prixod_id');
        //console.log(prixod_id);

        var form = Ext.getCmp('fmTekNachKassaOrg');
        form.down('#DoAllOrg').setDisabled(false);
        form.down('#DoAllResetOrg').setDisabled(true);
        form.down('#NextAllResetOrg').setDisabled(true);
        form.down('#NextAllOrg').setDisabled(false);
        form.getForm().findField('cbNext1').setDisabled(false).setValue(false);
        form.getForm().findField('cbNext2').setDisabled(false).setValue(false);
        form.getForm().findField('cbNext3').setDisabled(false).setValue(false);
        form.getForm().findField('cbNext4').setDisabled(false).setValue(false);
        form.getForm().findField('cbDo1').setDisabled(false).setValue(false);
        form.getForm().findField('cbDo2').setDisabled(false).setValue(false);
        form.getForm().findField('cbDo3').setDisabled(false).setValue(false);
        form.getForm().findField('cbDo4').setDisabled(false).setValue(false);
        form.getForm().findField('zadol1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('period1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('nachisleno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('oplacheno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('dolg1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('zadol2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('period2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('nachisleno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('oplacheno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('dolg2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('zadol3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('period3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('nachisleno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('oplacheno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('dolg3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('zadol4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('period4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('nachisleno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('oplacheno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
        form.getForm().findField('dolg4').setFieldStyle('background-color: #F0F8FF; background-image: none;');


        var newOplata = form.getForm().findField('newOplataOrg').setValue(0);

    },

    onCbNext1Change1: function(field, newValue, oldValue, eOpts) {
        var form = field.findParentByType('form');
        var dolg = form.getForm().findField('dolg1').getValue();
        var value = form.getForm().findField('newOplataOrg').getValue();
        form.down('#DoAllResetOrg').setDisabled(false);
        form.down('#NextAllResetOrg').setDisabled(false);

        if (newValue) {
            form.getForm().findField('newOplataOrg').setDisabled(false).setValue(Math.round(value+dolg)).focus();
            form.getForm().findField('cbDo1').setDisabled(true);
            form.getForm().findField('zadol1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg1').setFieldStyle('background-color: #FAFAD2; background-image: none;');
        }else {
            form.getForm().findField('newOplataOrg').setValue(Math.round(value-dolg)).focus();
            form.getForm().findField('cbDo1').setDisabled(false);
            form.getForm().findField('zadol1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno1').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg1').setFieldStyle('background-color: #F0F8FF; background-image: none;');

        }
    },

    onCbNext2Change1: function(field, newValue, oldValue, eOpts) {
        var form = field.findParentByType('form');
        var dolg = form.getForm().findField('dolg2').getValue();
        var value = form.getForm().findField('newOplataOrg').getValue();
        form.down('#DoAllResetOrg').setDisabled(false);
        form.down('#NextAllResetOrg').setDisabled(false);

        if (newValue) {
            form.getForm().findField('newOplataOrg').setDisabled(false).setValue(Math.round(value+dolg)).focus();
            form.getForm().findField('cbDo2').setDisabled(true);
            form.getForm().findField('zadol2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg2').setFieldStyle('background-color: #FAFAD2; background-image: none;');
        }else {
            form.getForm().findField('newOplataOrg').setValue(Math.round(value-dolg)).focus();
            form.getForm().findField('cbDo2').setDisabled(false);
            form.getForm().findField('zadol2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno2').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg2').setFieldStyle('background-color: #F0F8FF; background-image: none;');

        }
    },

    onCbNext3Change1: function(field, newValue, oldValue, eOpts) {
        var form = field.findParentByType('form');
        var dolg = form.getForm().findField('dolg3').getValue();
        var value = form.getForm().findField('newOplataOrg').getValue();
        form.down('#DoAllResetOrg').setDisabled(false);
        form.down('#NextAllResetOrg').setDisabled(false);

        if (newValue) {
            form.getForm().findField('newOplataOrg').setDisabled(false).setValue(Math.round(value+dolg)).focus();
            form.getForm().findField('cbDo3').setDisabled(true);
            form.getForm().findField('zadol3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg3').setFieldStyle('background-color: #FAFAD2; background-image: none;');
        }else {
            form.getForm().findField('newOplataOrg').setValue(Math.round(value-dolg)).focus();
            form.getForm().findField('cbDo3').setDisabled(false);
            form.getForm().findField('zadol3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno3').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg3').setFieldStyle('background-color: #F0F8FF; background-image: none;');

        }
    },

    onCbNext4Change1: function(field, newValue, oldValue, eOpts) {
        var form = field.findParentByType('form');
        var dolg = form.getForm().findField('dolg4').getValue();
        var value = form.getForm().findField('newOplataOrg').getValue();
        form.down('#DoAllResetOrg').setDisabled(false);
        form.down('#NextAllResetOrg').setDisabled(false);

        if (newValue) {
            form.getForm().findField('newOplataOrg').setDisabled(false).setValue(Math.round(value+dolg)).focus();
            form.getForm().findField('cbDo4').setDisabled(true);
            form.getForm().findField('zadol4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('period4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('nachisleno4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('oplacheno4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
            form.getForm().findField('dolg4').setFieldStyle('background-color: #FAFAD2; background-image: none;');
        }else {
            form.getForm().findField('newOplataOrg').setValue(Math.round(value-dolg)).focus();
            form.getForm().findField('cbDo4').setDisabled(false);
            form.getForm().findField('zadol4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('period4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('nachisleno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('oplacheno4').setFieldStyle('background-color: #F0F8FF; background-image: none;');
            form.getForm().findField('dolg4').setFieldStyle('background-color: #F0F8FF; background-image: none;');


        }
    },

    onNewOplataKassaOrgValidityChange: function(field, isValid, eOpts) {
        var form = field.findParentByType('form');
        if(isValid){
            form.down('#insTekPokKassaOrg').setDisabled(false);
        } else {
            form.down('#insTekPokKassaOrg').setDisabled(true);
        }
    }

});