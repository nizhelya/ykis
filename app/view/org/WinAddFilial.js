/*
 * File: app/view/org/WinAddFilial.js
 * Date: Fri Sep 11 2020 21:11:04 GMT+0300 (EEST)
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Ykis.view.org.WinAddFilial', {
    extend: 'Ext.window.Window',
    alias: 'widget.winaddfilial',

    requires: [
        'Ykis.view.org.WinAddFilialViewModel',
        'Ext.form.Panel',
        'Ext.form.FieldSet',
        'Ext.form.field.TextArea',
        'Ext.form.field.ComboBox',
        'Ext.form.RadioGroup',
        'Ext.form.field.Radio',
        'Ext.form.field.Number',
        'Ext.button.Button',
        'Ext.form.Label'
    ],

    viewModel: {
        type: 'winaddfilial'
    },
    height: 648,
    id: 'winAddFilial',
    width: 813,
    layout: 'fit',
    title: 'Добавление нового обьекта по организациии',
    modal: true,
    defaultListenerScope: true,

    items: [
        {
            xtype: 'form',
            id: 'fmAddFilial',
            width: 763,
            layout: 'absolute',
            bodyPadding: 10,
            title: '',
            items: [
                {
                    xtype: 'fieldset',
                    x: 10,
                    y: 50,
                    height: 120,
                    style: 'background-color: #DCDCDC;',
                    width: 780,
                    layout: 'absolute',
                    title: 'Наименование обьекта',
                    items: [
                        {
                            xtype: 'textareafield',
                            anchor: '100%',
                            x: 0,
                            y: 0,
                            fieldLabel: 'Полное',
                            name: 'fname',
                            allowBlank: false,
                            grow: true
                        },
                        {
                            xtype: 'textfield',
                            x: 0,
                            y: 65,
                            formBind: false,
                            id: 'nameFilialAdd',
                            width: 610,
                            fieldLabel: 'Краткое',
                            msgTarget: 'title',
                            name: 'name',
                            allowBlank: false,
                            blankText: 'Поле должно быть заполнено',
                            minLength: 1
                        },
                        {
                            xtype: 'textfield',
                            x: 635,
                            y: 65,
                            width: 120,
                            fieldLabel: 'Код орг',
                            labelWidth: 50,
                            name: 'org_id',
                            editable: false
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    x: 10,
                    y: 180,
                    height: 320,
                    style: 'background-color: #DCDCDC;',
                    width: 270,
                    layout: 'absolute',
                    title: 'Физический адрес',
                    items: [
                        {
                            xtype: 'combobox',
                            anchor: '100%',
                            x: 0,
                            y: 40,
                            padding: '5 5 5 5',
                            fieldLabel: 'Район',
                            labelWidth: 70,
                            name: 'raion_id',
                            value: 0,
                            editable: false,
                            emptyText: 'Выбрать район',
                            displayField: 'raion',
                            queryMode: 'local',
                            store: 'StRaionOrg',
                            valueField: 'raion_id',
                            listeners: {
                                select: 'onCbRaionOrgSelect'
                            }
                        },
                        {
                            xtype: 'combobox',
                            anchor: '100%',
                            x: 0,
                            y: 85,
                            padding: '5 5 5 5',
                            fieldLabel: 'Улица',
                            labelWidth: 70,
                            name: 'street_id',
                            value: 0,
                            editable: false,
                            emptyText: 'Выбрать улицу',
                            displayField: 'street',
                            queryMode: 'local',
                            store: 'StStreetOrg',
                            valueField: 'street_id',
                            listeners: {
                                select: 'onCbStreetOrgSelect'
                            }
                        },
                        {
                            xtype: 'combobox',
                            anchor: '100%',
                            x: 0,
                            y: 130,
                            padding: '5 5 5 5',
                            width: 262,
                            fieldLabel: 'Дом',
                            labelWidth: 70,
                            name: 'house_id',
                            value: 0,
                            editable: false,
                            displayField: 'house',
                            queryMode: 'local',
                            store: 'StHousesOrg',
                            valueField: 'house_id',
                            listeners: {
                                select: 'onCbHouseAddFilialSelect'
                            }
                        },
                        {
                            xtype: 'radiogroup',
                            anchor: '100%',
                            x: 0,
                            y: 190,
                            padding: '5 5 5 5',
                            width: 256,
                            fieldLabel: 'Объект',
                            labelWidth: 70,
                            items: [
                                {
                                    xtype: 'radiofield',
                                    name: 'is_flat',
                                    boxLabel: 'Квартира',
                                    inputValue: '1'
                                },
                                {
                                    xtype: 'radiofield',
                                    name: 'is_flat',
                                    boxLabel: 'Другое',
                                    checked: true,
                                    inputValue: '0'
                                }
                            ],
                            listeners: {
                                change: 'onRadiogroupChange'
                            }
                        },
                        {
                            xtype: 'combobox',
                            anchor: '100%',
                            x: 0,
                            y: 235,
                            disabled: true,
                            padding: '5 5 5 5',
                            width: 851,
                            fieldLabel: 'Кварт',
                            labelWidth: 70,
                            name: 'address_id',
                            value: 0,
                            displayField: 'address',
                            queryMode: 'local',
                            store: 'StAddressOrg',
                            typeAhead: true,
                            valueField: 'address_id',
                            valueNotFoundText: '0'
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    x: 490,
                    y: 180,
                    height: 410,
                    style: 'background-color: #DCDCDC;',
                    width: 300,
                    title: 'Технические Характеристики',
                    items: [
                        {
                            xtype: 'combobox',
                            anchor: '100%',
                            fieldLabel: '      Тип собствен',
                            labelWidth: 120,
                            name: 'sobstv_id',
                            value: 0,
                            displayField: 'name',
                            queryMode: 'local',
                            store: 'StSobstv',
                            valueField: 'sobstv_id'
                        },
                        {
                            xtype: 'combobox',
                            anchor: '100%',
                            fieldLabel: 'Назначение обьекта ВИК',
                            labelWidth: 120,
                            name: 'type_id',
                            value: 0,
                            displayField: 'name',
                            queryMode: 'local',
                            store: 'StTypes',
                            valueField: 'type_id',
                            listeners: {
                                select: 'onComboboxSelect'
                            }
                        },
                        {
                            xtype: 'combobox',
                            anchor: '100%',
                            fieldLabel: 'Назначение обьекта ЮТКЕ',
                            labelWidth: 120,
                            name: 'typeh_id',
                            value: 0,
                            displayField: 'name',
                            queryMode: 'local',
                            store: 'StUhpte',
                            valueField: 'type_id'
                        },
                        {
                            xtype: 'combobox',
                            anchor: '100%',
                            fieldLabel: 'График работы',
                            labelWidth: 120,
                            name: 'rwork_id',
                            value: 0,
                            displayField: 'name',
                            queryMode: 'local',
                            store: 'StRwork',
                            valueField: 'rwork_id'
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            fieldLabel: 'Персонал',
                            labelWidth: 120,
                            name: 'people',
                            value: 0,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            fieldLabel: 'S (м2)',
                            labelWidth: 120,
                            name: 'area',
                            value: 0,
                            allowBlank: false,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            fieldLabel: 'H  (м2)',
                            labelWidth: 120,
                            name: 'visota',
                            value: 0,
                            allowBlank: false,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            fieldLabel: 'V  (м3)',
                            labelWidth: 120,
                            name: 'volume',
                            value: 0,
                            hideTrigger: true,
                            decimalPrecision: 3
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 225,
                            fieldLabel: 'Гвода (лс/чел)',
                            labelWidth: 120,
                            name: 'nrx_gvs_d',
                            value: 0,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 225,
                            fieldLabel: 'Хвода (лс/чел)',
                            labelWidth: 120,
                            name: 'nrx_xv_d',
                            value: 0,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            width: 225,
                            fieldLabel: 'Стоки (%)',
                            labelWidth: 120,
                            name: 'pstoki',
                            value: 0,
                            hideTrigger: true
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            fieldLabel: 'График (час)',
                            labelWidth: 120,
                            name: 'qty_hour',
                            value: 0,
                            hideTrigger: true
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    x: 290,
                    y: 320,
                    height: 180,
                    style: 'background-color: #DCDCDC;',
                    width: 190,
                    title: 'Приборы учета',
                    items: [
                        {
                            xtype: 'checkboxfield',
                            anchor: '100%',
                            fieldLabel: 'Счетчик хв',
                            name: 'xvodomer',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange6'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            anchor: '100%',
                            fieldLabel: 'Счетчик гв.',
                            name: 'gvodomer',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange7'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            anchor: '100%',
                            fieldLabel: 'Норма хв',
                            name: 'norma_xv',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange8'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            anchor: '100%',
                            fieldLabel: 'Норма гв.',
                            name: 'norma_gv',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange9'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            anchor: '100%',
                            fieldLabel: 'Тепломер',
                            name: 'teplomer',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange10'
                            }
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    x: 290,
                    y: 180,
                    height: 140,
                    style: 'background-color: #DCDCDC;',
                    width: 190,
                    title: 'Потребляемые услуги',
                    items: [
                        {
                            xtype: 'checkboxfield',
                            fieldLabel: 'Отопление',
                            name: 'vkl_otopl',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            fieldLabel: 'Подогрев',
                            name: 'vkl_gvoda',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange1'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            fieldLabel: 'Хол.вода',
                            name: 'vkl_xvoda',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange2'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            fieldLabel: 'Стоки',
                            name: 'vkl_stoki',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange3'
                            }
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    x: 290,
                    y: 510,
                    height: 80,
                    style: 'background-color: #DCDCDC;',
                    width: 190,
                    title: 'Включать в отчеты',
                    items: [
                        {
                            xtype: 'checkboxfield',
                            anchor: '100%',
                            fieldLabel: 'по теплу',
                            labelWidth: 80,
                            name: 'rteplo',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange4'
                            }
                        },
                        {
                            xtype: 'checkboxfield',
                            anchor: '100%',
                            fieldLabel: 'по воде',
                            labelWidth: 80,
                            name: 'rvoda',
                            boxLabel: 'Нет',
                            inputValue: '1',
                            uncheckedValue: '0',
                            listeners: {
                                change: 'onCheckboxfieldChange5'
                            }
                        }
                    ]
                },
                {
                    xtype: 'button',
                    handler: function(button, event) {
                        this.up('#winAddFilial').close();
                    },
                    x: 10,
                    y: 530,
                    height: 30,
                    id: 'btAddFilialCancel',
                    width: 80,
                    icon: 'resources/css/images/ico/delete.png',
                    text: 'Отмена'
                },
                {
                    xtype: 'button',
                    x: 120,
                    y: 530,
                    formBind: false,
                    height: 30,
                    id: 'btOrgFilialAdd',
                    width: 160,
                    icon: 'resources/css/images/ico/add.png',
                    text: 'Добавить обьект'
                },
                {
                    xtype: 'label',
                    x: 10,
                    y: 5,
                    id: 'showOrgAddFilial',
                    padding: '10 0 5 5',
                    style: '{color: #D15706; text-shadow: -1px -1px white, 1px 1px #333;font-size:14pt;}',
                    width: 780,
                    text: 'Организация'
                }
            ]
        }
    ],

    onCbRaionOrgSelect: function(combo, record, eOpts) {
        var me = this;

        // STORE

        var StHouses = Ext.data.StoreManager.get("StHousesOrg");
        var StStreet = Ext.data.StoreManager.get("StStreetOrg");
        var stAddress = Ext.data.StoreManager.get('StAddressOrg');


        var store =combo.getStore();

        //COMBO
        var form = combo.findParentByType('form');
        var cbStreet = form.getForm().findField("street_id");
        var cbHouse = form.getForm().findField("house_id");
        var cbAddress = form.getForm().findField("address_id");


        var selected = record;


        //LOGIKA

        if (selected && !store.getById(selected.get('raion_id'))) {
            StStreet.removeAll();
            cbStreet.clearValue();
            StHouses.removeAll();
            cbHouse.clearValue();
            stAddress.removeAll();
            cbAddress.clearValue(0);
            StStreet.load({
                params: {
                    what:'StreetsFromRaion',
                    what_id: selected.get('raion_id')
                },
                scope: this
            });
        }
    },

    onCbStreetOrgSelect: function(combo, record, eOpts) {

        //COMBO
        var form = combo.findParentByType('form');
        var cbHouse = form.getForm().findField("house_id");
        var cbAddress = form.getForm().findField("address_id");


        //STORE

        var stHouses = Ext.data.StoreManager.get("StHousesOrg");
        var stAddress = Ext.data.StoreManager.get('StAddressOrg');

        var store =combo.getStore();

        var selected = record;

        //LOGIKA

        if ((selected) && !store.getById(selected.get('street_id'))) {
            stHouses.removeAll();
            cbHouse.clearValue();
            stAddress.removeAll();
            cbAddress.clearValue();
            stHouses.load({
                params: {
                    what:'HousesFromStreet',
                    what_id: selected.get('street_id')
                },
                scope: this
            });
        }
    },

    onCbHouseAddFilialSelect: function(combo, record, eOpts) {

        //COMBO
        var form = combo.findParentByType('form');
        var cbAddress = form.getForm().findField("address_id");

        //STORE

        var stAddress = Ext.data.StoreManager.get('StAddressOrg');
        var store =combo.getStore();

        var selected = record;

        //LOGIKA

        if ((selected) && !store.getById(selected.get('house_id'))) {
            stAddress.removeAll();
            cbAddress.clearValue();
            stAddress.load({
                params: {
                    what:'AddressFromHouses',
                    what_id: selected.get('house_id')
                },
                scope: this
            });

        }
    },

    onRadiogroupChange: function(field, newValue, oldValue, eOpts) {
        var me =this;
        var form = field.findParentByType('form');
        var cbAddress = form.getForm().findField("address_id");


        if (newValue.is_flat==='0') {
            cbAddress.setValue("Не квартира");
            cbAddress.setDisabled(true);
        } else {
            cbAddress.setDisabled(false);
        }

    },

    onComboboxSelect: function(combo, record, eOpts) {
        var form = combo.findParentByType('form');


        var selected = record;


        //LOGIKA

        if(selected){
            form.getForm().findField('nrx_gvs_d').setValue(selected.get('nrgv'));
            form.getForm().findField('nrx_xv_d').setValue(selected.get('nrxv'));
            form.getForm().findField('pstoki').setValue(selected.get('pstoki'));
            // console.log(selected);
        }
    },

    onCheckboxfieldChange6: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange7: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange8: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange9: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange10: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange1: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange2: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange3: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange4: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    },

    onCheckboxfieldChange5: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    }

});