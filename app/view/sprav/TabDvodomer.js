/*
 * File: app/view/sprav/TabDvodomer.js
 * Date: Mon Oct 12 2020 09:11:30 GMT+0300 (EEST)
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Ykis.view.sprav.TabDvodomer', {
    extend: 'Ext.form.Panel',
    alias: 'widget.tabdvodomer',

    requires: [
        'Ykis.view.sprav.TabDvodomerViewModel',
        'Ykis.view.sprav.TabDvodomerViewController',
        'Ext.form.Panel',
        'Ext.form.FieldSet',
        'Ext.grid.Panel',
        'Ext.view.Table',
        'Ext.grid.column.Action',
        'Ext.grid.column.Number',
        'Ext.selection.CheckboxModel',
        'Ext.button.Button',
        'Ext.form.field.Date',
        'Ext.form.field.Checkbox',
        'Ext.form.field.Display',
        'Ext.form.field.Hidden',
        'Ext.form.field.Number',
        'Ext.grid.column.Date',
        'Ext.panel.Tool',
        'Ext.toolbar.Toolbar',
        'Ext.toolbar.Separator'
    ],

    controller: 'tabdvodomer',
    viewModel: {
        type: 'tabdvodomer'
    },
    height: 817,
    id: 'tabDvodomer',
    layout: 'accordion',
    bodyPadding: 10,
    title: 'Б.Водомір',
    defaultListenerScope: true,

    initConfig: function(instanceConfig) {
        var me = this,
            config = {
                items: [
                    {
                        xtype: 'form',
                        height: 617,
                        id: 'fmDVodomers',
                        scrollable: true,
                        bodyPadding: 10,
                        icon: '',
                        title: 'Технічна характеристика будинку',
                        items: [
                            {
                                xtype: 'fieldset',
                                height: 484,
                                scrollable: true,
                                style: 'background-color: #e4dbdb;',
                                width: 1040,
                                layout: 'absolute',
                                title: '',
                                items: [
                                    {
                                        xtype: 'gridpanel',
                                        x: 0,
                                        y: 40,
                                        height: 225,
                                        id: 'grDvodomer',
                                        width: 375,
                                        title: 'Прилади обліку води',
                                        store: 'StDVodomer',
                                        listeners: {
                                            selectionchange: {
                                                fn: 'onGrDvodomerSelectionChange',
                                                scope: 'controller'
                                            }
                                        },
                                        viewConfig: {
                                            getRowClass: function(record, rowIndex, rowParams, store) {
                                                return record.get('out') === 0 ? "" : 'change_color';
                                            },
                                            height: 178
                                        },
                                        columns: [
                                            {
                                                xtype: 'actioncolumn',
                                                width: 30,
                                                menuDisabled: true,
                                                stopSelection: false,
                                                items: [
                                                    {
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            metaData = 'x-grid-center-icon';
                                                            return metaData;
                                                        },
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            Ext.MessageBox.confirm({
                                                                title: 'Заміна приладу обліку',
                                                                msg: 'Ви замінюєте прилад обліку. <br> Підтвердіть або скасуйте свої дії. ',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.ERROR,
                                                                buttonText:{
                                                                    ok:'підтверджую',
                                                                    cancel:'скасувати'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        var dt = new Date();
                                                                        var fmVodomer = Ext.getCmp('fmVodomer');
                                                                        var tek = fmVodomer.getForm().findField('tek').getValue();
                                                                        var bt = Ext.getCmp('btAddVodomer');

                                                                        var winAddVodomer = Ext.ClassManager.instantiateByAlias('widget.winaddvodomer');
                                                                        var form = winAddVodomer.down('#fmAddVodomer');
                                                                        var stUser = Ext.data.StoreManager.get("StUser");
                                                                        var values =stUser.getAt(0);
                                                                        var value = record;

                                                                        view.getSelectionModel().select(rowIndex);
                                                                        values.set({'vibor':'changeAppVodomer','rowind':rowIndex});
                                                                        stUser.sync();
                                                                        form.getForm().findField('tek').setFieldLabel('Поточні показання');

                                                                        form.getForm().findField('filial_id').hide();
                                                                        form.down('#btAddVodomer').setText('Перекидання приладу обліку');
                                                                        form.down('#fcntNewVodomer').hide();
                                                                        form.down('#chkExistentVod').hide();
                                                                        //form.getForm().findField('new_address_id').setValue(values.get('address_id'));
                                                                        form.loadRecord(value);
                                                                        form.getForm().findField('tek').setValue(tek);
                                                                        winAddVodomer.setTitle('Перекидання приладу обліку на іншу адресу');
                                                                        winAddVodomer.show();

                                                                    }
                                                                }
                                                            });
                                                        },
                                                        icon: 'resources/css/images/ico/delete.png',
                                                        tooltip: 'Перекидання приладу обліку'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                hidden: true,
                                                dataIndex: 'vodomer_id',
                                                text: 'ид',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                hidden: true,
                                                dataIndex: 'address_id',
                                                text: 'Address_id',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                hidden: true,
                                                dataIndex: 'raion',
                                                text: 'House_id'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                hidden: true,
                                                dataIndex: 'period',
                                                text: 'Address'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                                    metaData.style = 'color:#D10000;font-weight:bold;';
                                                    var retValue = '';
                                                    switch (value) {
                                                        case 'Хвода':
                                                        retValue ='<span><img clas="icon" src="resources/css/images/ico/pipex.png"/></span>';
                                                        break;
                                                        case 'Гвода':
                                                        retValue ='<span><img clas="icon" src="resources/css/images/ico/pipeg.png"/></span>';
                                                    }
                                                    return retValue;
                                                },
                                                width: 55,
                                                dataIndex: 'voda',
                                                menuDisabled: true,
                                                text: 'вода'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                                    if (record.get('out')===1){
                                                        metaData.tdCls = 'line-through';
                                                    }
                                                    return value;
                                                },
                                                width: 80,
                                                dataIndex: 'vvod',
                                                menuDisabled: true,
                                                text: 'ввод'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                                    if (record.get('out')===1){
                                                        metaData.tdCls = 'line-through';
                                                    }
                                                    return value;
                                                },
                                                width: 80,
                                                dataIndex: 'appartment',
                                                menuDisabled: true,
                                                text: 'Кварт'
                                            },
                                            {
                                                xtype: 'actioncolumn',
                                                width: 30,
                                                menuDisabled: true,
                                                tooltipType: 'title',
                                                stopSelection: false,
                                                items: [
                                                    {
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            metaData = 'x-grid-center-icon';
                                                            return metaData;
                                                        },
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            Ext.MessageBox.confirm({
                                                                title: 'Редагування приладу обліку',
                                                                msg: 'Ви редагуєте дані по приладу обліку <br> Підтвердіть або скасуйте свої дії.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.ERROR,
                                                                buttonText:{
                                                                    ok:'підтверджую',
                                                                    cancel:'скасувати'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){

                                                                        var dt = new Date();
                                                                        var fmDVodomers = Ext.getCmp('fmDVodomers');
                                                                        var tek = fmDVodomers.getForm().findField('tek').getValue();

                                                                        var WinAddDvodomer = Ext.ClassManager.instantiateByAlias('widget.winadddvodomer');
                                                                        var form = WinAddDvodomer.down('#fmAddDvodomer');
                                                                        var stUser = Ext.data.StoreManager.get("StUser");
                                                                        var values =stUser.getAt(0);
                                                                        switch (values.get('role')){
                                                                            case "7":
                                                                            form.down('#btnUpdateVvod').show();
                                                                        }
                                                                        var value = record;

                                                                        view.getSelectionModel().select(rowIndex);
                                                                        values.set({'vibor':'editDVodomer','rowind':rowIndex});
                                                                        stUser.sync();
                                                                        form.getForm().findField('tek').setFieldLabel('Поточні показання');

                                                                        form.down('#btAddDVodomer').setText('Редагування приладу обліку');
                                                                        form.loadRecord(value);
                                                                        form.getForm().findField('tek').setValue(tek);
                                                                        WinAddDvodomer.setTitle('Редагування приладу обліку');
                                                                        WinAddDvodomer.show();
                                                                    }
                                                                }
                                                            });

                                                        },
                                                        icon: 'resources/css/images/ico/edit.png'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'actioncolumn',
                                                width: 30,
                                                menuDisabled: true,
                                                text: 'В ремонт',
                                                tooltipType: 'title',
                                                items: [
                                                    {
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            // in use
                                                            var me = this;
                                                            //STORE
                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var stVodomer = Ext.data.StoreManager.get("StDVodomer");
                                                            //LOGIN & PASSWORD
                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                what:'DVodomer'

                                                            };
                                                            //GRID
                                                            var grVodomer = Ext.getCmp('grDvodomer');
                                                            //FORMA
                                                            var value = stVodomer.getAt(rowIndex).data;
                                                            //LOGIKA
                                                            Ext.Object.merge(value, params);
                                                            //console.log(value);
                                                            Ext.MessageBox.confirm({
                                                                title: 'Виведення приладу обліку в повірку',
                                                                msg: 'Ви виводите прилад обліку в повірку <br> Підтвердіть або скасуйте свої дії.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.ERROR,
                                                                buttonText:{
                                                                    ok:'підтверджую',
                                                                    cancel:'скасувати'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        QueryVodomer.outVodomerHistory(value,function(results){
                                                                            if (results.success==="1"){
                                                                                stVodomer.load({
                                                                                    params: {
                                                                                        what:'Dvodomer',
                                                                                        house_id: value.house_id,
                                                                                        dvodomer_id: value.dvodomer_id,
                                                                                        login:value.login,
                                                                                        password:value.password
                                                                                    },
                                                                                    callback: function(records,operation,success){
                                                                                        if(success){
                                                                                            grVodomer.getView().getSelectionModel().select(rowIndex);
                                                                                            Ext.MessageBox.show({
                                                                                                title: 'Повернення приладу обліку з повірки',
                                                                                                msg: results.msg,
                                                                                                buttons: Ext.MessageBox.OK,
                                                                                                icon: Ext.MessageBox.INFO
                                                                                            });
                                                                                        }
                                                                                    },
                                                                                    scope:this
                                                                                });
                                                                            }
                                                                        });
                                                                    }
                                                                }
                                                            });



                                                        },
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            var out = r.get('out');
                                                            if (out === 0 ) {
                                                                metaData = 'x-hide-display';
                                                            } else if (out === 1   ){
                                                                metaData = 'x-grid-center-icon';
                                                            }
                                                            return metaData;
                                                        },
                                                        icon: 'resources/css/images/ico/door_out.png',
                                                        tooltip: 'Повернути прилад обліку з повірки'
                                                    },
                                                    {
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            //console.log(r);
                                                            var out = r.get('out');
                                                            //console.log(out);
                                                            if (out === 1 ) {
                                                                metaData = 'x-hide-display';
                                                                //console.log(1);
                                                            } else if (out === 0   ){
                                                                metaData = 'x-grid-center-icon';
                                                                // console.log(0);
                                                            }
                                                            return metaData;
                                                        },
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {

                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var stVodomer = Ext.data.StoreManager.get("StDVodomer");
                                                            //LOGIN & PASSWORD
                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                what:'DVodomer'
                                                            };
                                                            //GRID
                                                            var grAppVodomer = Ext.getCmp('grDvodomer');
                                                            //FORMA
                                                            var value = stVodomer.getAt(rowIndex).data;
                                                            //LOGIKA
                                                            Ext.Object.merge(value, params);
                                                            //console.log(value);
                                                            Ext.MessageBox.confirm({
                                                                title: 'Виведення приладу обліку в повірку',
                                                                msg: 'Ви виводите прилад обліку в повірку <br> Підтвердіть або скасуйте свої дії.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.ERROR,
                                                                buttonText:{
                                                                    ok:'підтверджую',
                                                                    cancel:'скасувати'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        QueryVodomer.inVodomerHistory(value,function(results){
                                                                            if (results.success==="1"){
                                                                                stVodomer.load({
                                                                                    params: {
                                                                                        what:'Dvodomer',
                                                                                        house_id: value.house_id,
                                                                                        dvodomer_id: value.dvodomer_id,
                                                                                        login:value.login,
                                                                                        password:value.password
                                                                                    },
                                                                                    callback: function(records,operation,success){
                                                                                        if(success){
                                                                                            grAppVodomer.getView().getSelectionModel().select(rowIndex);
                                                                                            Ext.MessageBox.show({
                                                                                                title: 'Виведення приладу обліку в повірку',
                                                                                                msg: results.msg,
                                                                                                buttons: Ext.MessageBox.OK,
                                                                                                icon: Ext.MessageBox.INFO
                                                                                            });
                                                                                        }
                                                                                    },
                                                                                    scope:this
                                                                                });
                                                                            }
                                                                        });
                                                                    }
                                                                }
                                                            });


                                                        },
                                                        icon: 'resources/css/images/ico/maintenance_16.png',
                                                        tooltip: 'Висновок прилад обліку в повірку'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'actioncolumn',
                                                width: 30,
                                                menuDisabled: true,
                                                items: [
                                                    {
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            metaData = 'x-grid-center-icon';
                                                            return metaData;
                                                        },
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var stTekPokVodomera = Ext.data.StoreManager.get("StTekPokAppVodomera");
                                                            var StDVodomer = Ext.data.StoreManager.get("StDVodomer");//QueryTeplomer.getResults
                                                            var StHDVodomer = Ext.data.StoreManager.get("StHDVodomer");//QueryTeplomer.getResults
                                                            var StOrgByDvodomer = Ext.data.StoreManager.get("StOrgByDvodomer");//QueryTeplomer.getResults
                                                            var StAllPokDVodomera = Ext.data.StoreManager.get("StAllPokDVodomera");
                                                            StOrgByDvodomer.removeAll();
                                                            StHDVodomer.removeAll();

                                                            StAllPokDVodomera.removeAll();
                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                house_id:values.get('house_id'),
                                                                what:'DVodomer'
                                                            };
                                                            var store = view.getStore();
                                                            var value = store.getAt(rowIndex).data;

                                                            Ext.Object.merge(value, params);

                                                            Ext.MessageBox.confirm({
                                                                title: 'Видалення приладу обліку в історію',
                                                                msg: 'Ви видаляєте прилад обліку в історію <br> Підтвердіть або скасуйте свої дії.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.INFO,
                                                                buttonText:{
                                                                    ok:'підтверджую',
                                                                    cancel:'скасувати'

                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        QueryVodomer.spisanVodomer(value,function(results){
                                                                            if(results.success==="1"){
                                                                                store.load({
                                                                                    params: {
                                                                                        login:value.login,
                                                                                        what:'Dvodomer',
                                                                                        password:value.password,
                                                                                        house_id: value.house_id,
                                                                                        what_id: value.house_id
                                                                                    },
                                                                                    scope:this
                                                                                });

                                                                                StHDVodomer.load({
                                                                                    params: {
                                                                                        login:value.login,
                                                                                        password:value.password,
                                                                                        what:'HDvodomer',
                                                                                        house_id: value.house_id,
                                                                                        what_id: value.house_id
                                                                                    },
                                                                                    scope:this
                                                                                });
                                                                            } else {
                                                                                Ext.MessageBox.show({
                                                                                    title: 'Видалення приладу обліку в історію',
                                                                                    msg: results.msg,
                                                                                    buttons: Ext.MessageBox.OK,
                                                                                    icon: Ext.MessageBox.ERROR
                                                                                });
                                                                            }
                                                                        });
                                                                    }
                                                                }
                                                            });
                                                        },
                                                        icon: 'resources/css/images/ico/no.png',
                                                        tooltip: 'Видалити прилад обліку в історію'
                                                    }
                                                ]
                                            }
                                        ],
                                        selModel: Ext.create('Ext.selection.CheckboxModel', {
                                            selType: 'checkboxmodel'
                                        })
                                    },
                                    {
                                        xtype: 'button',
                                        x: 5,
                                        y: 5,
                                        id: 'addDVodomer',
                                        width: 175,
                                        icon: 'resources/css/images/ico/add.png',
                                        text: 'Додати прилад обліку '
                                    },
                                    {
                                        xtype: 'button',
                                        handler: function(button, e) {
                                            var StUser = Ext.data.StoreManager.get("StUser");
                                            var StReport = Ext.data.StoreManager.get("StReport");
                                            var values =StUser.getAt(0);
                                            var house_id =values.get('house_id');

                                            var usertype = 1;

                                            //V
                                            var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();
                                            var grid = Ext.getCmp('grDvodomer');
                                            var gridRowSelectedRecords  = grid.getView().getSelectionModel().getSelection();
                                            var size = Ext.Object.getSize(gridRowSelectedRecords) ;
                                            var dvodomer =[];
                                            if (size >= 1){

                                                Ext.Object.each(gridRowSelectedRecords, function(key, val, myself) {
                                                    Ext.Object.merge(val.data.dvodomer);
                                                    dvodomer.push(val.data.dvodomer_id);
                                                });

                                            }
                                            console.log(house_id);

                                            if (house_id) {

                                                var report = 'AktOplombirovkiDvodomer';
                                                var namereport = 'Акт опломбування';

                                                var value = {
                                                    login:values.get('login'),
                                                    password:values.get('password'),
                                                    report:report,
                                                    what:report,
                                                    house_id:house_id,
                                                    dvodomer: dvodomer
                                                };

                                                var tab = tabPnCenter.child('#'+report);

                                                if (!tab) {
                                                    tab  = tabPnCenter.add({
                                                        xtype:'tabreportorg',
                                                        title:namereport,
                                                        id:''+report+''
                                                    });

                                                    tabPnCenter.setActiveTab(tab);

                                                }else{

                                                    tabPnCenter.setActiveTab(tab);
                                                }

                                                var reppan = tab.getComponent(0);


                                                var myMask= Ext.Msg.show({
                                                    title:'Отчеты...',
                                                    msg: 'Завантаження отчета.Ожідайте...',
                                                    buttons: Ext.Msg.CANCEL,
                                                    wait: true,
                                                    modal: true,
                                                    icon: Ext.Msg.INFO
                                                });

                                                QueryReport.getResults(value,function(data){
                                                    if (data){

                                                        //    reportHead.update(data.head);
                                                        reppan.update(data.content);
                                                        //      reportFoot.update(data.foot);
                                                        Ext.REPORTCONTENT =data.content;
                                                        myMask.close();


                                                    } else {
                                                        Ext.MessageBox.show({
                                                            title: 'Ошибка ',
                                                            msg: 'Документ не створено',
                                                            buttons: Ext.MessageBox.OK,
                                                            icon: Ext.MessageBox.ERROR

                                                        });

                                                    }

                                                });
                                                myMask.close();


                                            }

                                        },
                                        x: 205,
                                        y: 275,
                                        id: 'aktOplombDvod',
                                        width: 165,
                                        icon: 'resources/css/images/ico/add.png',
                                        text: 'Акт опломбування'
                                    },
                                    {
                                        xtype: 'button',
                                        handler: function(button, e) {

                                            var StUser = Ext.data.StoreManager.get("StUser");
                                            var StReport = Ext.data.StoreManager.get("StReport");
                                            var values =StUser.getAt(0);
                                            var house_id =values.get('house_id');

                                            var usertype = 1;

                                            //V
                                            var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();
                                            var grid = Ext.getCmp('grDvodomer');
                                            var gridRowSelectedRecords  = grid.getView().getSelectionModel().getSelection();
                                            var size = Ext.Object.getSize(gridRowSelectedRecords) ;
                                            var dvodomer =[];
                                            if (size >= 1){

                                                Ext.Object.each(gridRowSelectedRecords, function(key, val, myself) {
                                                    Ext.Object.merge(val.data.dvodomer);
                                                    dvodomer.push(val.data.dvodomer_id);
                                                });

                                            }

                                            if (house_id) {

                                                var report = 'AktRasplombirovkiDvodomer';
                                                var namereport = 'Акт розпломбування';

                                                var value = {
                                                    login:values.get('login'),
                                                    password:values.get('password'),
                                                    report:report,
                                                    what:report,
                                                    house_id:house_id,
                                                    dvodomer: dvodomer
                                                };

                                                var tab = tabPnCenter.child('#'+report);

                                                if (!tab) {
                                                    tab  = tabPnCenter.add({
                                                        xtype:'tabreportorg',
                                                        title:namereport,
                                                        id:''+report+''
                                                    });

                                                    tabPnCenter.setActiveTab(tab);

                                                }else{

                                                    tabPnCenter.setActiveTab(tab);
                                                }

                                                var reppan = tab.getComponent(0);


                                                var myMask= Ext.Msg.show({
                                                    title:'Отчеты...',
                                                    msg: 'Завантаження отчета.Ожідайте...',
                                                    buttons: Ext.Msg.CANCEL,
                                                    wait: true,
                                                    modal: true,
                                                    icon: Ext.Msg.INFO
                                                });

                                                QueryReport.getResults(value,function(data){
                                                    if (data){

                                                        //    reportHead.update(data.head);
                                                        reppan.update(data.content);
                                                        //      reportFoot.update(data.foot);
                                                        Ext.REPORTCONTENT =data.content;
                                                        myMask.close();


                                                    } else {
                                                        Ext.MessageBox.show({
                                                            title: 'Ошибка ',
                                                            msg: 'Документ не створено',
                                                            buttons: Ext.MessageBox.OK,
                                                            icon: Ext.MessageBox.ERROR

                                                        });

                                                    }

                                                });
                                                myMask.close();


                                            }

                                        },
                                        x: 5,
                                        y: 275,
                                        id: 'aktRasplombDvod',
                                        width: 160,
                                        icon: 'resources/css/images/ico/add.png',
                                        text: 'Акт розпломбування'
                                    },
                                    {
                                        xtype: 'fieldset',
                                        x: 385,
                                        y: 205,
                                        height: 255,
                                        style: 'background-color: #f1eeee;',
                                        width: 145,
                                        layout: 'absolute',
                                        title: 'Останнє показаня',
                                        items: [
                                            {
                                                xtype: 'datefield',
                                                anchor: '100%',
                                                width: 145,
                                                fieldLabel: 'Дата',
                                                labelWidth: 35,
                                                name: 'data',
                                                readOnly: true,
                                                altFormats: 'd.m.y|d/m/Y|d-m-y|d-m-Y|d/m|d-m|dm|dmy|dmY|d|Y-m-d',
                                                format: 'd-m-Y'
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 35,
                                                width: 145,
                                                fieldLabel: 'Показ',
                                                labelWidth: 55,
                                                name: 'pok_id',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 70,
                                                width: 145,
                                                fieldLabel: 'Поперед',
                                                labelWidth: 55,
                                                name: 'pred',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 105,
                                                width: 145,
                                                fieldLabel: 'Поточні',
                                                labelWidth: 55,
                                                name: 'tekp',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 140,
                                                width: 145,
                                                fieldLabel: 'кубов',
                                                labelWidth: 55,
                                                name: 'kub',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'button',
                                                handler: function(button, e) {

                                                    var stUser = Ext.data.StoreManager.get("StUser");
                                                    var stWater = Ext.data.StoreManager.get("StAllPokDVodomera");//QueryVodomer.getResults  <AllPokVodomera>
                                                    var stTekPokVodomera = Ext.data.StoreManager.get("StTekPokDVodomera");//QueryVodomer.getResults <TekPokVodomera>
                                                    //LOGIN & PASSWORD

                                                    var values =stUser.getAt(0);
                                                    var params = {
                                                        login:values.get('login'),
                                                        password:values.get('password'),
                                                        address_id:values.get('address_id'),
                                                        house_id:values.get('house_id'),
                                                        what:'DVodomer'

                                                    };

                                                    var fmVodomer = Ext.getCmp('fmDVodomers');
                                                    var value = fmVodomer.getValues();


                                                    Ext.Object.merge(value, params);
                                                    Ext.MessageBox.confirm({
                                                        title: 'Видалення останніх показань приладу обліку',
                                                        msg: 'Ви видаляєте останнім показання по приладу обліку <br>Показання<b>'+value.tek+
                                                        '</b><br>Підтвердіть або скасуйте свої дії.',
                                                        buttons: Ext.MessageBox.OKCANCEL,
                                                        icon: Ext.MessageBox.ERROR,
                                                        buttonText:{
                                                            ok: 'подтвеждаю',
                                                            cancel: 'скасування'
                                                        },
                                                        fn:function(btn,newValue){
                                                            if(btn=='ok'){
                                                                QueryVodomer.delPokVodomera(value,function(results){
                                                                    if (results.success){
                                                                        Ext.MessageBox.show({title: 'Видалення останніх показань приладу обліку ',
                                                                            msg: results.msg,
                                                                            buttons: Ext.MessageBox.OK,
                                                                            icon: Ext.MessageBox.INFO
                                                                        });
                                                                        fmVodomer.getForm().findField('newValue').setValue(0);
                                                                        stWater.load({
                                                                            params: {
                                                                                what:'AllPokDVodomera',
                                                                                what_id: value.dvodomer_id,
                                                                                dvodomer_id: value.dvodomer_id,
                                                                                login:value.login,
                                                                                password:value.password
                                                                            },
                                                                            scope:this
                                                                        });

                                                                        stTekPokVodomera.load({
                                                                            params: {
                                                                                what:'TekPokDVodomera',
                                                                                dvodomer_id: value.dvodomer_id,
                                                                                what_id: value.dvodomer_id,
                                                                                login:value.login,
                                                                                password:value.password
                                                                            },
                                                                            callback: function(records,operation,success){
                                                                                if(success){
                                                                                    fmVodomer.getForm().loadRecord(records[0]);
                                                                                }
                                                                            },
                                                                            scope:this
                                                                        });

                                                                    }else{
                                                                        Ext.MessageBox.show({title: 'Видалення останніх показань приладу обліку',
                                                                            msg: results.msg,
                                                                            buttons: Ext.MessageBox.OK,
                                                                            icon: Ext.MessageBox.ERROR
                                                                        });
                                                                    }
                                                                });
                                                            }
                                                        }
                                                    });

                                                },
                                                anchor: '100%',
                                                x: 0,
                                                y: 175,
                                                disabled: true,
                                                id: 'delTekPokDvodomera',
                                                icon: 'resources/css/images/ico/no.png',
                                                text: 'Удалить  показ'
                                            },
                                            {
                                                xtype: 'checkboxfield',
                                                handler: function(checkbox, checked) {
                                                    var form = checkbox.findParentByType('form');
                                                    if(checked){

                                                        form.down('#delTekPokDvodomera').setDisabled(false);

                                                    }else{

                                                        form.down('#delTekPokDvodomera').setDisabled(true);

                                                    }
                                                },
                                                anchor: '100%',
                                                x: 0,
                                                y: 200,
                                                fieldLabel: 'вкл кнопку',
                                                labelWidth: 80,
                                                name: 'vkl_del'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        x: 385,
                                        y: 0,
                                        height: 185,
                                        style: 'background-color: #f1eeee;',
                                        width: 630,
                                        layout: 'absolute',
                                        title: 'Технічна характеристика',
                                        items: [
                                            {
                                                xtype: 'displayfield',
                                                renderer: function(value, displayField) {
                                                    var retValue = '';
                                                    switch (value) {
                                                        case 'Хвода':
                                                        retValue ='<span><img clas="icon" src="resources/css/images/ico/pipeX.png"/></span>';
                                                        break;
                                                        case 'Гвода':
                                                        retValue ='<span><img clas="icon" src="resources/css/images/ico/pipeGv.png"/></span>';
                                                        break;

                                                    }
                                                    return retValue;
                                                },
                                                x: 0,
                                                y: 0,
                                                height: 42,
                                                width: 50,
                                                fieldLabel: '',
                                                labelSeparator: ' ',
                                                name: 'voda'
                                            },
                                            {
                                                xtype: 'textfield',
                                                x: 50,
                                                y: 10,
                                                width: 65,
                                                fieldLabel: '',
                                                labelWidth: 50,
                                                name: 'dvodomer_id',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                x: 115,
                                                y: 10,
                                                padding: '0 5 0 5',
                                                style: '{color: #378005; text-shadow: -1px -1px white, 1px 1px #333;font-size:14pt;}',
                                                width: 170,
                                                fieldLabel: '',
                                                name: 'model',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                x: 290,
                                                y: 10,
                                                padding: '0 5 0 5',
                                                width: 175,
                                                fieldLabel: 'Номер',
                                                labelWidth: 50,
                                                name: 'nomer',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                x: 480,
                                                y: 10,
                                                width: 120,
                                                fieldLabel: 'Ввод',
                                                labelWidth: 40,
                                                name: 'vvod',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'datefield',
                                                x: 175,
                                                y: 50,
                                                width: 195,
                                                fieldLabel: 'дата випуску',
                                                labelWidth: 90,
                                                name: 'zdate',
                                                readOnly: true,
                                                altFormats: 'd-m-Y|m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d|n-j|n/j',
                                                format: 'd-m-Y'
                                            },
                                            {
                                                xtype: 'datefield',
                                                x: 395,
                                                y: 50,
                                                padding: '0 5 0 5',
                                                width: 200,
                                                fieldLabel: 'Дата введення',
                                                name: 'sdate',
                                                readOnly: true,
                                                altFormats: 'd-m-Y|m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d|n-j|n/j',
                                                format: 'd-m-Y',
                                                submitFormat: 'Ymd'
                                            },
                                            {
                                                xtype: 'textfield',
                                                x: 5,
                                                y: 50,
                                                width: 150,
                                                fieldLabel: 'Квартиры',
                                                labelWidth: 60,
                                                name: 'appartment',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'fieldset',
                                                x: 5,
                                                y: 85,
                                                height: 60,
                                                style: 'background-color: #e4dbdb;',
                                                width: 595,
                                                layout: 'absolute',
                                                title: 'Поверка',
                                                items: [
                                                    {
                                                        xtype: 'datefield',
                                                        width: 170,
                                                        fieldLabel: 'Попередня',
                                                        labelWidth: 80,
                                                        name: 'pdate',
                                                        readOnly: true,
                                                        altFormats: 'd.m.y|d/m/Y|d-m-y|d-m-Y|d/m|d-m|dm|dmy|dmY|d|Y-m-d',
                                                        format: 'd-m-Y'
                                                    },
                                                    {
                                                        xtype: 'datefield',
                                                        x: 185,
                                                        y: 0,
                                                        width: 175,
                                                        fieldLabel: 'Наступна',
                                                        labelWidth: 70,
                                                        name: 'fpdate',
                                                        readOnly: true,
                                                        altFormats: 'd-m-Y|m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d|n-j|n/j',
                                                        format: 'd-m-Y'
                                                    },
                                                    {
                                                        xtype: 'textfield',
                                                        x: 380,
                                                        y: 0,
                                                        width: 185,
                                                        fieldLabel: 'Пломба',
                                                        labelWidth: 50,
                                                        name: 'plomba'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'hiddenfield',
                                                x: 565,
                                                y: 115,
                                                width: 120,
                                                fieldLabel: '',
                                                labelWidth: 75,
                                                name: 'type'
                                            },
                                            {
                                                xtype: 'hiddenfield',
                                                x: 559,
                                                y: 106,
                                                width: 160,
                                                fieldLabel: 'Место',
                                                labelWidth: 60,
                                                name: 'house_id'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'button',
                                        handler: function(button, e) {
                                            var form = button.findParentByType('form');
                                            var value = form.getValues();
                                            var stUser = Ext.data.StoreManager.get("StUser");

                                            //LOGIN & PASSWORD

                                            var values =stUser.getAt(0);
                                            var params = {
                                                login:values.get('login'),
                                                password:values.get('password'),
                                                what:"insPoverkaDvod"
                                            };

                                            Ext.Object.merge(value, params);

                                            var myMask= Ext.Msg.show({
                                                title:'Оновлення приладу обліку...',
                                                msg: 'Введення дати розпломбування приладу обліку.Чекайте...',
                                                buttons: Ext.Msg.CANCEL,
                                                wait: true,
                                                modal: true,
                                                icon: Ext.Msg.INFO
                                            });
                                            QueryVodomer.updateVodomer(value,function(results){
                                                if (results.success){
                                                    Ext.MessageBox.show({
                                                        title: 'Оновлення приладу обліку',
                                                        msg: results.msg,
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.INFO
                                                    });

                                                }else{
                                                    Ext.MessageBox.show({
                                                        title: 'Оновлення приладу обліку',
                                                        msg: results.msg,
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.ERROR
                                                    });
                                                }
                                                //myMask.close();

                                            });

                                        },
                                        x: 920,
                                        y: 210,
                                        shadowOffset: 2,
                                        border: '2px',
                                        disabled: true,
                                        id: 'InsPoverkaDvod',
                                        width: 95,
                                        icon: 'resources/css/images/ico/yes22.png',
                                        text: 'Записати'
                                    },
                                    {
                                        xtype: 'fieldset',
                                        x: 550,
                                        y: 255,
                                        height: 205,
                                        style: 'background-color: #f1eeee;',
                                        width: 455,
                                        layout: 'absolute',
                                        title: 'Період за середнім',
                                        items: [
                                            {
                                                xtype: 'datefield',
                                                x: 200,
                                                y: 5,
                                                disabled: true,
                                                width: 190,
                                                fieldLabel: 'Дата закінч',
                                                labelWidth: 80,
                                                name: 'data_do',
                                                format: 'd-m-Y',
                                                submitFormat: 'Ymd',
                                                listeners: {
                                                    change: {
                                                        fn: 'onDatefieldChange11',
                                                        scope: 'controller'
                                                    }
                                                }
                                            },
                                            {
                                                xtype: 'datefield',
                                                x: 0,
                                                y: 5,
                                                disabled: true,
                                                width: 195,
                                                fieldLabel: 'дата початку',
                                                labelWidth: 85,
                                                name: 'data_ot',
                                                format: 'd-m-Y',
                                                submitFormat: 'Ymd'
                                            },
                                            {
                                                xtype: 'fieldset',
                                                x: 0,
                                                y: 35,
                                                height: 135,
                                                style: 'background-color: #e4dbdb;',
                                                width: 428,
                                                layout: 'absolute',
                                                title: 'Розрахувати за середнім',
                                                items: [
                                                    {
                                                        xtype: 'button',
                                                        handler: function(button, e) {
                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var stWater = Ext.data.StoreManager.get("StAllPokDVodomera");
                                                            var stTekPokVodomera = Ext.data.StoreManager.get("StTekPokDVodomera");//LOGIN & PASSWORD


                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                house_id:values.get('house_id'),
                                                                what:'insMeedlePokDVod'

                                                            };

                                                            var fmVodomer = Ext.getCmp('fmDVodomers');
                                                            var value = fmVodomer.getValues();
                                                            console.log(value);
                                                            Ext.Object.merge(value, params);
                                                            var newValue = value.newKubov;
                                                            var max = newValue;
                                                            if (isNaN(newValue) || (max.length ===0)){
                                                                Ext.MessageBox.show({
                                                                    title: 'Перевірка даних, що вводяться',
                                                                    msg: 'Введіть число',
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.ERROR
                                                                });
                                                                fmVodomer.getForm().findField('newKubov').focus();

                                                                return false;
                                                            } else if (max <= 0){
                                                                Ext.MessageBox.show({
                                                                    title: 'Перевірка даних, що вводяться',
                                                                    msg: 'Введені свідчення менше або дорівнюють нулю <b>' + max + '</ b> <br> Введіть правильні показяння!.',
                                                                    buttons: Ext.MessageBox.CANCEL,
                                                                    icon: Ext.MessageBox.ERROR,
                                                                    buttonText:{
                                                                        cancel:'скасувати'
                                                                    },
                                                                    fn:function(btn,newValue){
                                                                        if(btn=='cancel'){
                                                                            fmVodomer.getForm().findField('newKubov').focus();
                                                                            return false;
                                                                        }
                                                                    }
                                                                });
                                                            }else if(max > 5) {
                                                                Ext.MessageBox.confirm({
                                                                    title: 'Перевірка даних, що вводяться',
                                                                    msg: 'Введені показання  дуже великі <b>'+ max +'</b> <br>Підтвердіть або скасуйте вводяться свідчення..',
                                                                    buttons: Ext.MessageBox.OKCANCEL,
                                                                    icon: Ext.MessageBox.ERROR,
                                                                    buttonText:{
                                                                        ok:'підтверджую',
                                                                        cancel:'скасувати'
                                                                    },
                                                                    fn:function(btn,newValue){
                                                                        if(btn=='cancel'){
                                                                            fmVodomer.getForm().findField('newKubov').focus();
                                                                            return false;
                                                                        }else{
                                                                            QueryVodomer.newPokVodomera(value,function(results){
                                                                                if (results.success){
                                                                                    fmVodomer.getForm().findField('newKubov').setValue(0);
                                                                                    stWater.load({
                                                                                        params: {
                                                                                            what:'AllPokDVodomera',
                                                                                            what_id: value.dvodomer_id,
                                                                                            dvodomer_id: value.dvodomer_id,
                                                                                            login:value.login,
                                                                                            password:value.password
                                                                                        },
                                                                                        scope:this
                                                                                    });
                                                                                    stTekPokVodomera.load({
                                                                                        params: {
                                                                                            what:'TekPokDVodomera',
                                                                                            what_id: value.dvodomer_id,
                                                                                            dvodomer_id: value.dvodomer_id,
                                                                                            login:value.login,
                                                                                            password:value.password
                                                                                        },
                                                                                        callback: function(records,operation,success){
                                                                                            if(success){
                                                                                                fmVodomer.getForm().loadRecord(records[0]);
                                                                                            }
                                                                                        },
                                                                                        scope:this
                                                                                    });
                                                                                }
                                                                            });
                                                                        }
                                                                    }
                                                                });


                                                            } else {
                                                                QueryVodomer.newPokVodomera(value,function(results){
                                                                    if (results.success){

                                                                        fmVodomer.getForm().findField('newKubov').setValue(0);
                                                                        stWater.load({
                                                                            params: {
                                                                                what:'AllPokDVodomera',
                                                                                what_id: value.dvodomer_id,
                                                                                dvodomer_id: value.dvodomer_id,
                                                                                login:value.login,
                                                                                password:value.password
                                                                            },
                                                                            scope:this
                                                                        });
                                                                        stTekPokVodomera.load({
                                                                            params: {
                                                                                what:'TekPokDVodomera',
                                                                                what_id: value.dvodomer_id,
                                                                                dvodomer_id: value.dvodomer_id,
                                                                                login:value.login,
                                                                                password:value.password
                                                                            },
                                                                            callback: function(records,operation,success){
                                                                                if(success){
                                                                                    fmVodomer.getForm().loadRecord(records[0]);
                                                                                }
                                                                            },
                                                                            scope:this
                                                                        });

                                                                    }
                                                                });
                                                            }

                                                        },
                                                        x: 305,
                                                        y: 70,
                                                        shadowOffset: 2,
                                                        border: '2px',
                                                        disabled: true,
                                                        id: 'insMeedlePokDVod',
                                                        width: 100,
                                                        icon: 'resources/css/images/ico/yes22.png',
                                                        text: 'Записати'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        x: 135,
                                                        y: 70,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 165,
                                                        fieldLabel: 'Кубів за серед',
                                                        labelWidth: 95,
                                                        name: 'newKubov',
                                                        value: 0,
                                                        allowBlank: false,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        autoStripChars: true,
                                                        decimalPrecision: 0,
                                                        minValue: 0,
                                                        negativeText: 'Значение должно быть больше 1'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        x: 0,
                                                        y: 70,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 130,
                                                        fieldLabel: 'Днів за серед',
                                                        labelWidth: 90,
                                                        name: 'days',
                                                        value: 0,
                                                        allowBlank: false,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        allowDecimals: false,
                                                        autoStripChars: true,
                                                        decimalPrecision: 0,
                                                        minValue: 0,
                                                        negativeText: 'Значение должно быть больше 1'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        x: 0,
                                                        y: 5,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 190,
                                                        fieldLabel: 'показання від',
                                                        labelWidth: 90,
                                                        name: 'pok_ot',
                                                        value: 0,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        autoStripChars: true,
                                                        decimalPrecision: 3,
                                                        minValue: 0,
                                                        negativeText: 'Значение должно быть больше 1'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        x: 205,
                                                        y: 5,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 200,
                                                        fieldLabel: 'показання до',
                                                        labelWidth: 90,
                                                        name: 'pok_do',
                                                        value: 0,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        autoStripChars: true,
                                                        decimalPrecision: 3,
                                                        minValue: 0,
                                                        negativeText: 'Значение должно быть больше 1'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        x: 0,
                                                        y: 35,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 115,
                                                        fieldLabel: 'Кільк днів',
                                                        labelWidth: 70,
                                                        name: 'rday',
                                                        value: 0,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        allowDecimals: false,
                                                        autoStripChars: true,
                                                        decimalPrecision: 0,
                                                        minValue: 0,
                                                        negativeText: 'Значение должно быть больше 1'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        x: 120,
                                                        y: 35,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 135,
                                                        fieldLabel: 'Куб разр',
                                                        labelWidth: 70,
                                                        name: 'qty_kub',
                                                        value: 0,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        autoStripChars: true,
                                                        decimalPrecision: 0,
                                                        minValue: 0
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        x: 265,
                                                        y: 35,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 140,
                                                        fieldLabel: 'Кубів/Дн',
                                                        labelWidth: 60,
                                                        name: 'kub_day',
                                                        value: 0,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        autoStripChars: true,
                                                        decimalPrecision: 4
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'button',
                                                handler: function(button, e) {
                                                    // in use
                                                    //var me = this;
                                                    //STORE

                                                    var stUser = Ext.data.StoreManager.get("StUser");
                                                    //LOGIN & PASSWORD
                                                    var fmVodomer = Ext.getCmp('fmDVodomers');
                                                    var dvodomer_id = fmVodomer.getForm().findField('dvodomer_id');
                                                    var insMeedlePokVod = fmVodomer.down('#insMeedlePokDVod');
                                                    var date_ot = fmVodomer.getForm().findField('data_ot');
                                                    var date_do = fmVodomer.getForm().findField('data_do');
                                                    var days = fmVodomer.getForm().findField('days');
                                                    var pok_ot = fmVodomer.getForm().findField('pok_ot');
                                                    var pok_do = fmVodomer.getForm().findField('pok_do');
                                                    var rday = fmVodomer.getForm().findField('rday');
                                                    var kub_day = fmVodomer.getForm().findField('kub_day');
                                                    var newKubov = fmVodomer.getForm().findField('newKubov');
                                                    var qty_kub = fmVodomer.getForm().findField('qty_kub');

                                                    var value = fmVodomer.getValues();


                                                    var values =stUser.getAt(0);
                                                    var params = {
                                                        login:values.get('login'),
                                                        password:values.get('password'),
                                                        dvodomer_id:values.get('dvodomer_id'),
                                                        what:"AddMeedlePokDVod"
                                                    };
                                                    Ext.Object.merge(value, params);
                                                    QueryVodomer.updateVodomer(value,function(results){
                                                        if (results.success){

                                                            date_ot.setDisabled(false);
                                                            date_do.setDisabled(false);
                                                            pok_do.setDisabled(false);
                                                            pok_ot.setDisabled(false);
                                                            days.setDisabled(false);
                                                            rday.setDisabled(false);
                                                            kub_day.setDisabled(false);
                                                            newKubov.setDisabled(false);
                                                            qty_kub.setDisabled(false);

                                                            insMeedlePokVod.setDisabled(false);
                                                            date_ot.setValue(results.data_ot);
                                                            date_do.setValue(results.data_do);
                                                            pok_ot.setValue(results.pok_ot);
                                                            pok_do.setValue(results.pok_do);
                                                            rday.setValue(results.rday);
                                                            kub_day.setValue(results.kub_day);
                                                            days.setValue(results.days);
                                                            qty_kub.setValue(results.qty_kub);
                                                            newKubov.setValue(results.kubov);
                                                        } else {
                                                            Ext.MessageBox.show({
                                                                title: 'Розрахунок за середнім',
                                                                msg: results.msg,
                                                                buttons: Ext.MessageBox.OK,
                                                                icon: Ext.MessageBox.INFO
                                                            });
                                                        }
                                                    });

                                                },
                                                x: 400,
                                                y: 0,
                                                shadowOffset: 2,
                                                id: 'AddMeedlePokDVod',
                                                icon: 'resources/css/images/ico/schet.png',
                                                scale: 'medium',
                                                text: '',
                                                tooltip: 'Нарахувати за середнім',
                                                tooltipType: 'title'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        x: 0,
                                        y: 310,
                                        height: 150,
                                        style: 'background-color: #f1eeee;',
                                        width: 375,
                                        layout: 'absolute',
                                        title: 'Введення нових показань',
                                        items: [
                                            {
                                                xtype: 'fieldset',
                                                x: 0,
                                                y: 5,
                                                height: 85,
                                                style: 'background-color: #e4dbdb;',
                                                width: 160,
                                                title: 'Попередні',
                                                items: [
                                                    {
                                                        xtype: 'datefield',
                                                        anchor: '100%',
                                                        fieldLabel: 'Дата',
                                                        labelWidth: 50,
                                                        name: 'date_old',
                                                        readOnly: true,
                                                        format: 'd-m-Y',
                                                        submitFormat: 'Ymd'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        anchor: '100%',
                                                        fieldLabel: 'Показ',
                                                        labelWidth: 50,
                                                        name: 'tek',
                                                        readOnly: true,
                                                        hideTrigger: true,
                                                        autoStripChars: true,
                                                        decimalPrecision: 3
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'fieldset',
                                                x: 170,
                                                y: 0,
                                                height: 115,
                                                style: 'background-color: #e4dbdb;',
                                                width: 180,
                                                title: 'Нове',
                                                items: [
                                                    {
                                                        xtype: 'datefield',
                                                        anchor: '100%',
                                                        fieldLabel: 'Дата',
                                                        labelWidth: 50,
                                                        name: 'date_new',
                                                        allowBlank: false,
                                                        format: 'd-m-Y',
                                                        submitFormat: 'Ymd'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        anchor: '100%',
                                                        formBind: false,
                                                        shadowOffset: 1,
                                                        id: 'newPokDVod',
                                                        fieldLabel: 'Показ',
                                                        labelWidth: 50,
                                                        name: 'newValue',
                                                        value: 0,
                                                        allowBlank: false,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        autoStripChars: true,
                                                        decimalPrecision: 3,
                                                        minValue: 0,
                                                        negativeText: 'Значение должно быть больше 1'
                                                    },
                                                    {
                                                        xtype: 'button',
                                                        handler: function(button, e) {
                                                            // in use
                                                            var me = this;
                                                            //STORE

                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var stWater = Ext.data.StoreManager.get("StAllPokDVodomera");
                                                            var stTekPokVodomera = Ext.data.StoreManager.get("StTekPokDVodomera");


                                                            //LOGIN & PASSWORD

                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                house_id:values.get('house_id'),
                                                                what:"DVodomer"
                                                            };
                                                            //FORMA
                                                            var fmVodomer = Ext.getCmp('fmDVodomers');
                                                            var value = fmVodomer.getValues();
                                                            //LOGIKA


                                                            Ext.Object.merge(value, params);
                                                            var newValue = value.newValue;
                                                            var max =newValue - value.tek;
                                                            if (isNaN(newValue) || (max.length ===0)){
                                                                Ext.MessageBox.show({
                                                                    title: 'Перевірка даних, що вводяться',
                                                                    msg: 'Введіть число',
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.ERROR
                                                                });
                                                                fmVodomer.down('#newPokDVod').focus();

                                                                return false;
                                                            }else if (max<=0){
                                                                Ext.MessageBox.show({
                                                                    title: 'Перевірка даних, що вводяться',
                                                                    msg: 'Введені свідчення менше або дорівнюють нулю <b>' + max + '</ b> <br> Введіть правильні показяння!.',
                                                                    buttons: Ext.MessageBox.CANCEL,
                                                                    icon: Ext.MessageBox.ERROR,
                                                                    buttonText:{
                                                                        cancel:'скасувати'
                                                                    },
                                                                    fn:function(btn,newValue){
                                                                        if(btn=='cancel'){
                                                                            fmVodomer.down('#newPokAppVod').focus();
                                                                            return false;
                                                                        }
                                                                    }
                                                                });
                                                            } else if(max > 500) {
                                                                Ext.MessageBox.confirm({
                                                                    title: 'Перевірка даних, що вводяться',
                                                                    msg: 'Введені показання  дуже великі <b>'+ max +'</b> <br>Підтвердіть або скасуйте вводяться свідчення..',
                                                                    buttons: Ext.MessageBox.OKCANCEL,
                                                                    icon: Ext.MessageBox.ERROR,
                                                                    buttonText:{
                                                                        ok:'підтверджую',
                                                                        cancel:'скасувати'
                                                                    },
                                                                    fn:function(btn,newValue){
                                                                        if(btn=='cancel'){
                                                                            fmVodomer.down('#newPokDVod').focus();
                                                                            return false;
                                                                        } else {
                                                                            QueryVodomer.newPokVodomera(value,function(data){
                                                                                if (data.success){
                                                                                    Ext.MessageBox.confirm({
                                                                                        title: 'Перевірка даних, що вводяться',
                                                                                        msg: 'Нові показання введені',
                                                                                        buttons: Ext.MessageBox.OK,
                                                                                        icon: Ext.MessageBox.INFO
                                                                                    });
                                                                                    fmVodomer.down('#newPokDVod').setValue(0);

                                                                                    stTekPokVodomera.load({
                                                                                        params: {
                                                                                            what:'TekPokDVodomera',
                                                                                            what_id: value.dvodomer_id,
                                                                                            dvodomer_id: value.dvodomer_id,
                                                                                            login:value.login,
                                                                                            password:value.password
                                                                                        },
                                                                                        callback: function(records,operation,success){
                                                                                            if(success){
                                                                                                fmVodomer.getForm().loadRecord(records[0]);
                                                                                            }
                                                                                        },
                                                                                        scope:this
                                                                                    });
                                                                                    stWater.load({
                                                                                        params: {
                                                                                            what:'AllPokDVodomera',
                                                                                            what_id: value.dvodomer_id,
                                                                                            dvodomer_id: value.dvodomer_id,
                                                                                            login:value.login,
                                                                                            password:value.password
                                                                                        },
                                                                                        scope:this
                                                                                    });

                                                                                }
                                                                            });
                                                                        }
                                                                    }
                                                                });
                                                            } else {
                                                                QueryVodomer.newPokVodomera(value,function(data){
                                                                    if (data.success){
                                                                        Ext.MessageBox.confirm({
                                                                            title: 'Перевірка даних, що вводяться',
                                                                            msg: 'Нові показання введені',
                                                                            buttons: Ext.MessageBox.OK,
                                                                            icon: Ext.MessageBox.INFO
                                                                        });
                                                                        fmVodomer.down('#newPokDVod').setValue(0);

                                                                        stTekPokVodomera.load({
                                                                            params: {
                                                                                what:'TekPokDVodomera',
                                                                                what_id: value.dvodomer_id,
                                                                                dvodomer_id: value.dvodomer_id,
                                                                                login:value.login,
                                                                                password:value.password
                                                                            },
                                                                            callback: function(records,operation,success){
                                                                                if(success){
                                                                                    fmVodomer.getForm().loadRecord(records[0]);
                                                                                }
                                                                            },
                                                                            scope:this
                                                                        });
                                                                        stWater.load({
                                                                            params: {
                                                                                what:'AllPokDVodomera',
                                                                                what_id: value.dvodomer_id,
                                                                                dvodomer_id: value.dvodomer_id,
                                                                                login:value.login,
                                                                                password:value.password
                                                                            },
                                                                            scope:this
                                                                        });

                                                                    }
                                                                });
                                                            }

                                                        },
                                                        anchor: '100%',
                                                        shadowOffset: 2,
                                                        disabled: true,
                                                        id: 'insTekPokDVodomera',
                                                        width: 115,
                                                        icon: 'resources/css/images/ico/yes22.png',
                                                        text: 'Записати показання'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'button',
                                                handler: function(button, e) {
                                                    // in use
                                                    var me = this;
                                                    //STORE

                                                    var stUser = Ext.data.StoreManager.get("StUser");
                                                    var stWater = Ext.data.StoreManager.get("StAllPokDVodomera");
                                                    var stTekPokVodomera = Ext.data.StoreManager.get("StTekPokDVodomera");


                                                    //LOGIN & PASSWORD

                                                    var values =stUser.getAt(0);
                                                    var params = {
                                                        login:values.get('login'),
                                                        password:values.get('password'),
                                                        house_id:values.get('house_id'),
                                                        what:"NachDVodomer"
                                                    };
                                                    //FORMA
                                                    var fmVodomer = Ext.getCmp('fmDVodomers');
                                                    var value = fmVodomer.getValues();
                                                    //LOGIKA


                                                    Ext.Object.merge(value, params);
                                                    var newValue = value.newValue;
                                                    var max =newValue - value.tek;
                                                    if (isNaN(newValue) || (max.length ===0)){
                                                        Ext.MessageBox.show({
                                                            title: 'Перевірка даних, що вводяться',
                                                            msg: 'Введіть число',
                                                            buttons: Ext.MessageBox.OK,
                                                            icon: Ext.MessageBox.ERROR
                                                        });
                                                        fmVodomer.down('#newPokDVod').focus();

                                                        return false;
                                                    }else if (max<=0){
                                                        Ext.MessageBox.show({
                                                            title: 'Перевірка даних, що вводяться',
                                                            msg: 'Введені свідчення менше або дорівнюють нулю <b>' + max + '</ b> <br> Введіть правильні показяння!.',
                                                            buttons: Ext.MessageBox.CANCEL,
                                                            icon: Ext.MessageBox.ERROR,
                                                            buttonText:{
                                                                cancel:'скасувати'
                                                            },
                                                            fn:function(btn,newValue){
                                                                if(btn=='cancel'){
                                                                    fmVodomer.down('#newPokAppVod').focus();
                                                                    return false;
                                                                }
                                                            }
                                                        });
                                                    } else if(max > 500) {
                                                        Ext.MessageBox.confirm({
                                                            title: 'Перевірка даних, що вводяться',
                                                            msg: 'Введені показання  дуже великі <b>'+ max +'</b> <br>Підтвердіть або скасуйте вводяться свідчення..',
                                                            buttons: Ext.MessageBox.OKCANCEL,
                                                            icon: Ext.MessageBox.ERROR,
                                                            buttonText:{
                                                                ok:'підтверджую',
                                                                cancel:'скасувати'
                                                            },
                                                            fn:function(btn,newValue){
                                                                if(btn=='cancel'){
                                                                    fmVodomer.down('#newPokDVod').focus();
                                                                    return false;
                                                                } else {
                                                                    QueryVodomer.newPokVodomera(value,function(data){
                                                                        if (data.success){
                                                                            Ext.MessageBox.confirm({
                                                                                title: 'Перевірка даних, що вводяться',
                                                                                msg: 'Нові показання введені',
                                                                                buttons: Ext.MessageBox.OK,
                                                                                icon: Ext.MessageBox.INFO
                                                                            });
                                                                            fmVodomer.down('#newPokDVod').setValue(0);

                                                                            stTekPokVodomera.load({
                                                                                params: {
                                                                                    what:'TekPokDVodomera',
                                                                                    what_id: value.dvodomer_id,
                                                                                    dvodomer_id: value.dvodomer_id,
                                                                                    login:value.login,
                                                                                    password:value.password
                                                                                },
                                                                                callback: function(records,operation,success){
                                                                                    if(success){
                                                                                        fmVodomer.getForm().loadRecord(records[0]);
                                                                                    }
                                                                                },
                                                                                scope:this
                                                                            });
                                                                            stWater.load({
                                                                                params: {
                                                                                    what:'AllPokDVodomera',
                                                                                    what_id: value.dvodomer_id,
                                                                                    dvodomer_id: value.dvodomer_id,
                                                                                    login:value.login,
                                                                                    password:value.password
                                                                                },
                                                                                scope:this
                                                                            });

                                                                        }
                                                                    });
                                                                }
                                                            }
                                                        });
                                                    } else {
                                                        QueryVodomer.newPokVodomera(value,function(data){
                                                            if (data.success){
                                                                Ext.MessageBox.confirm({
                                                                    title: 'Перевірка даних, що вводяться',
                                                                    msg: 'Нові показання введені',
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.INFO
                                                                });
                                                                fmVodomer.down('#newPokDVod').setValue(0);

                                                                stTekPokVodomera.load({
                                                                    params: {
                                                                        what:'TekPokDVodomera',
                                                                        what_id: value.dvodomer_id,
                                                                        dvodomer_id: value.dvodomer_id,
                                                                        login:value.login,
                                                                        password:value.password
                                                                    },
                                                                    callback: function(records,operation,success){
                                                                        if(success){
                                                                            fmVodomer.getForm().loadRecord(records[0]);
                                                                        }
                                                                    },
                                                                    scope:this
                                                                });
                                                                stWater.load({
                                                                    params: {
                                                                        what:'AllPokDVodomera',
                                                                        what_id: value.dvodomer_id,
                                                                        dvodomer_id: value.dvodomer_id,
                                                                        login:value.login,
                                                                        password:value.password
                                                                    },
                                                                    scope:this
                                                                });

                                                            }
                                                        });
                                                    }

                                                },
                                                x: 20,
                                                y: 95,
                                                shadowOffset: 2,
                                                disabled: true,
                                                id: 'NachDVodomera',
                                                width: 115,
                                                icon: 'resources/css/images/ico/yes22.png',
                                                text: 'Начислить'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'button',
                                        x: 185,
                                        y: 5,
                                        id: 'VodoPotreblenieiDvodomer',
                                        width: 190,
                                        icon: 'resources/css/images/ico/add.png',
                                        text: 'Звіт водоспоживання'
                                    },
                                    {
                                        xtype: 'datefield',
                                        x: 545,
                                        y: 210,
                                        disabled: true,
                                        width: 180,
                                        fieldLabel: 'Акт розпл',
                                        labelWidth: 65,
                                        name: 'date_ar',
                                        format: 'd-m-Y',
                                        submitFormat: 'Ymd',
                                        listeners: {
                                            select: {
                                                fn: 'onDatefieldSelect1111',
                                                scope: 'controller'
                                            }
                                        }
                                    },
                                    {
                                        xtype: 'datefield',
                                        x: 730,
                                        y: 210,
                                        disabled: true,
                                        width: 180,
                                        fieldLabel: 'Акт оплом',
                                        labelWidth: 70,
                                        name: 'date_ao',
                                        format: 'd-m-Y',
                                        submitFormat: 'Ymd',
                                        listeners: {
                                            select: {
                                                fn: 'onDatefieldSelect211',
                                                scope: 'controller'
                                            }
                                        }
                                    }
                                ]
                            },
                            {
                                xtype: 'gridpanel',
                                id: 'grAllPokDvodomera',
                                width: 1030,
                                title: 'Історія показань ',
                                emptyText: 'Нет показаний по прибору учета',
                                store: 'StAllPokDVodomera',
                                viewConfig: {
                                    getRowClass: function(record, rowIndex, rowParams, store) {
                                        return record.get('avg') === 0 ? "" : 'change_color';
                                    }
                                },
                                columns: [
                                    {
                                        xtype: 'numbercolumn',
                                        hidden: true,
                                        dataIndex: 'address_id',
                                        text: 'Address_id'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        hidden: true,
                                        dataIndex: 'period',
                                        text: 'Address'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        hidden: true,
                                        dataIndex: 'nomer',
                                        text: 'Nomer'
                                    },
                                    {
                                        xtype: 'datecolumn',
                                        hidden: true,
                                        dataIndex: 'data',
                                        text: 'Data',
                                        format: 'd-m-y'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 76,
                                        dataIndex: 'pok_id',
                                        menuDisabled: true,
                                        text: 'Ид пок',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        menuDisabled: true,
                                        text: 'Период',
                                        columns: [
                                            {
                                                xtype: 'datecolumn',
                                                width: 90,
                                                dataIndex: 'date_ot',
                                                menuDisabled: true,
                                                text: 'Поперед',
                                                format: 'd-m-Y'
                                            },
                                            {
                                                xtype: 'datecolumn',
                                                width: 90,
                                                dataIndex: 'date_do',
                                                menuDisabled: true,
                                                text: 'Поточне',
                                                format: 'd-m-Y'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 53,
                                                dataIndex: 'days',
                                                menuDisabled: true,
                                                text: 'дней',
                                                format: '0'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        menuDisabled: true,
                                        text: 'Показання по приладу обліку',
                                        columns: [
                                            {
                                                xtype: 'numbercolumn',
                                                width: 80,
                                                dataIndex: 'pred',
                                                menuDisabled: true,
                                                text: 'Поперед',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 80,
                                                dataIndex: 'tek',
                                                menuDisabled: true,
                                                text: 'Поточне',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 65,
                                                dataIndex: 'kub',
                                                menuDisabled: true,
                                                text: 'Кубов',
                                                format: '0'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        menuDisabled: true,
                                        text: 'За середнім',
                                        columns: [
                                            {
                                                xtype: 'numbercolumn',
                                                width: 80,
                                                dataIndex: 'pok_ot',
                                                menuDisabled: true,
                                                text: 'Поперед',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 80,
                                                dataIndex: 'pok_do',
                                                menuDisabled: true,
                                                text: 'Поточне',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 70,
                                                dataIndex: 'qty_kub',
                                                menuDisabled: true,
                                                text: 'Куб раз',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 65,
                                                dataIndex: 'rday',
                                                menuDisabled: true,
                                                text: 'Дней',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 88,
                                                dataIndex: 'kub_day',
                                                menuDisabled: true,
                                                text: 'Куб/день',
                                                format: '0.0000'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        width: 99,
                                        dataIndex: 'operator',
                                        menuDisabled: true,
                                        text: 'оператор'
                                    }
                                ],
                                tools: [
                                    {
                                        xtype: 'tool',
                                        callback: function(owner, tool, event) {
                                            //in use
                                            var grid = tool.findParentByType('grid');
                                            var fmVodomer = Ext.getCmp('fmDVodomers');
                                            var dvodomer_id = fmVodomer.getForm().findField('dvodomer_id').getValue();
                                            //STORE
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var StAllPokDVodomera = Ext.data.StoreManager.get("StAllPokDVodomera");
                                            //LOGIN & PASSWORD
                                            var values =stUser.getAt(0);

                                            //LOGIKA
                                            if(!Ext.isEmpty(dvodomer_id)){
                                                // console.log(dvodomer_id);

                                                StAllPokDVodomera.removeAll();
                                                StAllPokDVodomera.load({
                                                    params: {
                                                        login:values.get('login'),
                                                        password:values.get('password'),
                                                        address_id:values.get('address_id'),
                                                        what:'AllPokDVodomeraAll',
                                                        what_id: values.get('address_id'),
                                                        dvodomer_id: dvodomer_id
                                                    },
                                                    callback: function(records,operation,success){
                                                        if(success){
                                                            //console.log(grid);
                                                            grid.getView().refresh();
                                                        }
                                                    },
                                                    scope:this
                                                });
                                            }else{
                                                Ext.MessageBox.show({
                                                    title: 'Просмотр истории показаний cчетчика воды',
                                                    msg: "Выберите счетчик воды",
                                                    buttons: Ext.MessageBox.OK,
                                                    icon: Ext.MessageBox.INFO
                                                });
                                            }
                                        },
                                        tooltip: 'Завантажити все показання приладу обліку',
                                        tooltipType: 'title',
                                        type: 'search'
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        xtype: 'gridpanel',
                        id: 'grOrgByDVodomer',
                        title: 'Об\'єкти',
                        store: 'StOrgByDvodomer',
                        columns: [
                            {
                                xtype: 'actioncolumn',
                                maxWidth: 25,
                                minWidth: 25,
                                width: 112,
                                menuDisabled: true,
                                items: [
                                    {
                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                            // in use

                                            var stUser = Ext.data.StoreManager.get("StUser");

                                            //LOGIN & PASSWORD
                                            var values =stUser.getAt(0);
                                            var dvodomer_id = values.get('dvodomer_id');


                                            var dt = r.get('dvodomer_id');
                                            if (dt === dvodomer_id ) {
                                                metaData = 'x-hide-display';
                                            } else if (dt != dvodomer_id ) {
                                                metaData = 'x-grid-center-icon';
                                            } else {
                                                metaData = 'x-grid-center-icon';
                                            }
                                            return metaData;
                                        },
                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                            // in use
                                            var me = this;
                                            //STORE
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            //var StOrgByDvodomer = Ext.data.StoreManager.get("StOrgByDvodomer");//QueryTeplomer.getResults
                                            var stFilial = Ext.data.StoreManager.get("StFilial");//QueryOrg.getResults  <FmFilial>


                                            //LOGIN & PASSWORD

                                            var values =stUser.getAt(0);
                                            var params = {
                                                login:values.get('login'),
                                                password:values.get('password'),
                                                house_id:values.get('house_id'),
                                                dvodomer_id:values.get('dvodomer_id'),
                                                what:'addFilialDvodomer'
                                            };
                                            //GRID
                                            var store = view.getStore();
                                            var value = store.getAt(rowIndex).data;

                                            //LOGIKA

                                            Ext.Object.merge(value, params);
                                            //console.log(value);
                                            QueryVodomer.addVodomer(value,function(results){
                                                if (results.success){
                                                    Ext.MessageBox.show({
                                                        title: 'Добавление организация  к домовому водомеру !!!',
                                                        msg: results.msg,
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.INFO
                                                    });
                                                    store.load({
                                                        params: {
                                                            what:"OrgByDvodomer",
                                                            house_id: value.house_id,
                                                            login:value.login,
                                                            password:value.password,
                                                            filial_id:value.filial_id,
                                                            dvodomer_id:value.dvodomer_id
                                                        },
                                                        scope:this
                                                    });
                                                    view.refresh();
                                                }
                                            });

                                        },
                                        icon: 'resources/css/images/ico/add.png',
                                        tooltip: 'добавить обьект к вводу (Дводомеру)'
                                    },
                                    {
                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                            // in use

                                            var stUser = Ext.data.StoreManager.get("StUser");

                                            //LOGIN & PASSWORD
                                            var values =stUser.getAt(0);
                                            var dvodomer_id = values.get('dvodomer_id');


                                            var dt = r.get('dvodomer_id');
                                            if (dt != dvodomer_id ) {
                                                metaData = 'x-hide-display';
                                            } else if (dt === dvodomer_id ) {
                                                metaData = 'x-grid-center-icon';
                                            } else {
                                                metaData = 'x-grid-center-icon';
                                            }
                                            return metaData;
                                        },
                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                            // in use
                                            var me = this;
                                            //STORE
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var StOrgByDvodomer = Ext.data.StoreManager.get("StOrgByDvodomer");//QueryTeplomer.getResults
                                            var stFilial = Ext.data.StoreManager.get("StFilial");//QueryOrg.getResults  <FmFilial>


                                            //LOGIN & PASSWORD

                                            var values =stUser.getAt(0);
                                            var params = {
                                                login:values.get('login'),
                                                password:values.get('password'),
                                                house_id:values.get('house_id'),
                                                dvodomer_id:values.get('dvodomer_id'),
                                                what:'delFilialDvodomer'
                                            };
                                            //GRID
                                            var store = view.getStore();
                                            var value = store.getAt(rowIndex).data;

                                            //LOGIKA

                                            Ext.Object.merge(value, params);
                                            //console.log(value);
                                            QueryVodomer.addVodomer(value,function(results){
                                                if (results.success){
                                                    Ext.MessageBox.show({
                                                        title: 'Удаление организация  с домового водомера !!!',
                                                        msg: results.msg,
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.INFO
                                                    });
                                                    store.load({
                                                        params: {
                                                            what:"OrgByDvodomer",
                                                            house_id: value.house_id,
                                                            login:value.login,
                                                            password:value.password,
                                                            filial_id:value.filial_id,
                                                            dvodomer_id:value.dvodomer_id
                                                        },
                                                        scope:this
                                                    });
                                                    view.refresh();
                                                }
                                            });

                                        },
                                        icon: 'resources/css/images/ico/delete.png',
                                        tooltip: 'удалить обьект из  ввода (Дводомера)'
                                    }
                                ]
                            },
                            {
                                xtype: 'gridcolumn',
                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                    return Ext.String.format('<div  <b>{0}</b><br><span >{1} </span></div>',
                                    value,
                                    record.get('name') || "");
                                },
                                width: 414,
                                dataIndex: 'fname',
                                text: 'Найменування об\'єкта'
                            },
                            {
                                xtype: 'numbercolumn',
                                width: 40,
                                dataIndex: 'dvodomer_id',
                                menuDisabled: true,
                                text: 'Дв',
                                tooltip: 'Ид домового тепломера',
                                format: '0'
                            },
                            {
                                xtype: 'numbercolumn',
                                width: 50,
                                dataIndex: 'people',
                                menuDisabled: true,
                                text: 'чел',
                                format: '0'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                width: 32,
                                dataIndex: 'nrx_xv_d',
                                text: 'Выс',
                                format: '0.00'
                            },
                            {
                                xtype: 'numbercolumn',
                                width: 75,
                                dataIndex: 'nrx_xv_d',
                                menuDisabled: true,
                                text: 'НрХв<br>в день',
                                format: '0.000'
                            },
                            {
                                xtype: 'numbercolumn',
                                width: 79,
                                dataIndex: 'norma_xv',
                                menuDisabled: true,
                                text: 'Норма',
                                format: '0.000'
                            },
                            {
                                xtype: 'gridcolumn',
                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                    switch (value) {
                                        case true:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/yes.png"/></span>';
                                        break;
                                        case false:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/no.png"/></span>';
                                        break;
                                    }
                                    return metaData;

                                },
                                width: 48,
                                dataIndex: 'vkl_xvoda',
                                menuDisabled: true,
                                text: 'Хв'
                            },
                            {
                                xtype: 'gridcolumn',
                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                    switch (value) {
                                        case true:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/yes.png"/></span>';
                                        break;
                                        case false:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/no.png"/></span>';
                                        break;
                                    }
                                    return metaData;

                                },
                                width: 43,
                                dataIndex: 'vkl_stoki',
                                menuDisabled: true,
                                text: 'Ст'
                            },
                            {
                                xtype: 'gridcolumn',
                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                    switch (value) {
                                        case true:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/yes.png"/></span>';
                                        break;
                                        case false:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/no.png"/></span>';
                                        break;
                                    }
                                    return metaData;

                                },
                                hidden: true,
                                width: 28,
                                dataIndex: 'vkl_xvoda',
                                text: 'ХВ'
                            },
                            {
                                xtype: 'gridcolumn',
                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                    switch (value) {
                                        case true:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/yes.png"/></span>';
                                        break;
                                        case false:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/no.png"/></span>';
                                        break;
                                    }
                                    return metaData;

                                },
                                hidden: true,
                                width: 26,
                                dataIndex: 'vkl_stoki',
                                text: 'Ст'
                            },
                            {
                                xtype: 'gridcolumn',
                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                    switch (value) {
                                        case true:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/yes.png"/></span>';
                                        break;
                                        case false:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/no.png"/></span>';
                                        break;
                                    }
                                    return metaData;

                                },
                                width: 65,
                                align: 'center',
                                dataIndex: 'xvodomer',
                                menuDisabled: true,
                                text: 'СчХв'
                            },
                            {
                                xtype: 'gridcolumn',
                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                    switch (value) {
                                        case true:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/yes.png"/></span>';
                                        break;
                                        case false:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/no.png"/></span>';
                                        break;
                                    }
                                    return metaData;

                                },
                                width: 65,
                                dataIndex: 'gvodomer',
                                menuDisabled: true,
                                text: 'СчГв'
                            },
                            {
                                xtype: 'gridcolumn',
                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                    switch (value) {
                                        case true:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/yes.png"/></span>';
                                        break;
                                        case false:
                                        metaData='<span><img clas="icon" src="resources/css/images/ico/no.png"/></span>';
                                        break;
                                    }
                                    return metaData;

                                },
                                hidden: true,
                                width: 45,
                                dataIndex: 'xvodomer',
                                text: 'Сч.ХВ'
                            }
                        ],
                        tools: [
                            {
                                xtype: 'tool',
                                type: 'search',
                                listeners: {
                                    click: 'onToolClick1'
                                }
                            }
                        ]
                    },
                    {
                        xtype: 'gridpanel',
                        id: 'grAOVodomer',
                        collapsible: true,
                        title: 'У повіркі або в ремонті',
                        emptyText: 'Приборов учета нет в истории',
                        store: 'StAOVodomer',
                        columns: [
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'raion',
                                text: 'House_id'
                            },
                            {
                                xtype: 'gridcolumn',
                                hidden: true,
                                dataIndex: 'period',
                                text: 'Address'
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'Характеристика приладу обліку',
                                columns: [
                                    {
                                        xtype: 'numbercolumn',
                                        width: 55,
                                        dataIndex: 'vodomer_id',
                                        menuDisabled: true,
                                        text: 'Ид',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                            metaData.style = 'color:#D10000;font-weight:bold;';
                                            var retValue = '';
                                            switch (value) {
                                                case 'Хвода':
                                                retValue ='<span><img clas="icon" src="resources/css/images/ico/pipex.png"/></span>';
                                                break;
                                                case 'Гвода':
                                                retValue ='<span><img clas="icon" src="resources/css/images/ico/pipeg.png"/></span>';
                                            }
                                            return retValue;
                                        },
                                        width: 55,
                                        align: 'center',
                                        dataIndex: 'voda',
                                        menuDisabled: true,
                                        text: 'тип'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        width: 283,
                                        dataIndex: 'address',
                                        menuDisabled: true,
                                        text: 'Адреса , Об\'єкти'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        width: 120,
                                        dataIndex: 'model',
                                        menuDisabled: true,
                                        text: 'модель'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 110,
                                        dataIndex: 'nomer',
                                        menuDisabled: true,
                                        text: 'номер',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 95,
                                        dataIndex: 'joint',
                                        menuDisabled: true,
                                        text: 'Загальний',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 79,
                                        dataIndex: 'obr',
                                        menuDisabled: true,
                                        text: 'Обратка',
                                        format: '0'
                                    }
                                ]
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'Повірка або ремонт',
                                columns: [
                                    {
                                        xtype: 'datecolumn',
                                        width: 138,
                                        align: 'center',
                                        dataIndex: 'date_ar',
                                        menuDisabled: true,
                                        text: 'розпломбування',
                                        format: 'd-m-Y'
                                    },
                                    {
                                        xtype: 'datecolumn',
                                        width: 124,
                                        align: 'center',
                                        dataIndex: 'date_ao',
                                        menuDisabled: true,
                                        text: 'опломбування',
                                        format: 'd-m-Y'
                                    }
                                ]
                            }
                        ],
                        dockedItems: [
                            {
                                xtype: 'toolbar',
                                dock: 'top',
                                items: [
                                    {
                                        xtype: 'tbseparator',
                                        height: 15,
                                        width: 34
                                    },
                                    {
                                        xtype: 'button',
                                        handler: function(button, event) {
                                            //COMBO
                                            var grid = button.findParentByType('grid');
                                            var store = grid.store;


                                            //STORE
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var values =stUser.getAt(0);

                                            //LOGIKA
                                            var params = {
                                                login:values.get('login'),
                                                password:values.get('password'),
                                                dvodomer_id:values.get('dvodomer_id'),
                                                what:'AddAOPokVod'
                                            };


                                            //LOGIKA
                                            var myMask= Ext.Msg.show({
                                                title:'Нарахувати за середнім',
                                                msg: 'Нарахувати за середнім.Ожидайте...',
                                                buttons: Ext.Msg.CANCEL,
                                                wait: true,
                                                modal: true,
                                                icon: Ext.Msg.INFO
                                            });

                                            QueryVodomer.updateVodomer(params,function(results){
                                                if(results.success==="1"){

                                                    store.load({
                                                        params: {
                                                            what:'OnPoverkaVodomer',
                                                            login:values.get('login'),
                                                            password:values.get('password'),
                                                            dvodomer_id:values.get('dvodomer_id'),
                                                        }
                                                    });
                                                    myMask.close();
                                                    Ext.MessageBox.show({
                                                        title: 'Нарахувати за середнім',
                                                        msg: results.msg,
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.INFO
                                                    });
                                                } else {
                                                    myMask.close();
                                                    Ext.MessageBox.show({
                                                        title: 'Нарахувати за середнім',
                                                        msg: results.msg,
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.ERROR
                                                    });

                                                }

                                            });
                                        },
                                        disabled: true,
                                        id: 'btnAddAOPokVod',
                                        width: 186,
                                        icon: 'resources/css/images/ico/add.png',
                                        text: 'Нарахувати за середнім',
                                        tooltip: ''
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        xtype: 'gridpanel',
                        id: 'grAvgVodomer',
                        collapsible: true,
                        title: 'Немає показань',
                        emptyText: 'Приборов учета нет в истории',
                        store: 'StVodomerAvg',
                        viewConfig: {
                            getRowClass: function(record, rowIndex, rowParams, store) {

                                if(record.get('avg') === 1  ){
                                    return 'change_color_yellow';
                                }
                                else if(record.get('avg') === 2 ){
                                    return  'change_color_yellow';
                                }
                                else if(record.get('avg') === 3 ){
                                    return  'change_color_yellow';
                                }
                                else  if(record.get('avg') === 4 ){
                                    return  'change_color_red';
                                }

                            }
                        },
                        columns: [
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'raion',
                                text: 'House_id'
                            },
                            {
                                xtype: 'gridcolumn',
                                hidden: true,
                                dataIndex: 'period',
                                text: 'Address'
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'Характеристика приладу обліку',
                                columns: [
                                    {
                                        xtype: 'numbercolumn',
                                        width: 55,
                                        dataIndex: 'vodomer_id',
                                        menuDisabled: true,
                                        text: 'Вод_Ид',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                            metaData.style = 'color:#D10000;font-weight:bold;';
                                            var retValue = '';
                                            switch (value) {
                                                case 'Хвода':
                                                retValue ='<span><img clas="icon" src="resources/css/images/ico/pipex.png"/></span>';
                                                break;
                                                case 'Гвода':
                                                retValue ='<span><img clas="icon" src="resources/css/images/ico/pipeg.png"/></span>';
                                            }
                                            return retValue;
                                        },
                                        width: 55,
                                        align: 'center',
                                        dataIndex: 'voda',
                                        menuDisabled: true,
                                        text: 'тип'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        width: 207,
                                        dataIndex: 'address',
                                        menuDisabled: true,
                                        text: 'Адреса , Об\'єкти'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        width: 105,
                                        dataIndex: 'model',
                                        menuDisabled: true,
                                        text: 'модель'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 101,
                                        dataIndex: 'nomer',
                                        menuDisabled: true,
                                        text: 'номер',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 41,
                                        dataIndex: 'people',
                                        menuDisabled: true,
                                        text: 'Чел',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 50,
                                        dataIndex: 'joint',
                                        menuDisabled: true,
                                        text: 'Загал',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 60,
                                        dataIndex: 'obr',
                                        menuDisabled: true,
                                        text: 'Обратка',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'datecolumn',
                                        width: 80,
                                        align: 'center',
                                        dataIndex: 'sdate',
                                        menuDisabled: true,
                                        text: 'дата ввода',
                                        format: 'd-m-Y'
                                    }
                                ]
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'Останнє показання',
                                columns: [
                                    {
                                        xtype: 'datecolumn',
                                        width: 80,
                                        align: 'center',
                                        dataIndex: 'data',
                                        menuDisabled: true,
                                        text: 'Дата',
                                        format: 'd-m-Y'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 60,
                                        align: 'center',
                                        dataIndex: 'avg',
                                        menuDisabled: true,
                                        text: 'по ср',
                                        format: '0'
                                    }
                                ]
                            }
                        ],
                        dockedItems: [
                            {
                                xtype: 'toolbar',
                                dock: 'top',
                                items: [
                                    {
                                        xtype: 'datefield',
                                        id: 'dataNachAvgVodomer',
                                        width: 193,
                                        fieldLabel: 'Период',
                                        labelWidth: 55,
                                        format: 'F,Y',
                                        startDay: 1,
                                        submitFormat: 'Ymd',
                                        listeners: {
                                            change: {
                                                fn: 'onDataNachAvgVodomerChange',
                                                scope: 'controller'
                                            },
                                            select: {
                                                fn: 'onDataNachAvgVodomerSelect',
                                                scope: 'controller'
                                            }
                                        }
                                    },
                                    {
                                        xtype: 'button',
                                        handler: function(button, event) {

                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var values =stUser.getAt(0);
                                            var login = values.get('login');
                                            var password = values.get('password');
                                            var dvodomer_id = values.get('dvodomer_id');
                                            var data =  Ext.getCmp('dataNachAvgVodomer').getValue();

                                            var StVodomerAvg = Ext.data.StoreManager.get("StVodomerAvg");

                                            var btnAddAvgPokVod =  Ext.getCmp('btnAddAvgPokVod');

                                            if (dvodomer_id !== 0) {
                                                btnAddAvgPokVod.setDisabled(false);

                                                StVodomerAvg.load({
                                                    params: {
                                                        login:login,
                                                        password:password,
                                                        what:'VodomerAvg',
                                                        data:data,
                                                        dvodomer_id: dvodomer_id
                                                    },
                                                    scope:this
                                                });

                                            }else {

                                                Ext.MessageBox.show({
                                                    title: 'Начисление кубов по среднему',
                                                    msg: 'Не выбран домовой водомер',
                                                    buttons: Ext.MessageBox.OK,
                                                    icon: Ext.MessageBox.ERROR
                                                });
                                            }
                                        },
                                        disabled: true,
                                        id: 'btnRefreshAvgPokVod',
                                        icon: 'resources/css/images/ico/xsldbg_refresh.png',
                                        text: '',
                                        tooltip: 'Оновить  дані',
                                        tooltipType: 'title'
                                    },
                                    {
                                        xtype: 'tbseparator',
                                        height: 15,
                                        width: 34
                                    },
                                    {
                                        xtype: 'button',
                                        handler: function(button, event) {
                                            //COMBO
                                            var grid = button.findParentByType('grid');
                                            var store = grid.store;
                                            var data =  Ext.getCmp('dataNachAvgVodomer').getValue();


                                            //STORE
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var values =stUser.getAt(0);

                                            //LOGIKA
                                            var params = {
                                                login:values.get('login'),
                                                password:values.get('password'),
                                                data:data,
                                                dvodomer_id:values.get('dvodomer_id'),
                                                what:'AddAvgPokVod'
                                            };


                                            //LOGIKA
                                            var myMask= Ext.Msg.show({
                                                title:'Нарахувати за середнім',
                                                msg: 'Нарахувати за середнім.Ожидайте...',
                                                buttons: Ext.Msg.CANCEL,
                                                wait: true,
                                                modal: true,
                                                icon: Ext.Msg.INFO
                                            });

                                            QueryVodomer.updateVodomer(params,function(results){
                                                if(results.success==="1"){

                                                    store.load({
                                                        params: {
                                                            what:'VodomerAvg',
                                                            login:values.get('login'),
                                                            password:values.get('password'),
                                                            data:data,
                                                            dvodomer_id:values.get('dvodomer_id'),
                                                        }
                                                    });
                                                    myMask.close();
                                                    Ext.MessageBox.show({
                                                        title: 'Нарахувати за середнім',
                                                        msg: results.msg,
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.INFO
                                                    });
                                                } else {
                                                    myMask.close();
                                                    Ext.MessageBox.show({
                                                        title: 'Нарахувати за середнім',
                                                        msg: results.msg,
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.ERROR
                                                    });

                                                }

                                            });
                                        },
                                        disabled: true,
                                        id: 'btnAddAvgPokVod',
                                        width: 186,
                                        icon: 'resources/css/images/ico/add.png',
                                        text: 'Нарахувати за середнім',
                                        tooltip: ''
                                    },
                                    {
                                        xtype: 'button',
                                        handler: function(button, event) {
                                            //COMBO
                                            var grid = button.findParentByType('grid');
                                            var store = grid.store;
                                            var data =  Ext.getCmp('dataNachAvgVodomer').getValue();


                                            //STORE
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var values =stUser.getAt(0);

                                            //LOGIKA
                                            var params = {
                                                login:values.get('login'),
                                                password:values.get('password'),
                                                data:data,
                                                dvodomer_id:values.get('dvodomer_id'),
                                                what:'DelAvgPokVod'
                                            };


                                            //LOGIKA
                                            var myMask= Ext.Msg.show({
                                                title:'Вивести з нарахувань',
                                                msg: 'Вивести з нарахувань.Ожидайте...',
                                                buttons: Ext.Msg.CANCEL,
                                                wait: true,
                                                modal: true,
                                                icon: Ext.Msg.INFO
                                            });

                                            QueryVodomer.updateVodomer(params,function(results){
                                                if(results.success==="1"){

                                                    store.load({
                                                        params: {
                                                            what:'VodomerAvg',
                                                            login:values.get('login'),
                                                            password:values.get('password'),
                                                            data:data,
                                                            dvodomer_id:values.get('dvodomer_id'),
                                                        }
                                                    });
                                                    myMask.close();
                                                    Ext.MessageBox.show({
                                                        title: 'Вивести з нарахувань',
                                                        msg: results.msg,
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.INFO
                                                    });
                                                } else {
                                                    myMask.close();
                                                    Ext.MessageBox.show({
                                                        title: 'Вивести з нарахувань',
                                                        msg: results.msg,
                                                        buttons: Ext.MessageBox.OK,
                                                        icon: Ext.MessageBox.ERROR
                                                    });

                                                }

                                            });
                                        },
                                        disabled: true,
                                        id: 'btnDelAvgPokVod',
                                        width: 186,
                                        icon: 'resources/css/images/ico/delete.png',
                                        text: 'Вивести з нарахувань',
                                        tooltip: ''
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        xtype: 'gridpanel',
                        id: 'grAktPVoda',
                        collapsed: true,
                        collapsible: true,
                        title: 'Акт претензії',
                        store: 'StAktClaim',
                        columns: [
                            {
                                xtype: 'actioncolumn',
                                width: 36,
                                menuDisabled: true,
                                tooltip: 'Редактировать',
                                items: [
                                    {
                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                            var winAddAktClaim = Ext.ClassManager.instantiateByAlias('widget.winaddaktclaim');
                                            var form = winAddAktClaim.down('#fnAddAktClaim');
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var values =stUser.getAt(0);
                                            var value = record;

                                            values.set({'vibor':'editAktClaim'});
                                            stUser.sync();
                                            form.loadRecord(value);
                                            form.down('#btnInsertAktClaim').setText('Обновить акт');
                                            winAddAktClaim.show();
                                        },
                                        icon: 'resources/css/images/ico/edit.png',
                                        tooltip: 'Редактировать'
                                    }
                                ]
                            },
                            {
                                xtype: 'gridcolumn',
                                width: 122,
                                dataIndex: 'nomer',
                                menuDisabled: true,
                                text: 'Акт №'
                            },
                            {
                                xtype: 'datecolumn',
                                width: 137,
                                dataIndex: 'data',
                                menuDisabled: true,
                                text: 'Период',
                                format: 'F,Y'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'dteplomer_id',
                                format: '00'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'pok_id',
                                format: '00'
                            },
                            {
                                xtype: 'gridcolumn',
                                width: 89,
                                dataIndex: 'address_id',
                                menuDisabled: true,
                                text: 'адреса ид'
                            },
                            {
                                xtype: 'gridcolumn',
                                width: 226,
                                dataIndex: 'address',
                                menuDisabled: true,
                                text: 'адреса'
                            },
                            {
                                xtype: 'numbercolumn',
                                dataIndex: 'square',
                                menuDisabled: true,
                                text: 'S(м&sup2;) '
                            },
                            {
                                xtype: 'numbercolumn',
                                dataIndex: 'temp',
                                menuDisabled: true,
                                text: 't&#176;С',
                                format: '0'
                            },
                            {
                                xtype: 'numbercolumn',
                                dataIndex: 'gkal',
                                menuDisabled: true,
                                text: 'Гкал',
                                format: '0,000.000'
                            },
                            {
                                xtype: 'actioncolumn',
                                editRenderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                    var val="";
                                    return val;
                                },
                                width: 30,
                                menuDisabled: true,
                                altText: 'Удалить запись',
                                icon: 'css/images/ico/no.png',
                                items: [
                                    {
                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                            var grid = view.findParentByType('grid');
                                            var store = view.getStore();
                                            Ext.MessageBox.show({
                                                title: 'Внимание!',
                                                msg: 'Вы удаляете запись ! Подтвердите или отмените свои действия!',
                                                buttons: Ext.MessageBox.OKCANCEL,
                                                icon: Ext.MessageBox.WARNING,

                                                buttonText:{
                                                    ok: "Удалить!",
                                                    cancel: "Отмена"
                                                },
                                                fn:function(btn){
                                                    if(btn=='ok'){
                                                        // view.getStore().removeAt(rowIndex);
                                                        store.remove(record);

                                                        store.sync({
                                                            success: function(){
                                                                Ext.MessageBox.show({title: 'Удаление записи',
                                                                    msg:'Запись удалена',
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.INFO
                                                                });
                                                            },
                                                            failure: function(){
                                                                Ext.MessageBox.show({title: 'Удаление записи',
                                                                    msg:'Запись не удалена',
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.ERROR
                                                                });

                                                            },
                                                            scope: this
                                                        });
                                                    }
                                                }

                                            });
                                        },
                                        icon: 'resources/css/images/ico/no.png'
                                    }
                                ]
                            }
                        ],
                        tools: [
                            {
                                xtype: 'tool',
                                tooltip: 'Додати акт претензії',
                                tooltipType: 'title',
                                type: 'save',
                                listeners: {
                                    click: 'onToolClick11'
                                }
                            }
                        ]
                    },
                    {
                        xtype: 'gridpanel',
                        id: 'grHDVodomer',
                        collapsible: true,
                        title: 'Зняті з обліку',
                        emptyText: 'Приборов учета нет в истории',
                        store: 'StHDVodomer',
                        columns: [
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'raion',
                                text: 'House_id'
                            },
                            {
                                xtype: 'gridcolumn',
                                hidden: true,
                                dataIndex: 'period',
                                text: 'Address'
                            },
                            {
                                xtype: 'actioncolumn',
                                width: 40,
                                menuDisabled: true,
                                items: [
                                    {
                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                            metaData = 'x-grid-center-icon';
                                            return metaData;
                                        },
                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var stDVodomer = Ext.data.StoreManager.get("StDVodomer");
                                            var values =stUser.getAt(0);
                                            var params = {
                                                login:values.get('login'),
                                                password:values.get('password'),
                                                address_id:values.get('address_id'),
                                                house_id:values.get('house_id'),
                                                what:'DVodomerBack'
                                            };
                                            var stHDVodomer = view.getStore();
                                            var value = stHDVodomer.getAt(rowIndex).data;
                                            Ext.Object.merge(value, params);
                                            Ext.MessageBox.confirm({
                                                title: 'Повернення приладу обліку з історії',
                                                msg: 'Ви повертаєте прилад обліку з історії <br> Підтвердіть або скасуйте свої дії.',
                                                buttons: Ext.MessageBox.OKCANCEL,
                                                icon: Ext.MessageBox.INFO,
                                                buttonText:{
                                                    ok:'підтверджую',
                                                    cancel:'скасувати'
                                                },
                                                fn:function(btn,newValue){
                                                    if(btn=='ok'){
                                                        QueryVodomer.spisanVodomer(value,function(results){
                                                            if (results.success==="1"){

                                                                stHDVodomer.load({
                                                                    params: {
                                                                        what:'HDvodomer',
                                                                        house_id:values.get('house_id'),
                                                                        login:value.login,
                                                                        password:value.password
                                                                    },
                                                                    scope:this
                                                                });
                                                                stDVodomer.load({
                                                                    params: {
                                                                        what:'Dvodomer',
                                                                        house_id:values.get('house_id'),
                                                                        vodomer_id: value.vodomer_id,
                                                                        login:value.login,
                                                                        password:value.password
                                                                    },
                                                                    scope:this
                                                                });
                                                                Ext.MessageBox.show({
                                                                    title: 'Повернення приладу обліку з історії',
                                                                    msg: results.msg,
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.INFO
                                                                });

                                                            } else {
                                                                Ext.MessageBox.show({
                                                                    title: 'Повернення приладу обліку з історії',
                                                                    msg: results.msg,
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.ERROR
                                                                });
                                                            }
                                                        });
                                                    }
                                                }
                                            });
                                        },
                                        icon: 'resources/css/images/ico/door_out.png',
                                        tooltip: 'Вернуть водомер из истории'
                                    }
                                ]
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'Характеристика приладу обліку',
                                columns: [
                                    {
                                        xtype: 'numbercolumn',
                                        width: 55,
                                        dataIndex: 'dvodomer_id',
                                        menuDisabled: true,
                                        text: 'Ид',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                            metaData.style = 'color:#D10000;font-weight:bold;';
                                            var retValue = '';
                                            switch (value) {
                                                case 'Хвода':
                                                retValue ='<span><img clas="icon" src="resources/css/images/ico/pipex.png"/></span>';
                                                break;
                                                case 'Гвода':
                                                retValue ='<span><img clas="icon" src="resources/css/images/ico/pipeg.png"/></span>';
                                            }
                                            return retValue;
                                        },
                                        width: 55,
                                        align: 'center',
                                        dataIndex: 'voda',
                                        menuDisabled: true,
                                        text: 'тип'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        width: 120,
                                        dataIndex: 'model',
                                        menuDisabled: true,
                                        text: 'модель'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 110,
                                        dataIndex: 'nomer',
                                        menuDisabled: true,
                                        text: 'номер',
                                        format: '0'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        width: 68,
                                        dataIndex: 'vvod',
                                        menuDisabled: true,
                                        text: 'ввод'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        width: 90,
                                        dataIndex: 'appartment',
                                        menuDisabled: true,
                                        text: 'кварт'
                                    }
                                ]
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'Дата',
                                columns: [
                                    {
                                        xtype: 'datecolumn',
                                        width: 90,
                                        align: 'center',
                                        dataIndex: 'zdate',
                                        menuDisabled: true,
                                        text: 'Випуску',
                                        format: 'd-m-Y'
                                    },
                                    {
                                        xtype: 'datecolumn',
                                        width: 90,
                                        align: 'center',
                                        dataIndex: 'sdate',
                                        menuDisabled: true,
                                        text: 'Введен',
                                        format: 'd-m-Y'
                                    },
                                    {
                                        xtype: 'datecolumn',
                                        width: 90,
                                        align: 'center',
                                        dataIndex: 'data_spis',
                                        menuDisabled: true,
                                        text: 'Списан',
                                        format: 'd-m-Y'
                                    }
                                ]
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'Поверка',
                                columns: [
                                    {
                                        xtype: 'datecolumn',
                                        width: 90,
                                        align: 'center',
                                        dataIndex: 'pdate',
                                        menuDisabled: true,
                                        text: 'Остання',
                                        format: 'd-m-Y'
                                    },
                                    {
                                        xtype: 'datecolumn',
                                        width: 90,
                                        align: 'center',
                                        dataIndex: 'fpdate',
                                        menuDisabled: true,
                                        text: 'Наступна',
                                        format: 'd-m-Y'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        width: 90,
                                        align: 'center',
                                        dataIndex: 'plomba',
                                        menuDisabled: true,
                                        text: 'Пломба'
                                    }
                                ]
                            },
                            {
                                xtype: 'actioncolumn',
                                width: 40,
                                menuDisabled: true,
                                items: [
                                    {
                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                            metaData = 'x-grid-center-icon';
                                            return metaData;
                                        },
                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                            // in use
                                            var me = this;
                                            //STORE

                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            //LOGIN & PASSWORD

                                            var values =stUser.getAt(0);
                                            var params = {
                                                login:values.get('login'),
                                                password:values.get('password'),
                                                house_id:values.get('house_id'),
                                                what:'DVodomer'
                                            };
                                            //GRID
                                            var stHVodomer = view.getStore();
                                            var value = stHVodomer.getAt(rowIndex).data;

                                            //LOGIKA

                                            Ext.Object.merge(value, params);
                                            //console.log(value);

                                            Ext.MessageBox.confirm({
                                                title: 'Видалення приладу обліку безповоротно',
                                                msg: 'Ви безповоротно видаляєте прилад обліку<br>Підтвердіть або скасуйте свої дії.',
                                                buttons: Ext.MessageBox.OKCANCEL,
                                                icon: Ext.MessageBox.ERROR,
                                                buttonText:{
                                                    ok:'підтверджую',
                                                    cancel:'скасувати'
                                                },
                                                fn:function(btn,newValue){
                                                    if(btn=='ok'){
                                                        QueryVodomer.delVodomer(value,function(results){
                                                            if (results.success==="1"){

                                                                stHVodomer.load({
                                                                    params: {
                                                                        what:'HDvodomer',
                                                                        house_id: value.house_id,
                                                                        login:value.login,
                                                                        password:value.password
                                                                    },
                                                                    scope:this
                                                                });
                                                                // view.refresh();
                                                                Ext.MessageBox.show({
                                                                    title: 'Видалення приладу обліку безповоротно',
                                                                    msg: results.msg,
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.INFO
                                                                });
                                                            }
                                                        });
                                                    }
                                                }
                                            });
                                        },
                                        icon: 'resources/css/images/ico/no.png',
                                        tooltip: 'Удалить водомер безвозвратно'
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        xtype: 'gridpanel',
                        id: 'grTarifVoda',
                        scrollable: true,
                        width: 975,
                        bodyBorder: true,
                        title: 'Тариф',
                        emptyText: 'немає записів',
                        store: 'StTarif',
                        columns: [
                            {
                                xtype: 'numbercolumn',
                                width: 75,
                                dataIndex: 'rec_id',
                                menuDisabled: true,
                                text: 'зап_ид',
                                format: '0'
                            },
                            {
                                xtype: 'datecolumn',
                                dataIndex: 'data',
                                menuDisabled: true,
                                text: 'период',
                                format: 'd-m-Y'
                            },
                            {
                                xtype: 'numbercolumn',
                                width: 62,
                                align: 'center',
                                dataIndex: 'floor',
                                menuDisabled: true,
                                text: 'эт',
                                format: '0'
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'Тариф',
                                columns: [
                                    {
                                        xtype: 'numbercolumn',
                                        width: 95,
                                        align: 'right',
                                        dataIndex: 'voda',
                                        menuDisabled: true,
                                        text: 'Вода',
                                        format: '0.000'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 90,
                                        align: 'right',
                                        dataIndex: 'stoki',
                                        menuDisabled: true,
                                        text: 'Стоки',
                                        format: '0.000'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 105,
                                        align: 'right',
                                        dataIndex: 'abonplata',
                                        menuDisabled: true,
                                        text: 'Абонплата',
                                        format: '0.00'
                                    }
                                ]
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'Кубов по норме',
                                columns: [
                                    {
                                        xtype: 'numbercolumn',
                                        width: 95,
                                        align: 'right',
                                        dataIndex: 'xvkub',
                                        menuDisabled: true,
                                        text: 'в сутки',
                                        format: '0.00000'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 99,
                                        align: 'right',
                                        dataIndex: 'kub_mec',
                                        menuDisabled: true,
                                        text: 'за месяц',
                                        format: '0.00000'
                                    }
                                ]
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'льготный тариф',
                                columns: [
                                    {
                                        xtype: 'numbercolumn',
                                        width: 87,
                                        align: 'right',
                                        dataIndex: 'voda_lg',
                                        menuDisabled: true,
                                        text: 'Вода',
                                        format: '0.000'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 87,
                                        align: 'right',
                                        dataIndex: 'stoki_lg',
                                        menuDisabled: true,
                                        text: 'Стоки',
                                        format: '0.000'
                                    }
                                ]
                            },
                            {
                                xtype: 'gridcolumn',
                                menuDisabled: true,
                                text: 'Кубы льгота',
                                columns: [
                                    {
                                        xtype: 'numbercolumn',
                                        width: 73,
                                        align: 'right',
                                        dataIndex: 'xvkub_lg',
                                        menuDisabled: true,
                                        text: 'Хвода',
                                        format: '0.000'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        width: 69,
                                        align: 'right',
                                        dataIndex: 'gvkub_lg',
                                        menuDisabled: true,
                                        text: 'Гвода',
                                        format: '0.000'
                                    }
                                ]
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                width: 45,
                                dataIndex: 'kv16',
                                menuDisabled: true,
                                text: '16эт',
                                format: '0.000'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                width: 50,
                                dataIndex: 'ch_kv9f1',
                                menuDisabled: true,
                                text: 'п 9-1',
                                format: '0.000'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                width: 45,
                                dataIndex: 'kv9f1',
                                menuDisabled: true,
                                text: '9-1',
                                format: '0.000'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                width: 45,
                                dataIndex: 'ch_kv16',
                                menuDisabled: true,
                                text: 'п 16',
                                format: '0.000'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                width: 45,
                                dataIndex: 'kv16f1',
                                menuDisabled: true,
                                text: '16-1',
                                format: '0.000'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                width: 50,
                                dataIndex: 'ch_kv16f1',
                                menuDisabled: true,
                                text: 'п16-1',
                                format: '0.000'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'otoplenie',
                                text: 'Otoplenie'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'ch_otoplenie',
                                text: 'Ch_otoplenie'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'podogrev',
                                text: 'Podogrev'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'ch_podogrev',
                                text: 'Ch_podogrev'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'gv9',
                                text: 'Gv9'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'ch_gv9',
                                text: 'Ch_gv9'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'gv16',
                                text: 'Gv16'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'ch_gv16',
                                text: 'Ch_gv16'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'stoki',
                                text: 'Stoki'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'ch_stoki',
                                text: 'Ch_stoki'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'tbo',
                                text: 'Tbo'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'ch_tbo',
                                text: 'Ch_tbo'
                            },
                            {
                                xtype: 'numbercolumn',
                                hidden: true,
                                dataIndex: 'gvkub',
                                text: 'Gvkub'
                            }
                        ],
                        tools: [
                            {
                                xtype: 'tool',
                                callback: function(owner, tool, event) {
                                    // in use

                                    var grid = tool.findParentByType('grid');
                                    var stUser = Ext.data.StoreManager.get("StUser");
                                    var store = grid.store;

                                    //LOGIN & PASSWORD
                                    var values =stUser.getAt(0);

                                    //LOGIKA
                                    grid.store.load({
                                        params: {
                                            house_id:values.get('house_id'),
                                            login:values.get('login'),
                                            password:values.get('password'),
                                            what:"TarifVodaAll"
                                        },
                                        scope:this
                                    });
                                    grid.getView().refresh();
                                },
                                type: 'search'
                            }
                        ]
                    }
                ]
            };
        if (instanceConfig) {
            me.getConfigurator().merge(me, config, instanceConfig);
        }
        return me.callParent([config]);
    },

    onToolClick1: function(tool, e, owner, eOpts) {
        // in use

        var grid = tool.findParentByType('grid');
        var stUser = Ext.data.StoreManager.get("StUser");
        var store = grid.store;

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);

        //LOGIKA
        grid.store.load({
            params: {
                house_id:values.get('house_id'),
                login:values.get('login'),
                password:values.get('password'),
                what_id:values.get('dvodomer_id'),
                dvodomer_id:values.get('dvodomer_id'),
                what:"AllOrgByHouse"
            },
            scope:this
        });
        grid.getView().refresh();
    },

    onToolClick11: function(tool, e, owner, eOpts) {
        var winAddAktClaim = Ext.ClassManager.instantiateByAlias('widget.winaddaktclaim');
        var fmDVodomers = Ext.getCmp('fmDVodomers');
        var value = fmDVodomers.getValues();
        //LOGIKA

        var form = winAddAktClaim.down('#fnAddAktClaim');
        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        values.set({'vibor':'addAktClaim'});
        stUser.sync();
        Ext.Object.merge(value, values);
        form.loadRecord(value);
        //console.log(value);
        var dt = new Date();
        form.down('#btnInsertAktClaim').setText('Добавить акт');
        form.getForm().findField('data').setValue(Ext.Date.format(dt, 'Y-m-d'));
        winAddAktClaim.show();
    }

});