/*
 * File: app/view/sprav/WinPrintSchetVik.js
 * Date: Sun May 17 2020 02:44:16 GMT+0300 (EEST)
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Ykis.view.sprav.WinPrintSchetVik', {
    extend: 'Ext.window.Window',
    alias: 'widget.winprintschetvik',

    requires: [
        'Ykis.view.sprav.WinPrintSchetVikViewModel',
        'Ext.form.Panel',
        'Ext.form.FieldSet',
        'Ext.form.field.Hidden',
        'Ext.form.field.Date',
        'Ext.form.field.TextArea',
        'Ext.form.field.ComboBox',
        'Ext.form.field.Checkbox',
        'Ext.button.Button',
        'Ext.form.field.Number'
    ],

    viewModel: {
        type: 'winprintschetvik'
    },
    height: 734,
    id: 'winPrintSchetVik',
    width: 726,
    layout: 'fit',
    title: 'Выписка счета',
    modal: true,
    defaultListenerScope: true,

    items: [
        {
            xtype: 'form',
            id: 'fmPrintScheVik',
            layout: 'fit',
            title: '',
            items: [
                {
                    xtype: 'fieldset',
                    style: 'background-color: #DCDCDC;',
                    width: 415,
                    layout: 'absolute',
                    title: '',
                    items: [
                        {
                            xtype: 'hiddenfield',
                            x: 95,
                            y: 5,
                            width: 125,
                            fieldLabel: 'Запись_ид',
                            labelAlign: 'top',
                            labelWidth: 70,
                            name: 'rec_id'
                        },
                        {
                            xtype: 'hiddenfield',
                            x: 95,
                            y: 5,
                            width: 125,
                            fieldLabel: 'Запись_ид',
                            labelAlign: 'top',
                            labelWidth: 70,
                            name: 'filial_id'
                        },
                        {
                            xtype: 'hiddenfield',
                            x: 95,
                            y: 5,
                            width: 125,
                            fieldLabel: 'Запись_ид',
                            labelAlign: 'top',
                            labelWidth: 70,
                            name: 'org_id'
                        },
                        {
                            xtype: 'fieldset',
                            x: 10,
                            y: 10,
                            height: 85,
                            style: 'background-color: #f1eeee;',
                            width: 440,
                            layout: 'absolute',
                            title: 'Реквизиты счета',
                            items: [
                                {
                                    xtype: 'textfield',
                                    formBind: false,
                                    width: 105,
                                    fieldLabel: '№ счета',
                                    labelAlign: 'top',
                                    labelWidth: 60,
                                    name: 'nom',
                                    allowBlank: false,
                                    blankText: 'Поле обязательное для заполнения'
                                },
                                {
                                    xtype: 'datefield',
                                    x: 270,
                                    y: 0,
                                    width: 140,
                                    fieldLabel: 'период начисления',
                                    labelAlign: 'top',
                                    labelWidth: 130,
                                    name: 'data',
                                    allowBlank: false,
                                    hideTrigger: true,
                                    format: 'd-m-Y',
                                    submitFormat: 'Ymd'
                                },
                                {
                                    xtype: 'datefield',
                                    x: 120,
                                    y: 0,
                                    width: 140,
                                    fieldLabel: 'дата выписки счета',
                                    labelAlign: 'top',
                                    labelWidth: 130,
                                    name: 'sdata',
                                    format: 'd-m-Y',
                                    submitFormat: 'Ymd'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 10,
                            y: 100,
                            height: 310,
                            style: 'background-color: #f1eeee;',
                            width: 675,
                            layout: 'absolute',
                            title: 'Реквизиты плательщика',
                            items: [
                                {
                                    xtype: 'textareafield',
                                    x: 0,
                                    y: 0,
                                    width: 645,
                                    fieldLabel: 'Наименование организации',
                                    labelWidth: 90,
                                    name: 'fname',
                                    allowBlank: false,
                                    grow: true
                                },
                                {
                                    xtype: 'textareafield',
                                    x: 0,
                                    y: 60,
                                    formBind: false,
                                    width: 510,
                                    fieldLabel: 'Юридический адрес',
                                    labelWidth: 90,
                                    name: 'address',
                                    allowBlank: false,
                                    blankText: 'Поле обязательное для заполнения',
                                    grow: true
                                },
                                {
                                    xtype: 'fieldset',
                                    x: 0,
                                    y: 120,
                                    height: 65,
                                    style: 'background-color: #f1eeee;',
                                    width: 645,
                                    layout: 'absolute',
                                    title: 'Банковские реквизиты',
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            x: 0,
                                            y: 5,
                                            width: 345,
                                            fieldLabel: 'Банк',
                                            labelWidth: 40,
                                            name: 'mfo',
                                            allowBlank: false,
                                            anyMatch: true,
                                            displayField: 'sname',
                                            queryMode: 'local',
                                            store: 'StBanks',
                                            valueField: 'mfo'
                                        },
                                        {
                                            xtype: 'textfield',
                                            x: 350,
                                            y: 5,
                                            width: 185,
                                            fieldLabel: 'Р/с',
                                            labelWidth: 40,
                                            name: 'rs',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'checkboxfield',
                                            x: 540,
                                            y: 5,
                                            fieldLabel: 'Осн',
                                            labelWidth: 35,
                                            name: 'osn',
                                            boxLabel: 'Нет',
                                            inputValue: '1',
                                            uncheckedValue: '0',
                                            listeners: {
                                                change: 'onCheckboxfieldChange'
                                            }
                                        }
                                    ]
                                },
                                {
                                    xtype: 'textfield',
                                    x: 0,
                                    y: 225,
                                    formBind: false,
                                    width: 530,
                                    fieldLabel: 'В особи',
                                    labelWidth: 90,
                                    name: 'vosobi',
                                    allowBlank: false,
                                    blankText: 'Поле обязательное для заполнения'
                                },
                                {
                                    xtype: 'textfield',
                                    x: 0,
                                    y: 255,
                                    formBind: false,
                                    width: 530,
                                    fieldLabel: 'Договор',
                                    labelWidth: 90,
                                    name: 'dogovor',
                                    allowBlank: false,
                                    blankText: 'Поле обязательное для заполнения'
                                },
                                {
                                    xtype: 'textfield',
                                    x: 515,
                                    y: 65,
                                    width: 125,
                                    fieldLabel: 'ЕДРПОУ',
                                    labelAlign: 'top',
                                    labelWidth: 70,
                                    name: 'edrpou',
                                    allowBlank: false
                                },
                                {
                                    xtype: 'textfield',
                                    x: 370,
                                    y: 195,
                                    formBind: false,
                                    fieldLabel: 'Руководитель',
                                    name: 'boss',
                                    allowBlank: false,
                                    blankText: 'Поле обязательное для заполнения'
                                },
                                {
                                    xtype: 'textfield',
                                    x: 0,
                                    y: 195,
                                    formBind: false,
                                    width: 355,
                                    fieldLabel: 'Должность',
                                    labelWidth: 90,
                                    name: 'golova',
                                    value: 'Директор',
                                    allowBlank: false,
                                    blankText: 'Поле обязательное для заполнения'
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        //COMBO
                                        var value = button.findParentByType('form').getValues();
                                        //STORE
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var values =stUser.getAt(0);

                                        //LOGIKA
                                        var params = {
                                            login:values.get('login'),
                                            password:values.get('password'),
                                            what:'updateBankFilial'
                                        };


                                        //LOGIKA


                                        Ext.Object.merge(value, params);

                                        var myMask= Ext.Msg.show({
                                            title:'Обновление данных...',
                                            msg: 'Обновление данных по оргнизации.Ожидайте...',
                                            buttons: Ext.Msg.CANCEL,
                                            wait: true,
                                            modal: true,
                                            icon: Ext.Msg.INFO
                                        });

                                        QueryOrg.Filial(value,function(results){
                                            if(results.success==="1"){

                                                myMask.close();
                                                Ext.MessageBox.show({
                                                    title: 'Обновление данных',
                                                    msg: results.msg,
                                                    buttons: Ext.MessageBox.OK,
                                                    icon: Ext.MessageBox.INFO
                                                });
                                            } else {
                                                myMask.close();
                                                Ext.MessageBox.show({
                                                    title: 'Обновление данных',
                                                    msg: results.msg,
                                                    buttons: Ext.MessageBox.OK,
                                                    icon: Ext.MessageBox.ERROR
                                                });

                                            }

                                        });
                                    },
                                    x: 545,
                                    y: 240,
                                    formBind: true,
                                    width: 100,
                                    icon: 'resources/css/images/ico/add.png',
                                    text: 'Запомнить'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 10,
                            y: 420,
                            height: 215,
                            style: 'background-color: #f1eeee;',
                            width: 220,
                            title: 'Водоснабжение',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Тариф',
                                    labelWidth: 60,
                                    name: 'tarif_xv',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Кубов',
                                    labelWidth: 60,
                                    name: 'kub_xv',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Хвода',
                                    labelWidth: 60,
                                    name: 'xvoda',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true
                                },
                                {
                                    xtype: 'fieldset',
                                    anchor: '100%',
                                    height: 88,
                                    title: 'Перерасчет',
                                    items: [
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'Кубов',
                                            labelWidth: 60,
                                            name: 'pkub_xv',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true
                                        },
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'Сумма',
                                            labelWidth: 60,
                                            name: 'pxvoda',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 235,
                            y: 420,
                            height: 215,
                            style: 'background-color: #f1eeee;',
                            width: 220,
                            title: 'Водоотведение',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Тариф',
                                    labelWidth: 60,
                                    name: 'tarif_st',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Кубов',
                                    labelWidth: 60,
                                    name: 'kub_st',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Стоки',
                                    labelWidth: 60,
                                    name: 'stoki',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true
                                },
                                {
                                    xtype: 'fieldset',
                                    anchor: '100%',
                                    height: 88,
                                    title: 'Перерасчет',
                                    items: [
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'Кубов',
                                            labelWidth: 60,
                                            name: 'pkub_st',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true
                                        },
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'Сумма',
                                            labelWidth: 60,
                                            name: 'pstoki',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            anchor: '100%',
                            x: 465,
                            y: 420,
                            height: 215,
                            style: 'background-color: #f1eeee;',
                            width: 229,
                            title: 'Итого',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Сальдо нач',
                                    labelWidth: 80,
                                    name: 'zadol',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Начислено',
                                    labelWidth: 80,
                                    name: 'nachisleno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    allowBlank: false,
                                    hideTrigger: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'НДС',
                                    labelWidth: 80,
                                    name: 'nds',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    allowBlank: false,
                                    hideTrigger: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Итого',
                                    labelWidth: 80,
                                    name: 'itogo',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    allowBlank: false,
                                    hideTrigger: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Оплачено',
                                    labelWidth: 80,
                                    name: 'oplacheno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Сальдо кон',
                                    labelWidth: 80,
                                    name: 'dolg',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true
                                }
                            ]
                        },
                        {
                            xtype: 'button',
                            handler: function(button, event) {
                                this.up('#winPrintSchetVik').close();
                            },
                            x: 10,
                            y: 645,
                            width: 80,
                            icon: 'resources/css/images/ico/delete.png',
                            text: 'Отмена'
                        },
                        {
                            xtype: 'button',
                            handler: function(button, e) {
                                //in use
                                var form = button.findParentByType('form').getForm();
                                var StUser = Ext.data.StoreManager.get("StUser");
                                var rec_id = form.findField('rec_id').getValue();
                                var sdata = form.findField('sdata').getValue();

                                var values =StUser.getAt(0);

                                var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();
                                if (rec_id) {
                                    var report = 'schetVik';
                                    var namereport = 'Счет ВиК';
                                    var value = {
                                        login:values.get('login'),
                                        password:values.get('password'),
                                        report:report,
                                        what:report,
                                        sdata: sdata,
                                        rec_id: rec_id
                                    };
                                    var tab = tabPnCenter.child('#'+report);
                                    if (!tab) {
                                        tab  = tabPnCenter.add({
                                            xtype:'tabreportorg',
                                            title:namereport,
                                            id:''+report+''
                                        });

                                    }
                                    tabPnCenter.setActiveTab(tab);
                                    var reppan = tab.getComponent(0);
                                    // Basic mask:
                                    var myMask = Ext.Msg.show({
                                        title:'Выписка счета...',
                                        msg: 'Выписка ...',
                                        buttons: Ext.Msg.CANCEL,
                                        wait: true,
                                        modal: true,
                                        icon: Ext.Msg.INFO
                                    });

                                    QueryKassa.getRaspechatka(value,function(data){
                                        if (data){
                                            reppan.update(data.content);
                                            Ext.REPORTCONTENT =data.content;
                                            Ext.REPORTSQL =data.sql;
                                            Ext.REPORTTITLE =report;
                                            myMask.close();
                                            button.up('#winPrintSchetVik').close();
                                        } else {
                                            myMask.close();
                                            Ext.MessageBox.show({
                                                title: 'Ошибка ',
                                                msg: 'Документ не создан',
                                                buttons: Ext.MessageBox.OK,
                                                icon: Ext.MessageBox.ERROR
                                            });
                                        }
                                    });


                                }
                            },
                            x: 485,
                            y: 35,
                            formBind: true,
                            width: 190,
                            icon: 'resources/css/images/ico/print_printer.png',
                            scale: 'large',
                            text: 'Выписать счет'
                        },
                        {
                            xtype: 'button',
                            handler: function(button, event) {
                                var form = button.findParentByType('form').getForm();
                                var grSchetVik = Ext.getCmp("grSchetVik");
                                var value  = grSchetVik.getView().getSelectionModel().getSelection()[0];
                                form.loadRecord(value);

                            },
                            x: 535,
                            y: 645,
                            formBind: true,
                            margin: '0 10 0 0',
                            width: 155,
                            icon: 'resources/css/images/ico/refresh.png',
                            text: 'Восстановить',
                            tooltip: 'Восстановить'
                        }
                    ]
                }
            ]
        }
    ],

    onCheckboxfieldChange: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Да");
        }else{
            field.setBoxLabel("Нет");
        }
    }

});