/*
 * File: app/view/sprav/WinAddDvodomer.js
 * Date: Tue Sep 22 2020 10:45:25 GMT+0300 (EEST)
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Ykis.view.sprav.WinAddDvodomer', {
    extend: 'Ext.window.Window',
    alias: 'widget.winadddvodomer',

    requires: [
        'Ykis.view.sprav.WinAddDvodomerViewModel',
        'Ext.form.Panel',
        'Ext.form.field.ComboBox',
        'Ext.form.RadioGroup',
        'Ext.form.field.Radio',
        'Ext.form.FieldSet',
        'Ext.form.field.Number',
        'Ext.button.Button',
        'Ext.form.field.Hidden',
        'Ext.form.field.Date'
    ],

    viewModel: {
        type: 'winadddvodomer'
    },
    height: 447,
    id: 'winAddDvodomer',
    width: 628,
    title: 'Введення нового приладу обліку (введення)',
    modal: true,
    defaultListenerScope: true,

    items: [
        {
            xtype: 'form',
            height: 403,
            id: 'fmAddDvodomer',
            layout: 'fit',
            title: '',
            items: [
                {
                    xtype: 'fieldcontainer',
                    style: 'background-color: #DCDCDC;',
                    layout: 'absolute',
                    labelAlign: 'top',
                    items: [
                        {
                            xtype: 'combobox',
                            x: 20,
                            y: 25,
                            formBind: false,
                            width: 280,
                            fieldLabel: 'Модель',
                            labelWidth: 70,
                            name: 'model_id',
                            allowBlank: false,
                            displayField: 'model',
                            queryMode: 'local',
                            store: 'StVmodel',
                            valueField: 'model_id'
                        },
                        {
                            xtype: 'textfield',
                            x: 320,
                            y: 25,
                            formBind: false,
                            width: 270,
                            fieldLabel: 'Номер',
                            labelWidth: 60,
                            name: 'nomer',
                            allowBlank: false,
                            blankText: 'Поле обязательное для заполнения'
                        },
                        {
                            xtype: 'radiogroup',
                            x: 15,
                            y: 70,
                            id: 'rbgTypeDVoda',
                            style: 'background-color: #e4dbdb;',
                            width: 300,
                            fieldLabel: 'Тип води',
                            labelWidth: 70,
                            columns: 2,
                            vertical: true,
                            items: [
                                {
                                    xtype: 'radiofield',
                                    name: 'voda',
                                    boxLabel: 'на холодну',
                                    checked: true,
                                    inputValue: 'Хвода'
                                },
                                {
                                    xtype: 'radiofield',
                                    name: 'voda',
                                    boxLabel: 'на гарячу',
                                    inputValue: 'Гвода'
                                }
                            ]
                        },
                        {
                            xtype: 'checkboxfield',
                            x: 335,
                            y: 70,
                            fieldLabel: '',
                            name: 'vd',
                            boxLabel: 'водопостачання',
                            checked: true,
                            inputValue: '1',
                            uncheckedValue: '0'
                        },
                        {
                            xtype: 'checkboxfield',
                            x: 470,
                            y: 70,
                            fieldLabel: '',
                            name: 'st',
                            boxLabel: 'водовідведення',
                            checked: true,
                            inputValue: '1',
                            uncheckedValue: '0'
                        },
                        {
                            xtype: 'fieldset',
                            x: 10,
                            y: 110,
                            height: 70,
                            style: 'background-color: #f1eeee;',
                            width: 585,
                            layout: 'absolute',
                            title: 'Номер ввода',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    x: 270,
                                    y: 5,
                                    hidden: true,
                                    width: 90,
                                    fieldLabel: 'с',
                                    labelWidth: 20,
                                    name: 'first_app',
                                    allowDecimals: false,
                                    decimalPrecision: 0,
                                    step: 10
                                },
                                {
                                    xtype: 'numberfield',
                                    x: 370,
                                    y: 5,
                                    hidden: true,
                                    width: 90,
                                    fieldLabel: 'по',
                                    labelWidth: 20,
                                    name: 'last_app',
                                    allowDecimals: false,
                                    decimalPrecision: 0,
                                    step: 10
                                },
                                {
                                    xtype: 'checkboxfield',
                                    x: 160,
                                    y: 5,
                                    fieldLabel: '',
                                    name: 'allapp',
                                    boxLabel: 'все квартиры',
                                    checked: true,
                                    inputValue: '1',
                                    uncheckedValue: '0',
                                    listeners: {
                                        change: 'onCheckboxfieldChange11'
                                    }
                                },
                                {
                                    xtype: 'combobox',
                                    x: 0,
                                    y: 5,
                                    width: 150,
                                    fieldLabel: 'Ввод',
                                    labelWidth: 50,
                                    name: 'vvod',
                                    allowBlank: false,
                                    displayField: 'vvod',
                                    queryMode: 'local',
                                    store: 'StVvod',
                                    valueField: 'vvod'
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var form = button.findParentByType('form');
                                        var value = form.getValues();
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var StTekPokDVodomera = Ext.data.StoreManager.get("StTekPokDVodomera");

                                        //LOGIN & PASSWORD

                                        var values =stUser.getAt(0);
                                        var params = {
                                            login:values.get('login'),
                                            password:values.get('password'),
                                            what:"updateVvodDvodomer"
                                        };

                                        var fmDVodomers = Ext.getCmp('fmDVodomers');
                                        var fmAddDVodomer = Ext.getCmp('fmAddDvodomer');
                                        var value = fmAddDVodomer.getValues();

                                        Ext.Object.merge(value, params);

                                        var myMask= Ext.Msg.show({
                                            title:'Оновлення квартир на введенні приладу обліку...',
                                            msg: 'Оновлення квартир.Чекайте...',
                                            buttons: Ext.Msg.CANCEL,
                                            wait: true,
                                            modal: true,
                                            icon: Ext.Msg.INFO
                                        });
                                        QueryVodomer.updateVodomer(value,function(results){
                                            if (results.success){
                                                StTekPokDVodomera.load({
                                                    params: {
                                                        login:values.get('login'),
                                                        password:values.get('password'),
                                                        what:'TekPokDVodomera',
                                                        dvodomer_id:value.dvodomer_id
                                                    },
                                                    callback: function(records,operation,success){
                                                        if(success){
                                                            Ext.MessageBox.show({
                                                                title: 'Оновлення квартир на введенні приладу обліку',
                                                                msg: results.msg,
                                                                buttons: Ext.MessageBox.OK,
                                                                icon: Ext.MessageBox.INFO
                                                            });
                                                            fmDVodomers.getForm().loadRecord(records[0]);
                                                        }
                                                    },
                                                    scope:this
                                                });

                                            }else{
                                                Ext.MessageBox.show({
                                                    title: 'Оновлення квартир на введенні приладу обліку',
                                                    msg: results.msg,
                                                    buttons: Ext.MessageBox.OK,
                                                    icon: Ext.MessageBox.ERROR
                                                });
                                            }
                                            //myMask.close();

                                        });
                                        button.up('#winAddDvodomer').close();
                                    },
                                    x: 470,
                                    y: 5,
                                    formBind: true,
                                    hidden: true,
                                    id: 'btnUpdateVvod',
                                    width: 90,
                                    icon: 'resources/css/images/ico/add.png',
                                    text: 'Оновити'
                                }
                            ]
                        },
                        {
                            xtype: 'button',
                            handler: function(button, event) {
                                button.up('#winAddDvodomer').close();
                            },
                            x: 105,
                            y: 355,
                            width: 130,
                            icon: 'resources/css/images/ico/delete.png',
                            text: 'Скасувати'
                        },
                        {
                            xtype: 'button',
                            x: 320,
                            y: 355,
                            formBind: true,
                            id: 'btAddDVodomer',
                            width: 215,
                            icon: 'resources/css/images/ico/add.png',
                            text: 'Додати прилад обліку'
                        },
                        {
                            xtype: 'hiddenfield',
                            name: 'dvodomer_id'
                        },
                        {
                            xtype: 'fieldset',
                            x: 305,
                            y: 190,
                            height: 145,
                            style: 'background-color: #e0e0e0;',
                            width: 240,
                            title: 'Установка',
                            items: [
                                {
                                    xtype: 'datefield',
                                    anchor: '100%',
                                    fieldLabel: 'Дата випуску',
                                    name: 'zdate',
                                    allowBlank: false,
                                    format: 'd-m-Y',
                                    submitFormat: 'Ymd'
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    width: 218,
                                    fieldLabel: 'термін повірки (рік)',
                                    labelWidth: 150,
                                    name: 'pp',
                                    value: 0,
                                    allowBlank: false,
                                    blankText: 'Поле обязательное для заполнения',
                                    hideTrigger: true,
                                    decimalPrecision: 0
                                },
                                {
                                    xtype: 'datefield',
                                    anchor: '100%',
                                    fieldLabel: 'Дата введення',
                                    name: 'sdate',
                                    allowBlank: false,
                                    format: 'd-m-Y',
                                    submitFormat: 'Ymd'
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Первинне показання',
                                    name: 'tek',
                                    value: 0,
                                    allowBlank: false,
                                    blankText: 'Поле обязательное для заполнения',
                                    hideTrigger: true,
                                    decimalPrecision: 3
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 60,
                            y: 190,
                            height: 145,
                            id: 'fcntNewDVodomer',
                            style: 'background-color: #e0e0e0;',
                            width: 235,
                            title: 'Повірка',
                            items: [
                                {
                                    xtype: 'datefield',
                                    anchor: '100%',
                                    fieldLabel: 'Остання',
                                    labelWidth: 70,
                                    name: 'pdate',
                                    allowBlank: false,
                                    format: 'd-m-Y',
                                    submitFormat: 'Ymd'
                                },
                                {
                                    xtype: 'datefield',
                                    anchor: '100%',
                                    fieldLabel: 'Наступна',
                                    labelWidth: 70,
                                    name: 'fpdate',
                                    format: 'd-m-Y',
                                    submitFormat: 'Ymd'
                                },
                                {
                                    xtype: 'textfield',
                                    anchor: '100%',
                                    fieldLabel: '№ пломби',
                                    labelWidth: 70,
                                    name: 'plomba'
                                },
                                {
                                    xtype: 'checkboxfield',
                                    anchor: '100%',
                                    padding: '0 0 0 20',
                                    width: 120,
                                    fieldLabel: '',
                                    name: 'paused',
                                    boxLabel: 'Призупинено',
                                    inputValue: '1',
                                    uncheckedValue: '0'
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ],

    onCheckboxfieldChange11: function(field, newValue, oldValue, eOpts) {
        var form = field.findParentByType('form');

        if (newValue) {
            form.getForm().findField('first_app').setValue(0);
            form.getForm().findField('last_app').setValue(0);
            form.getForm().findField('first_app').hide();
            form.getForm().findField('last_app').hide();
        } else {
            form.getForm().findField('first_app').setValue(1);
            form.getForm().findField('last_app').setValue(0);
            form.getForm().findField('first_app').show();
            form.getForm().findField('last_app').show();
            //form.getForm().reset();
            //var btn = form.down('#btAddDVodomer').focus();
            // console.log(btn)

        }
    }

});