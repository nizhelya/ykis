/*
 * File: app/view/menu/TabPnLeft.js
 * Date: Sun May 17 2020 01:06:10 GMT+0300 (EEST)
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Ykis.view.menu.TabPnLeft', {
    extend: 'Ext.tab.Panel',
    alias: 'widget.tabpnleft',

    requires: [
        'Ykis.view.menu.TabPnLeftViewModel',
        'Ykis.view.menu.TabPnLeftViewController',
        'Ext.tab.Tab',
        'Ext.form.FieldSet',
        'Ext.form.Label',
        'Ext.form.RadioGroup',
        'Ext.form.field.Radio',
        'Ext.form.field.ComboBox',
        'Ext.XTemplate',
        'Ext.form.field.Number',
        'Ext.form.Panel',
        'Ext.tree.Panel',
        'Ext.tree.View',
        'Ext.tree.Column'
    ],

    controller: 'tabpnleft',
    viewModel: {
        type: 'tabpnleft'
    },
    border: false,
    height: 678,
    id: 'tabPnLeft',
    animCollapse: true,
    collapseDirection: 'left',
    headerPosition: 'bottom',
    activeTab: 0,
    removePanelHeader: false,
    defaultListenerScope: true,

    items: [
        {
            xtype: 'panel',
            border: false,
            id: 'tabMenuLifeFond',
            scrollable: true,
            header: false,
            title: 'ЖФ',
            layout: {
                type: 'vbox',
                align: 'stretch'
            },
            tabConfig: {
                xtype: 'tab',
                frame: false,
                iconCls: 'icon-home'
            },
            items: [
                {
                    xtype: 'fieldset',
                    padding: '5 0 5 0',
                    style: 'background-color: #DCDCDC;',
                    title: '',
                    items: [
                        {
                            xtype: 'label',
                            id: 'showAddress',
                            margin: '0 0 10 20',
                            style: 'color: #D15706; text-shadow: -1px -1px white, 1px 1px #333;font-size:14pt;text-align:left;',
                            width: 62,
                            text: 'Адрес'
                        },
                        {
                            xtype: 'radiogroup',
                            disabled: true,
                            id: 'rbTypeClick',
                            padding: '0 0 0 30',
                            width: 150,
                            fieldLabel: '',
                            items: [
                                {
                                    xtype: 'radiofield',
                                    name: 'typeClick',
                                    boxLabel: 'адрес',
                                    checked: true,
                                    inputValue: 'address'
                                },
                                {
                                    xtype: 'radiofield',
                                    name: 'typeClick',
                                    boxLabel: 'дом',
                                    inputValue: 'house'
                                }
                            ],
                            listeners: {
                                change: {
                                    fn: 'onRbTypeClickChange',
                                    scope: 'controller'
                                }
                            }
                        },
                        {
                            xtype: 'combobox',
                            id: 'cbRaion',
                            padding: '0 0 0 10',
                            width: 200,
                            fieldLabel: '',
                            emptyText: 'Выбрать район',
                            displayField: 'raion',
                            queryMode: 'local',
                            store: 'StRaion',
                            valueField: 'raion_id',
                            listeners: {
                                select: {
                                    fn: 'onCbRaionSelect',
                                    scope: 'controller'
                                }
                            }
                        },
                        {
                            xtype: 'combobox',
                            id: 'cbStreet',
                            padding: '0 0 0 10',
                            width: 200,
                            fieldLabel: '',
                            emptyText: 'Выбрать улицу',
                            displayField: 'street',
                            queryMode: 'local',
                            store: 'StStreet',
                            valueField: 'street_id',
                            listeners: {
                                select: {
                                    fn: 'onCbStreetSelect',
                                    scope: 'controller'
                                }
                            }
                        },
                        {
                            xtype: 'combobox',
                            id: 'cbHouses',
                            padding: '0 0 0 10',
                            width: 200,
                            fieldLabel: '',
                            emptyText: 'Выбрать дом',
                            displayField: 'house',
                            queryMode: 'local',
                            store: 'StHouse',
                            valueField: 'house_id',
                            listeners: {
                                select: {
                                    fn: 'onCbHousesSelect',
                                    scope: 'controller'
                                }
                            }
                        }
                    ]
                },
                {
                    xtype: 'panel',
                    flex: 1,
                    id: 'listHouses',
                    style: 'background-color: #DCDCDC;',
                    layout: 'fit',
                    collapseFirst: false,
                    title: '',
                    items: [
                        {
                            xtype: 'dataview',
                            cls: 'feed-list',
                            id: 'listHousesView',
                            scrollable: true,
                            style: 'background-color: #DCDCDC;',
                            tpl: [
                                '<tpl for="."><div class="feed-list-item">{item}</div></tpl>'
                            ],
                            emptyText: '',
                            itemSelector: '.feed-list-item',
                            overItemCls: 'feed-list-item-hover',
                            store: 'StHouses'
                        }
                    ]
                },
                {
                    xtype: 'numberfield',
                    flex: 1,
                    hidden: true,
                    id: 'indexTabLifeFond',
                    fieldLabel: 'Label',
                    name: 'indexTabLifeFond',
                    value: 0,
                    decimalPrecision: 0
                },
                {
                    xtype: 'numberfield',
                    flex: 1,
                    hidden: true,
                    id: 'indexTabOrg',
                    fieldLabel: 'Label',
                    name: 'indexTabOrg',
                    value: 4,
                    decimalPrecision: 0
                }
            ]
        },
        {
            xtype: 'panel',
            id: 'tabMenuOrg',
            scrollable: true,
            header: false,
            iconCls: '',
            title: 'Орг',
            layout: {
                type: 'vbox',
                align: 'stretch'
            },
            tabConfig: {
                xtype: 'tab',
                iconCls: 'icon-factory'
            },
            items: [
                {
                    xtype: 'form',
                    height: 70,
                    width: 100,
                    layout: 'fit',
                    title: '',
                    items: [
                        {
                            xtype: 'fieldset',
                            height: 45,
                            style: 'background-color: #e4dbdb;',
                            title: '',
                            items: [
                                {
                                    xtype: 'button',
                                    anchor: '100%',
                                    id: 'btnAddOrg',
                                    width: 134,
                                    iconCls: 'icon-add',
                                    text: 'Добавить организацию'
                                },
                                {
                                    xtype: 'combobox',
                                    anchor: '100%',
                                    id: 'grOrgSearchField',
                                    fieldLabel: '',
                                    anyMatch: true,
                                    displayField: 'sname',
                                    store: 'StOrgOpl',
                                    valueField: 'org_id',
                                    listeners: {
                                        select: 'onGrOrgSearchFieldSelect'
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'treepanel',
                    flex: 1,
                    id: 'grTreeOrg',
                    header: false,
                    title: '',
                    emptyText: 'Организация не найдена',
                    store: 'StTreeOrg',
                    rootVisible: false,
                    singleExpand: true,
                    viewConfig: {
                        id: 'viewOrgMenu',
                        style: 'background-color: #e4dbdb;',
                        rootVisible: false
                    },
                    columns: [
                        {
                            xtype: 'treecolumn',
                            resizable: false,
                            style: 'background-color: #e4dbdb;',
                            detachOnRemove: false,
                            enableColumnHide: false,
                            dataIndex: 'text',
                            text: 'наименование организаций',
                            flex: 1
                        }
                    ]
                }
            ]
        },
        {
            xtype: 'panel',
            id: 'tabMenuSprav',
            scrollable: true,
            layout: 'fit',
            header: false,
            title: 'Инфо',
            tabConfig: {
                xtype: 'tab',
                flex: 1,
                iconCls: 'icon-sprav'
            },
            items: [
                {
                    xtype: 'treepanel',
                    id: 'treeMenuSprav',
                    title: '',
                    forceFit: true,
                    store: 'StTreeSprav',
                    rootVisible: false,
                    viewConfig: {
                        id: 'treeMenuSpravView',
                        style: 'background-color: #e4dbdb;',
                        loadingText: 'Загрузка...'
                    }
                }
            ]
        }
    ],

    onGrOrgSearchFieldSelect: function(combo, record, eOpts) {
        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');
        var StTreeOrg = Ext.data.StoreManager.get("StTreeOrg");
        var store = combo.getStore();
        var selected = record;



        if (selected && !store.getById(selected.get("org_id"))) {


            StTreeOrg.load({
                params: {
                    org_id:selected.get('org_id')
                },
                scope: this
            });
            //console.log(newValue);

        }





    }

});