{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userAlias": "crOrgTeplomer",
        "designer|userClassName": "CrOrgTeplomer"
    },
    "designerId": "947cc375-47a0-4a8c-b20e-874cf29a837c",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#tabOrgTeplomer",
                "designer|targetType": "Ext.panel.Panel",
                "fn": "onTabOrgTeplomerActivate",
                "implHandler": [
                    "//in use",
                    "var me =this;",
                    "//STORE",
                    "",
                    "var stUser = Ext.data.StoreManager.get(\"StUser\");",
                    "var stTeplomer = Ext.data.StoreManager.get(\"StOTeplomer\");",
                    "var stHTeplomer = Ext.data.StoreManager.get(\"StHOTeplomer\");",
                    "var StAllPokTeplomera = Ext.data.StoreManager.get(\"StAllPokOTeplomera\");",
                    "StAllPokTeplomera.removeAll();",
                    "",
                    "//PANEL",
                    "",
                    "//LOGIN & PASSWORD",
                    "",
                    "var values =stUser.getAt(0);",
                    "var login = values.get('login');",
                    "var password = values.get('password');",
                    "var address_id = values.get('address_id');",
                    "var address = values.get('address');",
                    "var filial_id = values.get('filial_id');",
                    "var filial = values.get('filial');",
                    "var org_id = values.get('org_id');",
                    "var house_id = values.get('house_id');",
                    "",
                    "var fmOrgTeplomer = Ext.getCmp('fmOrgTeplomer');",
                    "",
                    "fmOrgTeplomer.getForm().reset();",
                    "",
                    "",
                    "stTeplomer.load({",
                    "    params: {",
                    "        what:'OrgTeplomer',",
                    "        what_id: filial_id,",
                    "        filial_id: filial_id,",
                    "        login:login,",
                    "        password:password",
                    "    },",
                    "    scope:this",
                    "});",
                    "",
                    "",
                    "stHTeplomer.load({",
                    "    params: {",
                    "        what:'OrgHTeplomer',",
                    "        what_id: filial_id,",
                    "        filial_id: filial_id,",
                    "        login:login,",
                    "        password:password",
                    "    },",
                    "    scope:this",
                    "});",
                    "",
                    "",
                    ""
                ],
                "name": "activate",
                "scope": "me"
            },
            "name": "onTabOrgTeplomerActivate",
            "designerId": "32bcde47-fe0e-4bd8-9ca9-d14c04951754"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "WinAddTeplomer",
                "selector": "#winAddTeplomer",
                "xtype": null
            },
            "name": "WinAddTeplomer",
            "designerId": "8efbbdca-5dc8-45fa-b1fd-d250a0632370"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "value"
                ],
                "fn": "editOrgTeplomer",
                "implHandler": [
                    "// in use",
                    "var me = this;",
                    "//STORE",
                    "var stUser = Ext.data.StoreManager.get(\"StUser\");",
                    "var StOTeplomer = Ext.data.StoreManager.get(\"StOTeplomer\");//QueryTeplomer.getResults  <OrgTeplomer>",
                    "//LOGIN & PASSWORD",
                    "",
                    "var values =stUser.getAt(0);",
                    "var params = {",
                    "    login:values.get('login'),",
                    "    password:values.get('password'),",
                    "    org_id:values.get('org_id'),",
                    "    filial_id:values.get('filial_id'),",
                    "    filial:values.get('filial'),",
                    "    rowind:values.get('rowind'),",
                    "    what:\"editOrgTeplomer\"",
                    "};",
                    "",
                    "//FORMA",
                    "var fmOrgTeplomer = Ext.getCmp('fmOrgTeplomer');",
                    "",
                    "//GRID",
                    "var grOrgTeplomer = Ext.getCmp('grOrgTeplomer');",
                    "//LOGIKA",
                    "",
                    "Ext.Object.merge(value, params);",
                    "QueryTeplomer.addTeplomer(value,function(results){",
                    "    if (results.success){",
                    "        StOTeplomer.load({",
                    "            params: {",
                    "                what:'OrgTeplomer',",
                    "                filial_id: value.filial_id,",
                    "                teplomer_id: value.teplomer_id,",
                    "                login:value.login,",
                    "                password:value.password",
                    "            },",
                    "            callback: function(records,operation,success){",
                    "                if(success){",
                    "                    grOrgTeplomer.getView().getSelectionModel().select(value.rowind);",
                    "                    Ext.MessageBox.show({",
                    "                        title: 'Оновлення приладу обліку',",
                    "                        msg: results.msg,",
                    "                        buttons: Ext.MessageBox.OK,",
                    "                        icon: Ext.MessageBox.INFO",
                    "                    });",
                    "                }",
                    "            },",
                    "            scope:this",
                    "        });",
                    "",
                    "    }",
                    "});",
                    ""
                ]
            },
            "name": "editOrgTeplomer",
            "designerId": "1d2d5876-7478-48c0-a870-a21970782152"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "value"
                ],
                "fn": "changeOrgTeplomer",
                "implHandler": [
                    "// in use",
                    "var me = this;",
                    "//STORE",
                    "var stUser = Ext.data.StoreManager.get(\"StUser\");",
                    "var StOTeplomer = Ext.data.StoreManager.get(\"StOTeplomer\");//QueryTeplomer.getResults  <OrgTeplomer>",
                    "//LOGIN & PASSWORD",
                    "",
                    "var values =stUser.getAt(0);",
                    "var params = {",
                    "    login:values.get('login'),",
                    "    password:values.get('password'),",
                    "    org_id:values.get('org_id'),",
                    "    filial_id:values.get('filial_id'),",
                    "    filial:values.get('filial'),",
                    "    rowind:values.get('rowind'),",
                    "    what:\"changeOrgTeplomer\"",
                    "};",
                    "",
                    "//FORMA",
                    "var fmOrgTeplomer = Ext.getCmp('fmOrgTeplomer');",
                    "",
                    "//GRID",
                    "var grOrgTeplomer = Ext.getCmp('grOrgTeplomer');",
                    "//LOGIKA",
                    "",
                    "Ext.Object.merge(value, params);",
                    "QueryTeplomer.addTeplomer(value,function(results){",
                    "    if (results.success){",
                    "        StOTeplomer.load({",
                    "            params: {",
                    "                what:'OrgTeplomer',",
                    "                filial_id: value.filial_id,",
                    "                teplomer_id: value.teplomer_id,",
                    "                login:value.login,",
                    "                password:value.password",
                    "            },",
                    "            callback: function(records,operation,success){",
                    "                if(success){",
                    "                    grOrgTeplomer.getView().getSelectionModel().select(value.rowind);",
                    "                    Ext.MessageBox.show({",
                    "                        title: 'Заміна приладу обліку',",
                    "                        msg: results.msg,",
                    "                        buttons: Ext.MessageBox.OK,",
                    "                        icon: Ext.MessageBox.INFO",
                    "                    });",
                    "                }",
                    "            },",
                    "            scope:this",
                    "        });",
                    "",
                    "    }",
                    "});",
                    ""
                ]
            },
            "name": "changeOrgTeplomer",
            "designerId": "630d2297-09f9-44e8-93d4-920d8b791435"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "value"
                ],
                "fn": "addOrgTeplomer",
                "implHandler": [
                    "// in use",
                    "var me = this;",
                    "//STORE",
                    "var stUser = Ext.data.StoreManager.get(\"StUser\");",
                    "var StOTeplomer = Ext.data.StoreManager.get(\"StOTeplomer\");//QueryTeplomer.getResults  <OrgTeplomer>",
                    "//LOGIN & PASSWORD",
                    "",
                    "var values =stUser.getAt(0);",
                    "var params = {",
                    "    login:values.get('login'),",
                    "    password:values.get('password'),",
                    "    org_id:values.get('org_id'),",
                    "    filial_id:values.get('filial_id'),",
                    "    filial:values.get('filial'),",
                    "    rowind:values.get('rowind'),",
                    "    what:\"addOrgTeplomer\"",
                    "};",
                    "",
                    "//FORMA",
                    "var fmOrgTeplomer = Ext.getCmp('fmOrgTeplomer');",
                    "",
                    "//GRID",
                    "var grOrgTeplomer = Ext.getCmp('grOrgTeplomer');",
                    "//LOGIKA",
                    "",
                    "Ext.Object.merge(value, params);",
                    "QueryTeplomer.addTeplomer(value,function(results){",
                    "    if (results.success){",
                    "        StOTeplomer.load({",
                    "            params: {",
                    "                what:'OrgTeplomer',",
                    "                filial_id: value.filial_id,",
                    "                teplomer_id: value.teplomer_id,",
                    "                login:value.login,",
                    "                password:value.password",
                    "            },",
                    "            callback: function(records,operation,success){",
                    "                if(success){",
                    "                    grOrgTeplomer.getView().getSelectionModel().select(0);",
                    "                    Ext.MessageBox.show({",
                    "                        title: 'Введення нового приладу обліку',",
                    "                        msg: results.msg,",
                    "                        buttons: Ext.MessageBox.OK,",
                    "                        icon: Ext.MessageBox.INFO",
                    "                    });",
                    "                }",
                    "            },",
                    "            scope:this",
                    "        });",
                    "",
                    "    }",
                    "});",
                    ""
                ]
            },
            "name": "addOrgTeplomer",
            "designerId": "21501a82-d4d1-4315-93c1-9b9328f06f9d"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#insHandPokOrgTeplomer",
                "designer|targetType": "Ext.button.Button",
                "fn": "onInsHandPokOrgTeplomerClick",
                "implHandler": [
                    "// in use",
                    "var me = this;",
                    "//STORE",
                    "",
                    "var stUser = Ext.data.StoreManager.get(\"StUser\");",
                    "var stTekPokTeplomera = Ext.data.StoreManager.get(\"StTekPokOTeplomera\");//QueryTeplomer.getResults <TekPokTeplomera>",
                    "var stAllPokTeplomera = Ext.data.StoreManager.get(\"StAllPokOTeplomera\");//QueryTeplomer.getResults <TekPokTeplomera>",
                    "",
                    "//LOGIN & PASSWORD",
                    "",
                    "var values =stUser.getAt(0);",
                    "var params = {",
                    "    login:values.get('login'),",
                    "    password:values.get('password'),",
                    "    filial_id:values.get('filial_id'),",
                    "    house_id:values.get('house_id'),",
                    "    what:'insHandOrgTepl'",
                    "};",
                    "//FORMA",
                    "var fmTeplomer = Ext.getCmp('fmOrgTeplomer');",
                    "var value = fmTeplomer.getValues();",
                    "//LOGIKA",
                    "",
                    "",
                    "Ext.Object.merge(value, params);",
                    "var newValue = value.newValue;",
                    "var max =newValue - value.tek;",
                    "if (isNaN(newValue)){",
                    "    Ext.MessageBox.show({",
                    "        title: 'Проверка вводимых данных',",
                    "        msg: 'Введите число',",
                    "        buttons: Ext.MessageBox.OK,",
                    "        icon: Ext.MessageBox.ERROR",
                    "    });",
                    "    return false;",
                    "}else if (max<0){",
                    "    Ext.MessageBox.show({",
                    "        title: 'Проверка вводимых данных',       ",
                    "        msg: 'Текущие показания <b>'+value.tek+'</b><br>Новые показания <b>'+newValue+'</b><br>Введите правильные показания !.',",
                    "        buttons: Ext.MessageBox.CANCEL,       ",
                    "        icon: Ext.MessageBox.ERROR,",
                    "        buttonText:{",
                    "            cancel:'отмена'",
                    "        },",
                    "        fn:function(btn,newValue){",
                    "            if(btn=='cancel'){",
                    "                fmTeplomer.down('#newPokOrgTepl').focus();",
                    "                return false; ",
                    "            }",
                    "        }",
                    "    });",
                    "",
                    "} else {",
                    "    QueryTeplomer.newPokTeplomera(value,function(data){",
                    "        if (data.success){ ",
                    "            Ext.MessageBox.confirm({",
                    "                title: 'Проверка вводимых данных',",
                    "                msg: 'Новые показания введены',",
                    "                buttons: Ext.MessageBox.OK,",
                    "                icon: Ext.MessageBox.INFO",
                    "            });",
                    "            fmTeplomer.down('#newPokOrgTepl').setValue(0);",
                    "      ",
                    "            stTekPokTeplomera.load({",
                    "                params: {",
                    "                    what:'TekPokOrgTeplomera',",
                    "                    what_id: value.filial_id,",
                    "                    filial_id: value.filial_id,",
                    "                    teplomer_id: value.teplomer_id,",
                    "                    login:value.login,",
                    "                    password:value.password",
                    "                },",
                    "                callback: function(records,operation,success){",
                    "                    if(success){",
                    "                        fmTeplomer.getForm().loadRecord(records[0]);",
                    "                    }",
                    "                },",
                    "                scope:this",
                    "            });",
                    "            stAllPokTeplomera.load({",
                    "                params: {",
                    "                    login:value.login,",
                    "                    password:value.password,",
                    "                    filial_id: value.filial_id,",
                    "                    what:'AllPokOrgTeplomera',",
                    "                    what_id: value.teplomer_id,",
                    "                    teplomer_id: value.teplomer_id",
                    "                },",
                    "                scope:this",
                    "            });                        ",
                    "",
                    "        }",
                    "    });",
                    "}"
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onInsHandPokOrgTeplomerClick",
            "designerId": "f32a8062-e618-4ccd-b86f-7bd35daa5f3e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#newPokOrgTepl",
                "designer|targetType": "Ext.form.field.Number",
                "fn": "onNewPokOrgTeplSpecialkey",
                "implHandler": [
                    "var value = field.getValue();",
                    "if (e.getKey() === e.ENTER && !Ext.isEmpty(value)) {",
                    "    this.onInsTekPokOrgTeplomerClick();",
                    "}"
                ],
                "name": "specialkey",
                "scope": "me"
            },
            "name": "onNewPokOrgTeplSpecialkey",
            "designerId": "48b56bc7-53c1-4063-b515-170b0746bad7"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#pnOTeplomerHistory",
                "designer|targetType": "Ext.panel.Panel",
                "fn": "onPnOTeplomerHistoryExpand",
                "implHandler": [
                    "//STORE",
                    "",
                    "var stUser = Ext.data.StoreManager.get(\"StUser\");",
                    "var stHTeplomer = Ext.data.StoreManager.get(\"StHOTeplomer\");//QueryTeplomer.getResults <AppHTeplomer>",
                    "//LOGIN & PASSWORD",
                    "var values =stUser.getAt(0);",
                    "var stFilial = stHTeplomer.getAt(0);",
                    "if(stHTeplomer.data.length === 0){",
                    "    stHTeplomer.load({",
                    "        params: {",
                    "            what:'OrgHTeplomer',",
                    "            filial_id:values.get('filial_id'),",
                    "            login:values.get('login'),",
                    "            password:values.get('password')",
                    "        },",
                    "        scope:this",
                    "    });  ",
                    "} else {",
                    "    if( values.get('filial_id') !=stFilial_id.get('filial_id')){ ",
                    "        stHTeplomer.load({",
                    "            params: {",
                    "                what:'OrgHTeplomer',",
                    "                filial_id:values.get('filial_id'),",
                    "                login:values.get('login'),",
                    "                password:values.get('password')",
                    "            },",
                    "            scope:this",
                    "        }); ",
                    "",
                    "    }",
                    "}"
                ],
                "name": "expand",
                "scope": "me"
            },
            "name": "onPnOTeplomerHistoryExpand",
            "designerId": "02f015ea-4933-421d-9aa8-cef29c23673f"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#fmPererOrgTeplo",
                "designer|targetType": "Ext.form.Panel",
                "fn": "onFmPererOrgTeploExpand",
                "implHandler": [
                    "//STORE",
                    "",
                    "var stUser = Ext.data.StoreManager.get(\"StUser\");",
                    "var stTekNachFilial = Ext.data.StoreManager.get(\"StTekNachFilial\");",
                    "//LOGIN & PASSWORD",
                    "var values =stUser.getAt(0);",
                    "var stFilial = stTekNachFilial.getAt(0);",
                    "",
                    "if(stTekNachFilial.data.length === 0){",
                    "    stTekNachFilial.load({",
                    "        params: {",
                    "            what:'TekNachFilial',",
                    "            filial_id:values.get('filial_id'),",
                    "            login:values.get('login'),",
                    "            password:values.get('password')",
                    "        },",
                    "        callback: function(records,operation,success){",
                    "            if(success && records.length){",
                    "                p.getForm().loadRecord(records[0]);",
                    "                p.doLayout();",
                    "",
                    "            }",
                    "        },",
                    "        scope:this",
                    "    });",
                    "} else {",
                    "    if( values.get('filial_id') !=stFilial_id.get('filial_id')){ ",
                    "        stTekNachFilial.load({",
                    "            params: {",
                    "                what:'TekNachFilial',",
                    "                filial_id:values.get('filial_id'),",
                    "                login:values.get('login'),",
                    "                password:values.get('password')",
                    "            },",
                    "            callback: function(records,operation,success){",
                    "                if(success && records.length){",
                    "                    p.getForm().loadRecord(records[0]);",
                    "                    p.doLayout();",
                    "                }",
                    "            },",
                    "            scope:this",
                    "        });        ",
                    "    } else {",
                    "        p.getForm().loadRecord(stFilial);",
                    "        p.doLayout();",
                    "    }",
                    "}",
                    ""
                ],
                "name": "expand",
                "scope": "me"
            },
            "name": "onFmPererOrgTeploExpand",
            "designerId": "4cf3b2e0-d97a-4cbc-bc85-50f628a3e4b5"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#btnAddOrgTeplomer",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "Ext.button.Button",
                "fn": "onBtnAddOrgTeplomerClick",
                "implHandler": [
                    "//in use",
                    "var me = this;",
                    "var winAddTeplomer = Ext.ClassManager.instantiateByAlias('widget.winaddteplomer');",
                    "var form = winAddTeplomer.down('#fmAddTeplomer');",
                    "var stUser = Ext.data.StoreManager.get(\"StUser\");",
                    "var values =stUser.getAt(0);",
                    "//LOGIKA",
                    "values.set({'vibor':'addOrgTeplomer'});",
                    "stUser.sync();",
                    "var dt = new Date();",
                    "form.down('#btAddTeplomer').setText('Додати прилад обліку');",
                    "winAddTeplomer.setTitle('Введення нового приладу обліку');",
                    "//form.getForm().findField('pdate').setValue(Ext.Date.format(dt, 'Y-m-d'));",
                    "//form.getForm().findField('sdate').setValue(Ext.Date.format(dt, 'Y-m-d'));",
                    "form.getForm().findField('pp').setValue(4);",
                    "form.getForm().findField('fpdate').hide();",
                    "",
                    "winAddTeplomer.show();"
                ],
                "name": "click"
            },
            "name": "onBtnAddOrgTeplomerClick",
            "designerId": "916ada63-9b62-4ab9-a652-e660788b391d"
        }
    ]
}